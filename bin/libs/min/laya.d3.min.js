!function(t,e,n){var i=(n.un,n.uns,n["static"]),r=n["class"],a=n.getset,s=(n.__newvec,laya.ani.AnimationPlayer),o=(laya.ani.AnimationState,laya.webgl.atlas.AtlasResourceManager,laya.webgl.utils.Buffer),h=(laya.webgl.utils.Buffer2D,laya.utils.Byte),l=laya.utils.ClassUtils,u=laya.particle.emitter.EmitterBase,_=(laya.events.Event,laya.events.EventDispatcher),c=laya.utils.Handler,d=laya.webgl.utils.IndexBuffer2D,f=laya.ani.KeyframesAniTemplet,m=laya.net.Loader,p=laya.display.Node,v=(laya.particle.ParticleSettings,laya.particle.shader.ParticleShader),g=laya.particle.ParticleTemplateWebGL,x=laya.renders.Render,T=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),I=laya.resource.Resource,D=laya.utils.RunDriver,C=laya.webgl.shader.Shader,M=laya.webgl.shader.ShaderDefines,E=laya.display.Sprite,y=laya.utils.Stat,A=laya.resource.Texture,V=laya.net.URL,b=laya.webgl.utils.ValusArray,w=laya.webgl.utils.VertexBuffer2D,P=laya.webgl.WebGL,R=laya.webgl.WebGLContext,L=(laya.webgl.resource.WebGLImage,laya.webgl.resource.WebGLImageCube),S=laya.webgl.resource.WebGLRenderTarget;n["interface"]("laya.d3.core.render.IRender"),n["interface"]("laya.d3.graphics.IVertex"),n["interface"]("laya.d3.core.render.IUpdate");var O=(function(){function t(){this.texturePath=null,this.lifeTime=.5,this.minSegmentDistance=.1,this.minInterpDistance=.6,this.maxSlerpCount=128,this.maxSegments=200,this.color=new gt(1,1,1,1)}return r(t,"laya.d3.core.glitter.GlitterSettings"),t}(),function(){function t(){this._tempVector30=new vt,this._tempVector31=new vt,this._tempVector32=new vt,this._a=new vt,this._b=new vt,this._c=new vt,this._d=new vt}r(t,"laya.d3.core.glitter.SplineCurvePositionVelocity");var e=t.prototype;return e.Init=function(t,e,n,i){t.cloneTo(this._d),e.cloneTo(this._c),vt.scale(t,2,this._a),vt.scale(n,2,this._tempVector30),vt.subtract(this._a,this._tempVector30,this._a),vt.add(this._a,e,this._a),vt.add(this._a,i,this._a),vt.scale(n,3,this._b),vt.scale(t,3,this._tempVector30),vt.subtract(this._b,this._tempVector30,this._b),vt.subtract(this._b,i,this._b),vt.scale(e,2,this._tempVector30),vt.subtract(this._b,this._tempVector30,this._b)},e.Slerp=function(t,e){vt.scale(this._a,t*t*t,this._tempVector30),vt.scale(this._b,t*t,this._tempVector31),vt.scale(this._c,t,this._tempVector32),vt.add(this._tempVector30,this._tempVector31,e),vt.add(e,this._tempVector32,e),vt.add(e,this._d,e)},t}()),N=function(){function t(){if(this._id=0,this._number=0,this._mask=0,this._active=!0,this._visible=!0,this.name=null,this._id=t._uniqueIDCounter,t._uniqueIDCounter++,this._id>32)throw new Error("不允许创建Layer，请参考函数getLayerByNumber、getLayerByMask、getLayerByName！")}r(t,"laya.d3.core.Layer");var e=t.prototype;return a(0,e,"number",function(){return this._number}),a(0,e,"mask",function(){return this._mask}),a(0,e,"active",function(){return this._active},function(e){29!==this._number&&30!=this._number&&(this._active=e,e?t._activeLayers=t._activeLayers|this.mask:t._activeLayers=t._activeLayers&~this.mask)}),a(0,e,"visible",function(){return this._visible},function(e){29!==this._number&&30!=this._number&&(this._visible=e,e?t._visibleLayers=t._visibleLayers|this.mask:t._visibleLayers=t._visibleLayers&~this.mask)}),a(1,t,"activeLayers",function(){return t._activeLayers},function(e){t._activeLayers=e|t.getLayerByNumber(29).mask|t.getLayerByNumber(30).mask;for(var n=0;n<t._layerList.length;n++){var i=t._layerList[n];i._active=0!==(i._mask&t._activeLayers)}}),a(1,t,"visibleLayers",function(){return t._visibleLayers},function(e){t._visibleLayers=e|t.getLayerByNumber(29).mask|t.getLayerByNumber(30).mask;for(var n=0;n<t._layerList.length;n++){var i=t._layerList[n];i._visible=0!==(i._mask&t._visibleLayers)}}),t.__init__=function(){t._layerList.length=31;for(var e=0;31>e;e++){var n=new t;t._layerList[e]=n,0===e?n.name="Default Layer":29===e?n.name="Reserved Layer0":30===e?n.name="Reserved Layer1":n.name="Layer-"+e,n._number=e,n._mask=Math.pow(2,e)}t._activeLayers=2147483647,t._visibleLayers=2147483647,t._currentCameraCullingMask=2147483647,t.currentCreationLayer=t._layerList[0]},t.getLayerByNumber=function(e){if(0>e||e>30)throw new Error("无法返回指定Layer，该number超出范围！");return t._layerList[e]},t.getLayerByMask=function(e){for(var n=0;31>n;n++)if(t._layerList[n].mask===e)return t._layerList[n];throw new Error("无法返回指定Layer,该mask不存在")},t.getLayerByName=function(e){for(var n=0;31>n;n++)if(t._layerList[n].name===e)return t._layerList[n];throw new Error("无法返回指定Layer,该name不存在")},t.isActive=function(e){return 0!=(e&t._activeLayers)},t.isVisible=function(e){return 0!=(e&t._currentCameraCullingMask&t._visibleLayers)},t._uniqueIDCounter=1,t._layerCount=31,t._layerList=[],t._activeLayers=0,t._visibleLayers=0,t._currentCameraCullingMask=0,t.currentCreationLayer=null,t}(),U=(function(){function t(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._renderState=null,this._sharderNameID=0,this._shader=null,this._posShaderValue=[3,5126,!1,28,0],this._colorShaderValue=[4,5126,!1,28,12],this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._wvpMatrix=new dt,this._vb=new w(-1,35048),this._ib=new d,this._sharderNameID=C.nameKey.get("SIMPLE")}r(t,"laya.d3.core.PhasorSpriter3D");var e=t.prototype;return e.line=function(t,e,n,i,r,a,s,o,h,l,u,_,c,d){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t,e,n,i,r,a,s),this.addVertex(o,h,l,u,_,c,d),this.addIndexes(this._tempUint0,this._tempUint0+1),this},e.circle=function(t,e,n,i,r,a){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*e,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/e,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*t,Math.cos(this._tempNumver0)*t,0,n,i,r,a),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},e.plane=function(t,e,n,i,r,a,s,o,h){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=i/2,this._tempNumver1=r/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,n,a,s,o,h),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,n,a,s,o,h),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,n,a,s,o,h),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,n,a,s,o,h),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},e.box=function(t,e,n,i,r,a,s,o,h,l){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=i/2,this._tempNumver1=r/2,this._tempNumver2=a/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,n+this._tempNumver2,s,o,h,l),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,n+this._tempNumver2,s,o,h,l),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,n+this._tempNumver2,s,o,h,l),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,n+this._tempNumver2,s,o,h,l),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,n-this._tempNumver2,s,o,h,l),this.addVertex(t-this._tempNumver0,e+this._tempNumver1,n-this._tempNumver2,s,o,h,l),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,n-this._tempNumver2,s,o,h,l),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,n-this._tempNumver2,s,o,h,l),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},e.cone=function(t,e,n,i,r,a,s){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*n+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*n>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/n,this.addVertexIndex(0,e,0,i,r,a,s,this._tempUint0),this.addVertexIndex(0,0,0,i,r,a,s,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<n;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,i,r,a,s,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==n-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,i,r,a,s,this._tempUint0+(this._tempInt0+n)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==n-1?this.addIndexes(this._tempUint1+n+2):this.addIndexes(this._tempUint1+this._tempInt0+n+1),this.addIndexes(this._tempUint1+this._tempInt0+n),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},e.boudningBoxLine=function(t,e,n,i,r,a,s,o,h,l){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t,r,a,s,o,h,l),this.addVertex(i,r,a,s,o,h,l),this.addVertex(t,e,a,s,o,h,l),this.addVertex(i,e,a,s,o,h,l),this.addVertex(i,r,n,s,o,h,l),this.addVertex(t,r,n,s,o,h,l),this.addVertex(i,e,n,s,o,h,l),this.addVertex(t,e,n,s,o,h,l),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},e.addVertex=function(t,e,n,i,r,a,s){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=t,this._vbData[this._posInVBData+1]=e,this._vbData[this._posInVBData+2]=n,this._vbData[this._posInVBData+3]=i,this._vbData[this._posInVBData+4]=r,this._vbData[this._posInVBData+5]=a,this._vbData[this._posInVBData+6]=s,this._posInVBData+=this._floatSizePerVer,this},e.addVertexIndex=function(t,e,n,i,r,a,s,o){return this._hasBegun||this.addVertexIndexException(),this._vbData[o]=t,this._vbData[o+1]=e,this._vbData[o+2]=n,this._vbData[o+3]=i,this._vbData[o+4]=r,this._vbData[o+5]=a,this._vbData[o+6]=s,o+=this._floatSizePerVer,o>this._posInVBData&&(this._posInVBData=o),this},e.addIndexes=function(t){var e=arguments;this._hasBegun||this.addVertexIndexException();for(var n=0;n<e.length;n++)this._ibData[this._posInIBData]=e[n],this._posInIBData++;return this},e.begin=function(t,e,n){return this._hasBegun&&this.beginException0(),1!==t&&4!==t&&this.beginException1(),this._primitiveType=t,this._wvpMatrix=e,this._renderState=n,this._hasBegun=!0,this},e.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},e.flush=function(){if(0!==this._posInVBData){this._ib.clear(),this._ib.append(this._ibData),this._vb.clear(),this._vb.append(this._vbData),this._vb.bind_upload(this._ib);var t=this._renderState.shaderValue.length,e=this._renderState.shaderDefs.getValue();this._shader=this.getShader(this._renderState),this._renderState.shaderValue.pushValue("POSITION",this._posShaderValue,-1),this._renderState.shaderValue.pushValue("COLOR",this._colorShaderValue,-1),this._renderState.shaderValue.pushValue("MVPMATRIX",this._wvpMatrix.elements,-1),this._renderState.shaderValue.pushValue("LUMINANCE",1,-1),this._shader.uploadArray(this._renderState.shaderValue.data,this._renderState.shaderValue.length,null),this._renderState.shaderDefs.setValue(e),this._renderState.shaderValue.length=t,y.drawCall++,P.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0}},e.getShader=function(t){var e=t.shaderDefs._value;t.shaderDefs._value=-449&e,t.shaderDefs.add(32);var n=t.shaderDefs.getValue()|t.shadingMode+2e-4*this._sharderNameID,i=this._shader?this._shader:C.getShader(n);return i||(i=C.withCompile(this._sharderNameID,t.shadingMode,t.shaderDefs.toNameDic(),n,null))},e.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},e.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},e.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},e.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},e.drawLinesException=function(){throw new Error("您必须确保在此之前已调用bengin()且使用“LINES”基元！")},e.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用bengin()且使用“TRIANGLES”基元！")},t}(),function(){function t(){}r(t,"laya.d3.core.render.RenderClip");var e=t.prototype;return e.view=function(t){return!0},t}()),F=function(){function t(){this.depthTest=!0,this.depthMask=1,this.blend=!1,this.cullFace=!0,this.sFactor=1,this.dFactor=0,this.frontFace=2304}return r(t,"laya.d3.core.render.RenderConfig"),t}(),B=function(){function t(){this.type=0,this.owner=null,this.renderElement=null,this.material=null,this.tag=null,this.sortID=0}return r(t,"laya.d3.core.render.RenderObject"),t}(),G=function(){function t(t){this._renderObjects=null,this._length=0,this._staticRenderObjects=null,this._staticLength=0,this._merageRenderObjects=null,this._merageLength=0,this._renderConfig=null,this._staticBatchManager=null,this._renderConfig=t,this._renderObjects=[],this._length=0,this._staticRenderObjects=[],this._staticLength=0,this._merageRenderObjects=[],this._merageLength=0,this._staticBatchManager=new j}r(t,"laya.d3.core.render.RenderQuene");var e=t.prototype;return e._preRenderUpdateComponents=function(t,e){for(var n=0;n<t.componentsCount;n++){var i=t.getComponentByIndex(n);!i.started&&(i._start(e),i.started=!0),i.isActive&&i._preRenderUpdate(e)}},e._postRenderUpdateComponents=function(t,e){for(var n=0;n<t.componentsCount;n++){var i=t.getComponentByIndex(n);!i.started&&(i._start(e),i.started=!0),i.isActive&&i._postRenderUpdate(e)}},e._setState=function(t){R.setDepthTest(t,this._renderConfig.depthTest),R.setDepthMask(t,this._renderConfig.depthMask),R.setBlend(t,this._renderConfig.blend),R.setBlendFunc(t,this._renderConfig.sFactor,this._renderConfig.dFactor),R.setCullFace(t,this._renderConfig.cullFace),R.setFrontFaceCCW(t,this._renderConfig.frontFace)},e._preRender=function(e){this._renderObjects.length=this._length,this._renderObjects.sort(t._sort);for(var n,i,r,a=!1,s=!1,o=0,h=0,l=this._length;l>h;h++){var u=this._renderObjects[h],_=u.renderElement,c=u.owner.isStatic,d=_.getVertexBuffer(0);if(n===u.material&&i===d.vertexDeclaration&&a&&c&&1===_.VertexBufferCount&&u.owner.visible){if(s){if(!r.addRenderObj(u)){s=!1,a=c,n=u.material,i=d.vertexDeclaration,this._merageRenderObjects[this._merageLength++]=this._renderObjects[o++];continue}o++}else{r=this._staticBatchManager.getStaticBatchQneue(i,n);var f=this._renderObjects[h-1];if(!r.addRenderObj(f)||!r.addRenderObj(u)){s=!1,a=c,n=u.material,i=d.vertexDeclaration,this._merageRenderObjects[this._merageLength++]=this._renderObjects[o++];continue}var m=this._getStaticRenderObj();m.renderElement=r,m.type=1,this._merageRenderObjects[this._merageLength-1]=m,o++}s=!0}else this._merageRenderObjects[this._merageLength++]=this._renderObjects[o++],s=!1;a=c,n=u.material,i=d.vertexDeclaration}this._staticBatchManager.garbageCollection(),this._staticBatchManager._finsh()},e._render=function(t){for(var e,n=t.shaderValue.length,i=0,r=this._merageLength;r>i;i++){e=this._merageRenderObjects[i];var a=0;if(0===e.type){var s=e.owner;t.owner=s,t.renderObj=e,a=t.shaderDefs.getValue(),this._preRenderUpdateComponents(s,t),s.visible&&e.renderElement._render(t),this._postRenderUpdateComponents(s,t),t.shaderDefs.setValue(a)}else 1===e.type&&(t.owner=null,t.renderObj=e,a=t.shaderDefs.getValue(),e.renderElement._render(t),t.shaderDefs.setValue(a));t.shaderValue.length=n}},e.get=function(){var t=this._renderObjects[this._length++];return t||(this._renderObjects[this._length-1]=new B)},e._getStaticRenderObj=function(){var t=this._staticRenderObjects[this._staticLength++];return t||(this._staticRenderObjects[this._staticLength-1]=new B)},e.reset=function(){this._length=0,this._staticLength=0,this._merageLength=0},a(0,e,"length",function(){return this._length}),t._sort=function(t,e){if(t.owner.isStatic&&e.owner.isStatic){var n=t.renderElement.getVertexBuffer().vertexDeclaration.id,i=e.renderElement.getVertexBuffer().vertexDeclaration.id,r=n-i;if(0!==r)return r;if(t.material&&e.material){var a=t.material.id-e.material.id;if(0!==a)return a}}return t.sortID-e.sortID},t.NONEWRITEDEPTH=0,t.OPAQUE=1,t.OPAQUE_DOUBLEFACE=2,t.ALPHA_BLEND=3,t.ALPHA_BLEND_DOUBLEFACE=4,t.ALPHA_ADDTIVE_BLEND=5,t.ALPHA_ADDTIVE_BLEND_DOUBLEFACE=6,t.DEPTHREAD_ALPHA_BLEND=7,t.DEPTHREAD_ALPHA_BLEND_DOUBLEFACE=8,t.DEPTHREAD_ALPHA_ADDTIVE_BLEND=9,t.DEPTHREAD_ALPHA_ADDTIVE_BLEND_DOUBLEFACE=10,t}(),H=function(){function t(){this._shadingMode=0,this.elapsedTime=NaN,this.loopCount=0,this.context=null,this.scene=null,this.owner=null,this.renderObj=null,this.camera=null,this.viewMatrix=null,this.projectionMatrix=null,this.projectionViewMatrix=null,this.viewport=null,this.worldTransformModifyID=NaN,this.worldShaderValue=new b,this.shaderValue=new b,this.shaderDefs=new yt,this.renderClip=new U,this.reset()}r(t,"laya.d3.core.render.RenderState");var e=t.prototype;return e.reset=function(){this.worldShaderValue.length=0,this.shaderValue.length=0,this.shaderDefs.setValue(0),P.frameShaderHighPrecision&&this.shaderDefs.setValue(1048576)},a(0,e,"shadingMode",function(){return this._shadingMode},function(t){this.shaderDefs.remove(4==t?8:4),this.shaderDefs.add(t),this._shadingMode=t}),t.VERTEXSHADERING=4,t.PIXELSHADERING=8,t.clientWidth=0,t.clientHeight=0,t}(),k=function(){function t(t){this._owner=null,this._preWorldTransformModifyID=-1,this._localUpdate=!1,this._worldTransformModifyID=0,this._parent=null,this._localPosition=new vt,this._localRotation=new ft(0,0,0,1),this._localScale=new vt(1,1,1),this._localMatrix=new dt,this._position=new vt,this._rotation=new ft(0,0,0,1),this._scale=new vt(1,1,1),this._worldMatrix=new dt,this._forward=new vt,this._up=new vt,this._right=new vt,this._tempMatrix0=new dt,this._tempQuaternion0=new ft,this._tempVector30=new vt,this._owner=t}r(t,"laya.d3.core.Transform3D");var e=t.prototype;return e.translate=function(t,e){void 0===e&&(e=!0),e?(dt.createFromQuaternion(this.localRotation,this._tempMatrix0),vt.transformCoordinate(t,this._tempMatrix0,this._tempVector30),vt.add(this.localPosition,this._tempVector30,this._localPosition),this.localPosition=this._localPosition):(vt.add(this.position,t,this._position),this.position=this._position)},e.rotate=function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!0);var i;n?i=t:(vt.scale(t,Math.PI/180,this._tempVector30),i=this._tempVector30),ft.createFromYawPitchRoll(i.y,i.x,i.z,this._tempQuaternion0),e?(ft.multiply(this.localRotation,this._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(ft.multiply(this._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},e.getWorldMatrix=function(t){return-2===t||t>=0&&this._preWorldTransformModifyID===t?this._worldMatrix:(null!=this._parent?dt.multiply(this._parent.getWorldMatrix(-1===t?-1:-2),this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),t>=0&&(this._preWorldTransformModifyID=t),this._worldMatrix)},e._updateLocalMatrix=function(){dt.createAffineTransformation(this._localPosition,this._localRotation,this._localScale,this._localMatrix)},e._onLocalTransform=function(){this._localUpdate=!0},e._onWorldTransform=function(){this._worldTransformModifyID+=.01/this._owner.id},a(0,e,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(t){this._localMatrix=t,this._localMatrix.decompose(this._localPosition,this._localRotation,this._localScale),this._onWorldTransform()}),a(0,e,"localPosition",function(){return this._localPosition},function(t){this._localPosition=t,this._onLocalTransform(),this._onWorldTransform()}),a(0,e,"position",function(){if(null!==this._parent){var t=this.worldMatrix.elements;this._position.elements[0]=t[12],this._position.elements[1]=t[13],this._position.elements[2]=t[14]}else this._localPosition.cloneTo(this._position);return this._position},function(t){null!==this._parent?(this._parent.worldMatrix.invert(this._tempMatrix0),vt.transformCoordinate(t,this._tempMatrix0,this._localPosition),this.localPosition=this._localPosition):(t.cloneTo(this._localPosition),this.localPosition=this._localPosition)}),a(0,e,"worldMatrix",function(){return this.getWorldMatrix(-1),this._worldMatrix},function(t){null===this._parent?this.localMatrix=t:(this._parent.worldMatrix.invert(this._localMatrix),dt.multiply(this._localMatrix,t,this._localMatrix),this.localMatrix=this._localMatrix)}),a(0,e,"localRotation",function(){return this._localRotation},function(t){this._localRotation=t,this._localRotation.normalize(this._localRotation),this._onLocalTransform(),this._onWorldTransform()}),a(0,e,"rotation",function(){return null!==this._parent?this.worldMatrix.decompose(this._position,this._rotation,this._scale):this._localRotation.cloneTo(this._rotation),this._rotation},function(t){null!==this._parent?(this._parent.rotation.invert(this._tempQuaternion0),ft.multiply(t,this._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(t.cloneTo(this._localRotation),this.localRotation=this._localRotation)}),a(0,e,"localScale",function(){return this._localScale},function(t){this._localScale=t,this._onLocalTransform(),this._onWorldTransform()}),a(0,e,"scale",function(){return null!==this._parent?vt.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scale}),a(0,e,"localRotationEuler",null,function(t){ft.createFromYawPitchRoll(t.y,t.x,t.z,this._localRotation),this._onLocalTransform(),this._onWorldTransform()}),a(0,e,"rotationEuler",null,function(t){ft.createFromYawPitchRoll(t.y,t.x,t.z,this._rotation),this.rotation=this._rotation}),a(0,e,"forward",function(){var t=this.worldMatrix.elements;return this._forward.elements[0]=-t[8],this._forward.elements[1]=-t[9],this._forward.elements[2]=-t[10],this._forward}),a(0,e,"up",function(){var t=this.worldMatrix.elements;return this._up.elements[0]=t[4],this._up.elements[1]=t[5],this._up.elements[2]=t[6],this._up}),a(0,e,"right",function(){var t=this.worldMatrix.elements;return this._right.elements[0]=t[0],this._right.elements[1]=t[1],this._right.elements[2]=t[2],this._right}),t}(),W=function(){function t(e,n){this._currentVertexCount=0,this._currentIndexCount=0,this._elementCount=0,this._vertexDeclaration=null,this._material=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._lastRenderObjects=null,this._renderObjects=null,this._renderOwners=null,this._needReMerage=!1,this._elementCount=0,this._vertexDeclaration=e,this._material=n,this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*t.maxVertexCount),this._indexDatas=new Uint16Array(t.maxIndexCount),this._vertexBuffer=Ut.create(this._vertexDeclaration,t.maxVertexCount,35048),this._indexBuffer=Nt.create("ushort",t.maxIndexCount,35048),this._lastRenderObjects=[],this._renderObjects=[],this._renderOwners=[],this._needReMerage=!1}r(t,"laya.d3.graphics.StaticBatch");var e=t.prototype;return n.imps(e,{"laya.d3.core.render.IRender":!0}),e.getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},e.getIndexBuffer=function(){return this._indexBuffer},e.getBakedVertexs=function(t,e){return null},e.getBakedIndices=function(){return null},e._finsh=function(){if(this._needReMerage||this._lastRenderObjects.length==this._renderObjects.length||(this._needReMerage=!0),this._currentIndexCount=0,this._currentVertexCount=0,this._needReMerage){this._needReMerage=!1;var t=0,e=0;this._elementCount=0;for(var n=0;n<this._renderObjects.length;n++){var i=this._renderObjects[n],r=i.getBakedVertexs(0,this._renderOwners[n].transform.getWorldMatrix(-2)),a=i.getBakedIndices(),s=t/(this._vertexDeclaration.vertexStride/4),o=e,h=o+a.length;this._indexDatas.set(a,e);for(var l=o;h>l;l++)this._indexDatas[l]=s+this._indexDatas[l];e+=a.length,this._vertexDatas.set(r,t),t+=r.length,this._elementCount+=a.length}this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas)}this._lastRenderObjects=this._renderObjects.slice(),this._renderObjects.length=0,this._renderOwners.length=0},e._getShader=function(t,e,n){if(!n)return null;var i=0,r=e.vertexDeclaration.shaderAttribute;r.UV&&(i|=n.shaderDef),r.COLOR&&(i|=32),t.scene.enableFog&&(i|=131072),i>0&&t.shaderDefs.addInt(i);var a=n.getShader(t);return a},e.addRenderObj=function(e){var n=e.renderElement,i=n.getIndexBuffer(),r=this._currentIndexCount+i.byteLength/i.indexTypeByteCount,a=this._currentVertexCount+n.getVertexBuffer().byteLength/this._vertexDeclaration.vertexStride;return a>t.maxVertexCount||r>t.maxIndexCount?!1:(this._renderObjects.push(n),this._renderOwners.push(e.owner),this._needReMerage||-1!==this._lastRenderObjects.indexOf(n)||(this._needReMerage=!0),this._currentIndexCount=r,this._currentVertexCount=a,!0)},e._render=function(t){var e=this._vertexBuffer,n=this._indexBuffer,i=this._material;if(i.normalTexture&&!e.vertexDeclaration.shaderAttribute.TANGENT0){var r=e.getData(),a=Ct.GenerateTangent(r,e.vertexDeclaration.vertexStride/4,e.vertexDeclaration.shaderAttribute.POSITION[4]/4,e.vertexDeclaration.shaderAttribute.UV[4]/4,n.getData()),s=Ct.getVertexTangentDeclaration(e.vertexDeclaration.getVertexElements()),o=Ut.create(s,35044);o.setData(a),e.dispose(),this._vertexBuffer=e=o}if(e._bind(),n._bind(),i){var h=this._getShader(t,e,i),l=t.shaderValue.length;if(t.shaderValue.pushArray(e.vertexDeclaration.shaderValues),t.shaderValue.pushValue("MATRIX1",dt.DEFAULT.elements,-1),t.shaderValue.pushValue("MVPMATRIX",t.projectionViewMatrix.elements,t.camera.transform._worldTransformModifyID+t.camera._projectionMatrixModifyID),!i.upload(t,null,h))return t.shaderValue.length=l,!1;t.shaderValue.length=l}return t.context.drawElements(4,this._elementCount,5123,0),y.drawCall++,y.trianglesFaces+=this._elementCount/3,!0},a(0,e,"VertexBufferCount",function(){return 1}),a(0,e,"indexOfHost",function(){return 0}),a(0,e,"currentVertexCount",function(){return this._currentVertexCount}),a(0,e,"currentIndexCount",function(){return this._currentIndexCount}),t.maxVertexCount=65535,t.maxIndexCount=12e4,t}(),j=function(){function t(){this._keys=null,this._useFPS=null,this._staticBatchs=null,this._keys=[],this._useFPS=[],this._staticBatchs=[]}r(t,"laya.d3.graphics.StaticBatchManager");var e=t.prototype;return e.getStaticBatchQneue=function(t,e){var n,i=1e3*e.id+t.id;if(-1===this._keys.indexOf(i))this._keys.push(i),this._useFPS.push(y.loopCount),n=new W(t,e),this._staticBatchs.push(n);else{var r=this._keys.indexOf(i);this._useFPS[r]=y.loopCount,n=this._staticBatchs[r]}return n},e.garbageCollection=function(){for(var t=0;t<this._keys.length;t++)this._useFPS[t]<y.loopCount&&(this._keys.splice(t,1),this._useFPS.splice(t,1),this._staticBatchs.splice(t,1),t--)},e._finsh=function(){for(var t=0;t<this._keys.length;t++)this._staticBatchs[t]._finsh()},e.dispose=function(){this._keys.length=0,this._useFPS.length=0,this._staticBatchs.length=0},t.maxVertexDeclaration=1e3,i(t,["maxMaterialCount",function(){return this.maxMaterialCount=Math.floor(2147483.647)}]),t}(),X=function(){function t(e,n){this._id=0,this._shaderValues=null,this._shaderAttribute=null,this._vertexStride=0,this._vertexElements=null,this._id=++t._uniqueIDCounter,this._shaderAttribute={},this._shaderValues=new b,this._vertexStride=e,this._vertexElements=n;for(var i=0;i<n.length;i++){var r=n[i],a=r.elementUsage,s=[t._getTypeSize(r.elementFormat)/4,5126,!1,this._vertexStride,r.offset];this._shaderValues.pushValue(a,s,-1),this._shaderAttribute[a]=s}}r(t,"laya.d3.graphics.VertexDeclaration");var e=t.prototype;return e.getVertexElements=function(){return this._vertexElements.slice()},e.unBinding=function(){},a(0,e,"id",function(){return this._id}),a(0,e,"shaderAttribute",function(){return this._shaderAttribute}),a(0,e,"shaderValues",function(){return this._shaderValues}),a(0,e,"vertexStride",function(){return this._vertexStride}),t._getTypeSize=function(t){switch(t){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"volor":return 4;case"byte4":return 4;case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},t.getVertexStride=function(e){for(var n=0,i=0;i<e.Length;i++){var r=e[i],a=r.offset+t._getTypeSize(r.elementFormat);a>n&&(n=a)}return n},t._uniqueIDCounter=1,t}(),z=function(){function t(t,e,n){this.offset=0,this.elementFormat=null,this.elementUsage=null,this.offset=t,this.elementFormat=e,this.elementUsage=n}return r(t,"laya.d3.graphics.VertexElement"),t}(),q=(function(){function t(){}return r(t,"laya.d3.graphics.VertexElementFormat"),t.Single="single",t.Vector2="vector2",t.Vector3="vector3",t.Vector4="vector4",t.Color="volor",
t.Byte4="byte4",t.Short2="short2",t.Short4="short4",t.NormalizedShort2="normalizedshort2",t.NormalizedShort4="normalizedshort4",t.HalfVector2="halfvector2",t.HalfVector4="halfvector4",t}(),function(){function t(){}return r(t,"laya.d3.graphics.VertexElementUsage"),t.POSITION0="POSITION",t.COLOR0="COLOR",t.TEXTURECOORDINATE0="UV",t.NORMAL0="NORMAL",t.BINORMAL0="BINORMAL",t.TANGENT0="TANGENT0",t.BLENDINDICES0="BLENDINDICES",t.BLENDWEIGHT0="BLENDWEIGHT",t.DEPTH0="DEPTH",t.FOG0="FOG",t.POINTSIZE0="POINTSIZE",t.SAMPLE0="SAMPLE",t.TESSELLATEFACTOR0="TESSELLATEFACTOR",t.COLOR1="COLOR1",t.NEXTTEXTURECOORDINATE0="NEXTUV",t.TEXTURECOORDINATE1="UV1",t.NEXTTEXTURECOORDINATE1="NEXTUV1",t.CORNERTEXTURECOORDINATE0="CORNERTEXTURECOORDINATE",t.VELOCITY0="VELOCITY",t.STARTCOLOR0="STARTCOLOR",t.ENDCOLOR0="ENDCOLOR",t.SIZEROTATION0="SIZEROTATION",t.RADIUS0="RADIUS",t.RADIAN0="RADIAN",t.AGEADDSCALE0="AGEADDSCALE",t.TIME0="TIME",t}(),function(){function t(t,e,n){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=t,this._textureCoordinate0=e,this._time=n}r(t,"laya.d3.graphics.VertexGlitter");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate0}),a(0,e,"time",function(){return this._time}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(24,[new z(0,"vector3","POSITION"),new z(12,"vector2","UV"),new z(20,"single","TIME")])}]),t}()),Y=function(){function t(t,e,n,i,r,a,s,o,h,l){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=t,this._position=e,this._velocity=n,this._startColor=i,this._endColor=r,this._sizeRotation=a,this._radius=s,this._radian=o,this._ageAddScale=h,this._time=l}r(t,"laya.d3.graphics.VertexParticle");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),a(0,e,"velocity",function(){return this._velocity}),a(0,e,"position",function(){return this._position}),a(0,e,"radius",function(){return this._radius}),a(0,e,"startColor",function(){return this._startColor}),a(0,e,"endColor",function(){return this._endColor}),a(0,e,"radian",function(){return this._radian}),a(0,e,"sizeRotation",function(){return this._sizeRotation}),a(0,e,"ageAddScale",function(){return this._ageAddScale}),a(0,e,"time",function(){return this._time}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(116,[new z(0,"vector4","CORNERTEXTURECOORDINATE"),new z(16,"vector3","POSITION"),new z(28,"vector3","VELOCITY"),new z(40,"vector4","STARTCOLOR"),new z(56,"vector4","ENDCOLOR"),new z(72,"vector3","SIZEROTATION"),new z(84,"vector2","RADIUS"),new z(92,"vector4","RADIAN"),new z(108,"single","AGEADDSCALE"),new z(112,"single","TIME")])}]),t}(),Q=function(){function t(t,e,n){this._position=null,this._normal=null,this._color=null,this._position=t,this._normal=e,this._color=n}r(t,"laya.d3.graphics.VertexPositionNormalColor");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"normal",function(){return this._normal}),a(0,e,"color",function(){return this._color}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(40,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR")])}]),t}(),Z=function(){function t(t,e,n,i,r){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=n,this._blendIndex=i,this._blendWeight=r}r(t,"laya.d3.graphics.VertexPositionNormalColorSkin");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"normal",function(){return this._normal}),a(0,e,"color",function(){return this._color}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(72,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR"),new z(40,"vector4","BLENDWEIGHT"),new z(56,"vector4","BLENDINDICES")])}]),t}(),K=function(){function t(t,e,n,i,r,a){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=n,this._tangent=i,this._blendIndex=r,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"normal",function(){return this._normal}),a(0,e,"color",function(){return this._color}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(84,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR"),new z(40,"vector4","BLENDWEIGHT"),new z(56,"vector4","BLENDINDICES"),new z(72,"vector3","TANGENT0")])}]),t}(),J=function(){function t(t,e,n,i){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=t,this._normal=e,this._color=n,this._tangent=i}r(t,"laya.d3.graphics.VertexPositionNormalColorTangent");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"normal",function(){return this._normal}),a(0,e,"color",function(){return this._color}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(52,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR"),new z(40,"vector3","TANGENT0")])}]),t}(),$=function(){function t(t,e,n,i){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._color=n,this._textureCoordinate=i}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"normal",function(){return this._normal}),a(0,e,"color",function(){return this._color}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(48,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR"),new z(40,"vector2","UV")])}]),t}(),tt=function(){function t(t,e,n,i,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._color=n,this._textureCoordinate0=i,this._textureCoordinate1=r}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"normal",function(){return this._normal}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"color",function(){return this._color}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(56,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR"),new z(40,"vector2","UV"),new z(48,"vector2","UV1")])}]),t}(),et=function(){function t(t,e,n,i,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=n,this._textureCoordinate0=i,this._textureCoordinate1=r,this._blendIndex=a,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"normal",function(){return this._normal}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"color",function(){return this._color}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(88,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR"),new z(40,"vector2","UV"),new z(48,"vector2","UV1"),new z(56,"vector4","BLENDWEIGHT"),new z(72,"vector4","BLENDINDICES")])}]),t}(),nt=(function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0SkinTangent=function(t,e,n,i,r,a,s,o){this._position=t,this._normal=e,this._color=n,this._textureCoordinate0=i,this._textureCoordinate1=r,this._tangent=a,this._blendIndex=s,this._blendWeight=o},a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"normal",function(){return this._normal}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"color",function(){return this._color}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(100,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR"),new z(40,"vector2","UV"),new z(48,"vector2","UV1"),new z(56,"vector4","BLENDWEIGHT"),new z(72,"vector4","BLENDINDICES"),new z(88,"vector3","TANGENT0")])}]),t}(),function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0Tangent=function(t,e,n,i,r,a){this._position=t,this._normal=e,this._color=n,this._textureCoordinate0=i,this._textureCoordinate1=r,this._tangent=a},a(0,e,"position",function(){return this._position}),a(0,e,"normal",function(){return this._normal}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"color",function(){return this._color}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(68,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR"),new z(40,"vector2","UV"),new z(48,"vector2","UV1"),new z(56,"vector3","TANGENT0")])}]),t}(),function(){function t(t,e,n,i,r,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=n,this._textureCoordinate=i,this._blendIndex=r,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"normal",function(){return this._normal}),a(0,e,"color",function(){return this._color}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(80,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR"),new z(40,"vector2","UV"),new z(48,"vector4","BLENDWEIGHT"),new z(64,"vector4","BLENDINDICES")])}]),t}()),it=function(){function t(t,e,n,i,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=n,this._textureCoordinate=i,this._tangent=r,this._blendIndex=a,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"normal",function(){return this._normal}),a(0,e,"color",function(){return this._color}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(92,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR"),new z(40,"vector2","UV"),new z(48,"vector4","BLENDWEIGHT"),new z(64,"vector4","BLENDINDICES"),new z(80,"vector3","TANGENT0")])}]),t}(),rt=function(){function t(t,e,n,i,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._color=n,this._textureCoordinate=i,this._tangent=r}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"normal",function(){return this._normal}),a(0,e,"color",function(){return this._color}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(60,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector4","COLOR"),new z(40,"vector2","UV"),new z(48,"vector3","TANGENT0")])}]),t}(),at=function(){function t(t,e,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=n}r(t,"laya.d3.graphics.VertexPositionNormalTexture");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"normal",function(){return this._normal}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(32,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector2","UV")])}]),t}(),st=function(){function t(t,e,n,i){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._textureCoordinate0=n,this._textureCoordinate1=i}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"normal",function(){return this._normal}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(40,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector2","UV"),new z(32,"vector2","UV1")])}]),t}(),ot=function(){function t(t,e,n,i,r,a){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate0=n,this._textureCoordinate1=i,this._blendIndex=r,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"normal",function(){return this._normal}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(72,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector2","UV"),new z(32,"vector2","UV1"),new z(40,"vector4","BLENDWEIGHT"),new z(56,"vector4","BLENDINDICES")])}]),t}(),ht=(function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0SkinTangent=function(t,e,n,i,r,a,s){this._position=t,this._normal=e,this._textureCoordinate0=n,this._textureCoordinate1=i,this._tangent=r,this._blendIndex=a,this._blendWeight=s},a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"normal",function(){return this._normal}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(84,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector2","UV"),new z(32,"vector2","UV1"),new z(40,"vector4","BLENDWEIGHT"),new z(56,"vector4","BLENDINDICES"),new z(72,"vector3","TANGENT0")])}]),t}(),function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0Tangent=function(t,e,n,i,r){this._position=t,this._normal=e,this._textureCoordinate0=n,this._textureCoordinate1=i,this._tangent=r},a(0,e,"position",function(){return this._position}),a(0,e,"normal",function(){return this._normal}),a(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),a(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(52,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector2","UV"),new z(32,"vector2","UV1"),new z(40,"vector3","TANGENT0")])}]),t}(),function(){function t(t,e,n,i,r){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate=n,this._blendIndex=i,this._blendWeight=r}r(t,"laya.d3.graphics.VertexPositionNormalTextureSkin");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"normal",function(){return this._normal}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(64,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector2","UV"),new z(32,"vector4","BLENDWEIGHT"),new z(48,"vector4","BLENDINDICES")])}]),t}()),lt=function(){function t(t,e,n,i,r,a){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=n,this._tangent=i,this._blendIndex=r,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"blendIndex",function(){return this._blendIndex}),a(0,e,"normal",function(){return this._normal}),a(0,e,"blendWeight",function(){return this._blendWeight}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(76,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector2","UV"),new z(32,"vector4","BLENDWEIGHT"),new z(48,"vector4","BLENDINDICES"),new z(64,"vector3","TANGENT0")])}]),t}(),ut=function(){function t(t,e,n,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=n,this._tangent=i}r(t,"laya.d3.graphics.VertexPositionNormalTextureTangent");var e=t.prototype;return n.imps(e,{"laya.d3.graphics.IVertex":!0}),a(0,e,"position",function(){return this._position}),a(0,e,"normal",function(){return this._normal}),a(0,e,"textureCoordinate",function(){return this._textureCoordinate}),a(0,e,"tangent",function(){return this._tangent}),a(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),a(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),i(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new X(44,[new z(0,"vector3","POSITION"),new z(12,"vector3","NORMAL"),new z(24,"vector2","UV"),new z(32,"vector3","TANGENT0")])}]),t}(),_t=(function(){function t(){}return r(t,"laya.d3.Laya3D"),t.init=function(e,i){return P.enable()?(m.parserMap={TextureCube:t._loadTextureCube},D.changeWebGLSize=function(t,e){P.onStageResize(t,e),H.clientWidth=t,H.clientHeight=e},x.is3DMode=!0,n.init(e,i),N.__init__(),yt.__init__(),Dt.__init__(),Mt.__init__(),void t._regClassforJson()):void alert("Laya3D init err,must support webGL!")},t._regClassforJson=function(){l.regClass("Sprite3D",At),l.regClass("MeshSprite3D",Ot),l.regClass("Material",Et)},t._loadTextureCube=function(t){n.loader.load(t.url,c.create(null,function(e){var n=V.basePath;V.basePath=V.getPath(V.formatURL(t.url));var i=new L([e.px,e.nx,e.py,e.ny,e.pz,e.nz],e.size);V.basePath=n,i.on("loaded",null,function(e){var n=new A(i);t.endLoad(n)})}),null,"json",1,!1)},t}(),function(){function t(t,e,n,i){this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._fileData=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=e,this._materials=n,this._onLoaded(t,i)}r(t,"laya.d3.loaders.LoadModel");var e=t.prototype;return e._onLoaded=function(t,e){var n=V.basePath;V.basePath=V.getPath(V.formatURL(e)),this._fileData=t,this._readData=new h(this._fileData),this._readData.pos=0;this._readData.readUTFString();this.READ_BLOCK();for(var i=0;i<this._BLOCK.count;i++){var r=this._readData.getUint16(),a=this._strings[r],s=this["READ_"+a];if(null==s)throw new Error("model file err,no this function:"+r+" "+a);if(!s.call(this))break}return V.basePath=n,this._mesh},e.onError=function(){},e._readString=function(){return this._strings[this._readData.getUint16()]},e.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},e.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},e.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var t=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var e=0;e<this._STRINGS.size;e++)this._strings[e]=this._readData.readUTFString();return this._readData.pos=t,!0},e.READ_MATERIAL=function(){var t=this._readData.getUint16(),e=this._readString(),n=this._readString();if("null"!==n){n=V.formatURL(n);var i=m.getRes(n);if(i)this._materials[t]=i,i.loaded||i.once("loaded",null,function(){i.loaded=!0});else{this._materials[t]=i=new Et,i.setShaderName(e);var r=new m,a=function(t){var e=V.basePath;V.basePath=V.getPath(V.formatURL(n)),l.createByJson(t,i,null,c.create(null,Ct._parseMaterial,null,!1)),V.basePath=e,i.loaded=!0,i.event("loaded",i)};r.once("complete",null,a),r.load(n,"text",!1),m.cacheRes(n,i)}}else this._materials[t]=new Et;return!0},e.READ_MESH=function(){this._readString();return!0},e.READ_SUBMESH=function(){var e=(this._readString(),this._readData.getUint8()),n=this._readString();this._shaderAttributes=n.match(t._attrReg);var i=this._readData.getUint32(),r=this._readData.getUint32(),a=this._readData.getUint32(),s=this._readData.getUint32(),o=this._readData.getUint32(),h=this._readData.getUint32(),l=this._readData.getUint32(),u=this._readData.getUint32(),_=this._readData.__getBuffer(),c=new Tt(this._mesh);c.material=e,c.verticesIndices=new Uint32Array(_.slice(a+this._DATA.offset,a+this._DATA.offset+s));var d=this._getVertexDeclaration(),f=Ut.create(d,h/d.vertexStride,35044,!0),m=o+this._DATA.offset,p=_.slice(m,m+h);f.setData(new Float32Array(p)),c.setVB(f);for(var v=f.vertexDeclaration.getVertexElements(),g=0;g<v.length;g++)c._bufferUsage[v[g].elementUsage]=f;var x=Nt.create("ushort",r/2,35044,!0),T=i+this._DATA.offset,I=_.slice(T,T+r);x.setData(new Uint16Array(I)),c.setIB(x,r/2);var D=_.slice(l+this._DATA.offset,l+this._DATA.offset+u);return c._setBoneDic(new Uint8Array(D)),this._mesh.add(c),!0},e.READ_DATAAREA=function(){return!1},e._getVertexDeclaration=function(){for(var t=!1,e=!1,n=!1,i=!1,r=!1,a=!1,s=!1,o=0;o<this._shaderAttributes.length;o+=8)switch(this._shaderAttributes[o]){case"POSITION":t=!0;break;case"NORMAL":e=!0;break;case"COLOR":n=!0;break;case"UV":i=!0;break;case"UV1":r=!0;break;case"BLENDWEIGHT":a=!0;break;case"BLENDINDICES":s=!0}var h;return t&&e&&n&&i&&r&&a&&s?h=et.vertexDeclaration:t&&e&&i&&r&&a&&s?h=ot.vertexDeclaration:t&&e&&n&&i&&a&&s?h=nt.vertexDeclaration:t&&e&&i&&a&&s?h=ht.vertexDeclaration:t&&e&&n&&a&&s?h=Z.vertexDeclaration:t&&e&&n&&i&&r?h=tt.vertexDeclaration:t&&e&&i&&r?h=st.vertexDeclaration:t&&e&&n&&i?h=$.vertexDeclaration:t&&e&&i?h=at.vertexDeclaration:t&&e&&n&&(h=Q.vertexDeclaration),h},a(0,e,"mesh",function(){return this._mesh}),t._attrReg=new RegExp("(\\w+)|([:,;])","g"),t}()),ct=(function(){function t(t,e){this.min=null,this.max=null,this.min=t,this.max=e}r(t,"laya.d3.math.BoundBox");var e=t.prototype;return e.GetCorners=function(t){t.length=8;var e=this.min.elements,n=this.max.elements,i=e[0],r=e[1],a=e[2],s=n[0],o=n[1],h=n[2];t[0]=new vt(i,o,h),t[1]=new vt(s,o,h),t[2]=new vt(s,r,h),t[3]=new vt(i,r,h),t[4]=new vt(i,o,a),t[5]=new vt(s,o,a),t[6]=new vt(s,r,a),t[7]=new vt(i,r,a)},t.fromPoints=function(e,n){if(null==e)throw new Error("points");for(var i=new vt(Number.MAX_VALUE),r=new vt(-Number.MAX_VALUE),a=0;a<e.length;++a)vt.min(i,e[a],i),vt.max(r,e[a],r);n=new t(i,r)},t}(),function(){function t(t,e){this.center=null,this.radius=NaN,this.center=t,this.radius=e}return r(t,"laya.d3.math.BoundSphere"),t.fromSubPoints=function(t,e,n,i){if(null==t)throw new Error("points");if(0>e||e>=t.length)throw new Error("start"+e+"Must be in the range [0, "+(t.length-1)+"]");if(0>n||e+n>t.length)throw new Error("count"+n+"Must be in the range <= "+t.length+"}");for(var r=e+n,a=vt.ZERO,s=e;r>s;++s)vt.add(t[s],a,a);vt.scale(a,1/n,a);var o=0;for(s=e;r>s;++s){var h=vt.distanceSquared(a,t[s]);h>o&&(o=h)}o=Math.sqrt(o),i.center=a,i.radius=o},t.fromPoints=function(e,n){if(null==e)throw new Error("points");t.fromSubPoints(e,0,e.length,n)},t}(),function(){function t(){}return r(t,"laya.d3.math.MathUtils"),t.isZero=function(e){return Math.abs(e)<t.zeroTolerance},i(t,["zeroTolerance",function(){return this.zeroTolerance=1e-6}]),t}()),dt=(function(){function t(){var t=this.elements=new Float32Array(9);t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}r(t,"laya.d3.math.Matrix3x3");var e=t.prototype;return e.determinant=function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],s=t[5],o=t[6],h=t[7],l=t[8];return e*(l*a-s*h)+n*(-l*r+s*o)+i*(h*r-a*o)},e.translate=function(t,e){var n=e.elements,i=this.elements,r=t.elements,a=i[0],s=i[1],o=i[2],h=i[3],l=i[4],u=i[5],_=i[6],c=i[7],d=i[8],f=r[0],m=r[1];n[0]=a,n[1]=s,n[2]=o,n[3]=h,n[4]=l,n[5]=u,n[6]=f*a+m*h+_,n[7]=f*s+m*l+c,n[8]=f*o+m*u+d},e.rotate=function(t,e){var n=e.elements,i=this.elements,r=i[0],a=i[1],s=i[2],o=i[3],h=i[4],l=i[5],u=i[6],_=i[7],c=i[8],d=Math.sin(t),f=Math.cos(t);n[0]=f*r+d*o,n[1]=f*a+d*h,n[2]=f*s+d*l,n[3]=f*o-d*r,n[4]=f*h-d*a,n[5]=f*l-d*s,n[6]=u,n[7]=_,n[8]=c},e.scale=function(t,e){var n=e.elements,i=this.elements,r=t.elements,a=r[0],s=r[1];n[0]=a*i[0],n[1]=a*i[1],n[2]=a*i[2],n[3]=s*i[3],n[4]=s*i[4],n[5]=s*i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8]},e.invert=function(t){var e=t.elements,n=this.elements,i=n[0],r=n[1],a=n[2],s=n[3],o=n[4],h=n[5],l=n[6],u=n[7],_=n[8],c=_*o-h*u,d=-_*s+h*l,f=u*s-o*l,m=i*c+r*d+a*f;m||(t=null),m=1/m,
e[0]=c*m,e[1]=(-_*r+a*u)*m,e[2]=(h*r-a*o)*m,e[3]=d*m,e[4]=(_*i-a*l)*m,e[5]=(-h*i+a*s)*m,e[6]=f*m,e[7]=(-u*i+r*l)*m,e[8]=(o*i-r*s)*m},e.transpose=function(t){var e=t.elements,n=this.elements;if(t===this){var i=n[1],r=n[2],a=n[5];e[1]=n[3],e[2]=n[6],e[3]=i,e[5]=n[7],e[6]=r,e[7]=a}else e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8]},e.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},e.cloneTo=function(t){var e,n,i;if(n=this.elements,i=t.elements,n!==i)for(e=0;9>e;++e)i[e]=n[e]},e.copyFrom=function(t){var e,n,i;if(n=t.elements,i=this.elements,n!==i)for(e=0;9>e;++e)i[e]=n[e]},e.copyFromArray=function(t){var e,n;if(n=this.elements,t!==n)for(e=0;9>e;++e)n[e]=t[e]},t.createFromTranslation=function(t,e){var n=(e.elements,t.elements);e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=n[0],e[7]=n[1],e[8]=1},t.createFromRotation=function(t,e){var n=e.elements,i=Math.sin(t),r=Math.cos(t);n[0]=r,n[1]=i,n[2]=0,n[3]=-i,n[4]=r,n[5]=0,n[6]=0,n[7]=0,n[8]=1},t.createFromScaling=function(t,e){var n=e.elements,i=t.elements;n[0]=i[0],n[1]=0,n[2]=0,n[3]=0,n[4]=i[1],n[5]=0,n[6]=0,n[7]=0,n[8]=1},t.createFromMatrix4x4=function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]},t.multiply=function(t,e,n){var i=n.elements,r=t.elements,a=e.elements,s=r[0],o=r[1],h=r[2],l=r[3],u=r[4],_=r[5],c=r[6],d=r[7],f=r[8],m=a[0],p=a[1],v=a[2],g=a[3],x=a[4],T=a[5],I=a[6],D=a[7],C=a[8];i[0]=m*s+p*l+v*c,i[1]=m*o+p*u+v*d,i[2]=m*h+p*_+v*f,i[3]=g*s+x*l+T*c,i[4]=g*o+x*u+T*d,i[5]=g*h+x*_+T*f,i[6]=I*s+D*l+C*c,i[7]=I*o+D*u+C*d,i[8]=I*h+D*_+C*f},t.DEFAULT=new t,t}(),function(){function t(){var t=this.elements=new Float32Array(16);t[0]=t[5]=t[10]=t[15]=1}r(t,"laya.d3.math.Matrix4x4");var e=t.prototype;return e.decompose=function(e,n,i){var r=this.elements,a=e.elements,s=n.elements,o=i.elements;if(a[0]=r[12],a[1]=r[13],a[2]=r[14],o[0]=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),o[1]=Math.sqrt(r[4]*r[4]+r[5]*r[5]+r[6]*r[6]),o[2]=Math.sqrt(r[8]*r[8]+r[9]*r[9]+r[10]*r[10]),ct.isZero(o[0])||ct.isZero(o[1])||ct.isZero(o[2]))return s[0]=s[1]=s[2]=0,s[3]=1,!1;var h=new t,l=h.elements;return l[0]=r[0]/o[0],l[1]=r[1]/o[0],l[2]=r[2]/o[0],l[4]=r[4]/o[1],l[5]=r[5]/o[1],l[6]=r[6]/o[1],l[8]=r[8]/o[2],l[9]=r[9]/o[2],l[10]=r[10]/o[2],h[15]=1,ft.createFromMatrix4x4(h,n),!0},e.normalize=function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=Math.sqrt(e*e+n*n+i*i);return r?void(1!=r&&(r=1/r,t[0]=e*r,t[1]=n*r,t[2]=i*r)):(t[0]=0,t[1]=0,void(t[2]=0))},e.transpose=function(){var t,e;return t=this.elements,e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},e.invert=function(t){var e=this.elements,n=t.elements,i=e[0],r=e[1],a=e[2],s=e[3],o=e[4],h=e[5],l=e[6],u=e[7],_=e[8],c=e[9],d=e[10],f=e[11],m=e[12],p=e[13],v=e[14],g=e[15],x=i*h-r*o,T=i*l-a*o,I=i*u-s*o,D=r*l-a*h,C=r*u-s*h,M=a*u-s*l,E=_*p-c*m,y=_*v-d*m,A=_*g-f*m,V=c*v-d*p,b=c*g-f*p,w=d*g-f*v,P=x*w-T*b+I*V+D*A-C*y+M*E;0!==Math.abs(P)&&(P=1/P,n[0]=(h*w-l*b+u*V)*P,n[1]=(a*b-r*w-s*V)*P,n[2]=(p*M-v*C+g*D)*P,n[3]=(d*C-c*M-f*D)*P,n[4]=(l*A-o*w-u*y)*P,n[5]=(i*w-a*A+s*y)*P,n[6]=(v*I-m*M-g*T)*P,n[7]=(_*M-d*I+f*T)*P,n[8]=(o*b-h*A+u*E)*P,n[9]=(r*A-i*b-s*E)*P,n[10]=(m*C-p*I+g*x)*P,n[11]=(c*I-_*C-f*x)*P,n[12]=(h*y-o*V-l*E)*P,n[13]=(i*V-r*y+a*E)*P,n[14]=(p*T-m*D-v*x)*P,n[15]=(_*D-c*T+d*x)*P)},e.identity=function(){var t=this.elements;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1},e.cloneTo=function(t){var e,n,i;if(n=this.elements,i=t.elements,n!==i)for(e=0;16>e;++e)i[e]=n[e]},e.copyFrom=function(t){var e,n,i;if(n=t.elements,i=this.elements,n!==i)for(e=0;16>e;++e)i[e]=n[e]},e.copyFromArray=function(t){var e,n;if(n=this.elements,t!==n)for(e=0;16>e;++e)n[e]=t[e]},t.createRotationX=function(t,e){var n=e.elements,i=Math.sin(t),r=Math.cos(t);n[1]=n[2]=n[3]=n[4]=n[7]=n[8]=n[11]=n[12]=n[13]=n[14]=0,n[0]=n[15]=1,n[5]=n[10]=r,n[6]=i,n[9]=-i},t.createRotationY=function(t,e){var n=e.elements,i=Math.sin(t),r=Math.cos(t);n[1]=n[3]=n[4]=n[6]=n[7]=n[9]=n[11]=n[12]=n[13]=n[14]=0,n[5]=n[15]=1,n[0]=n[10]=r,n[2]=-i,n[8]=i},t.createRotationZ=function(t,e){var n=e.elements,i=Math.sin(t),r=Math.cos(t);n[2]=n[3]=n[6]=n[7]=n[8]=n[9]=n[11]=n[12]=n[13]=n[14]=0,n[10]=n[15]=1,n[0]=n[5]=r,n[1]=i,n[4]=-i},t.createTranslate=function(t,e){var n=t.elements,i=e.elements;i[4]=i[8]=i[1]=i[9]=i[2]=i[6]=i[3]=i[7]=i[11]=0,i[0]=i[5]=i[10]=i[15]=1,i[12]=n[0],i[13]=n[1],i[14]=n[2]},t.createScaling=function(t,e){var n=t.elements,i=e.elements;i[0]=n[0],i[5]=n[1],i[10]=n[2],i[1]=i[4]=i[8]=i[12]=i[9]=i[13]=i[2]=i[6]=i[14]=i[3]=i[7]=i[11]=0,i[15]=1},t.multiply=function(t,e,n){var i,r,a,s,o,h,l,u;if(r=n.elements,a=t.elements,s=e.elements,r===s)for(s=new Float32Array(16),i=0;16>i;++i)s[i]=r[i];for(i=0;4>i;i++)o=a[i],h=a[i+4],l=a[i+8],u=a[i+12],r[i]=o*s[0]+h*s[1]+l*s[2]+u*s[3],r[i+4]=o*s[4]+h*s[5]+l*s[6]+u*s[7],r[i+8]=o*s[8]+h*s[9]+l*s[10]+u*s[11],r[i+12]=o*s[12]+h*s[13]+l*s[14]+u*s[15]},t.createFromQuaternion=function(t,e){var n=e.elements,i=t.elements,r=i[0],a=i[1],s=i[2],o=i[3],h=r+r,l=a+a,u=s+s,_=r*h,c=a*h,d=a*l,f=s*h,m=s*l,p=s*u,v=o*h,g=o*l,x=o*u;n[0]=1-d-p,n[1]=c+x,n[2]=f-g,n[3]=0,n[4]=c-x,n[5]=1-_-p,n[6]=m+v,n[7]=0,n[8]=f+g,n[9]=m-v,n[10]=1-_-d,n[11]=0,n[12]=0,n[13]=0,n[14]=0,e[15]=1},t.createAffineTransformation=function(t,e,n,i){var r=t.elements,a=e.elements,s=n.elements,o=i.elements,h=a[0],l=a[1],u=a[2],_=a[3],c=h+h,d=l+l,f=u+u,m=h*c,p=h*d,v=h*f,g=l*d,x=l*f,T=u*f,I=_*c,D=_*d,C=_*f,M=s[0],E=s[1],y=s[2];o[0]=(1-(g+T))*M,o[1]=(p+C)*M,o[2]=(v-D)*M,o[3]=0,o[4]=(p-C)*E,o[5]=(1-(m+T))*E,o[6]=(x+I)*E,o[7]=0,o[8]=(v+D)*y,o[9]=(x-I)*y,o[10]=(1-(m+g))*y,o[11]=0,o[12]=r[0],o[13]=r[1],o[14]=r[2],o[15]=1},t.createLookAt=function(t,e,n,i){var r,a,s,o,h,l,u,_,c,d,f=t.elements,m=e.elements,p=n.elements,v=i.elements,g=f[0],x=f[1],T=f[2],I=p[0],D=p[1],C=p[2],M=m[0],E=m[1],y=m[2];return Math.abs(g-M)<ct.zeroTolerance&&Math.abs(x-E)<ct.zeroTolerance&&Math.abs(T-y)<ct.zeroTolerance?void i.identity():(u=g-M,_=x-E,c=T-y,d=1/Math.sqrt(u*u+_*_+c*c),u*=d,_*=d,c*=d,r=D*c-C*_,a=C*u-I*c,s=I*_-D*u,d=Math.sqrt(r*r+a*a+s*s),d?(d=1/d,r*=d,a*=d,s*=d):r=a=s=0,o=_*s-c*a,h=c*r-u*s,l=u*a-_*r,d=Math.sqrt(o*o+h*h+l*l),d?(d=1/d,o*=d,h*=d,l*=d):o=h=l=0,v[0]=r,v[1]=o,v[2]=u,v[3]=0,v[4]=a,v[5]=h,v[6]=_,v[7]=0,v[8]=s,v[9]=l,v[10]=c,v[11]=0,v[12]=-(r*g+a*x+s*T),v[13]=-(o*g+h*x+l*T),v[14]=-(u*g+_*x+c*T),void(v[15]=1))},t.createPerspective=function(t,e,n,i,r){var a=r.elements,s=1/Math.tan(t/2),o=1/(n-i);a[0]=s/e,a[5]=s,a[10]=(i+n)*o,a[11]=-1,a[14]=2*i*n*o,a[1]=a[2]=a[3]=a[4]=a[6]=a[7]=a[8]=a[9]=a[12]=a[13]=a[15]=0},t.createOrthogonal=function(t,e,n,i,r,a,s){var o=s.elements,h=1/(t-e),l=1/(n-i),u=1/(r-a);o[0]=-2*h,o[5]=-2*l,o[10]=2*u,o[12]=(t+e)*h,o[13]=(i+n)*l,o[14]=(a+r)*u,o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[8]=o[9]=o[11]=0,o[15]=1},t.TEMP=new t,t.DEFAULT=new t,t}()),ft=function(){function t(t,e,n,i){this.elements=new Float32Array(4),void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),this.elements[0]=t,this.elements[1]=e,this.elements[2]=n,this.elements[3]=i}r(t,"laya.d3.math.Quaternion");var e=t.prototype;return e.scaling=function(t,e){var n=e.elements,i=this.elements;n[0]=i[0]*t,n[1]=i[1]*t,n[2]=i[2]*t,n[3]=i[3]*t},e.normalize=function(t){var e=t.elements,n=this.elements,i=n[0],r=n[1],a=n[2],s=n[3],o=i*i+r*r+a*a+s*s;o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=a*o,e[3]=s*o)},e.length=function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3];return Math.sqrt(e*e+n*n+i*i+r*r)},e.rotateX=function(t,e){var n=e.elements,i=this.elements;t*=.5;var r=i[0],a=i[1],s=i[2],o=i[3],h=Math.sin(t),l=Math.cos(t);n[0]=r*l+o*h,n[1]=a*l+s*h,n[2]=s*l-a*h,n[3]=o*l-r*h},e.rotateY=function(t,e){var n=e.elements,i=this.elements;t*=.5;var r=i[0],a=i[1],s=i[2],o=i[3],h=Math.sin(t),l=Math.cos(t);n[0]=r*l-s*h,n[1]=a*l+o*h,n[2]=s*l+r*h,n[3]=o*l-a*h},e.rotateZ=function(t,e){var n=e.elements,i=this.elements;t*=.5;var r=i[0],a=i[1],s=i[2],o=i[3],h=Math.sin(t),l=Math.cos(t);n[0]=r*l+a*h,n[1]=a*l-r*h,n[2]=s*l+o*h,n[3]=o*l-s*h},e.getYawPitchRoll=function(e){vt.transformQuat(vt.ForwardRH,this,t.TEMPVector31),vt.transformQuat(vt.Up,this,t.TEMPVector32);var n=t.TEMPVector32.elements;t.angleTo(vt.ZERO,t.TEMPVector31,t.TEMPVector33);var i=t.TEMPVector33.elements;i[0]==Math.PI/2?(i[1]=t.arcTanAngle(n[2],n[0]),i[2]=0):i[0]==-Math.PI/2?(i[1]=t.arcTanAngle(-n[2],-n[0]),i[2]=0):(dt.createRotationY(-i[1],t.TEMPMatrix0),dt.createRotationX(-i[0],t.TEMPMatrix1),vt.transformCoordinate(t.TEMPVector32,t.TEMPMatrix0,t.TEMPVector32),vt.transformCoordinate(t.TEMPVector32,t.TEMPMatrix1,t.TEMPVector32),i[2]=t.arcTanAngle(n[1],-n[0])),i[1]<=-Math.PI&&(i[1]=Math.PI),i[2]<=-Math.PI&&(i[2]=Math.PI),i[1]>=Math.PI&&i[2]>=Math.PI&&(i[1]=0,i[2]=0,i[0]=Math.PI-i[0]);var r=e.elements;r[0]=i[1],r[1]=i[0],r[2]=i[2]},e.invert=function(t){var e=t.elements,n=this.elements,i=n[0],r=n[1],a=n[2],s=n[3],o=i*i+r*r+a*a+s*s,h=o?1/o:0;e[0]=-i*h,e[1]=-r*h,e[2]=-a*h,e[3]=s*h},e.identity=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=1},e.cloneTo=function(t){var e,n,i;if(n=this.elements,i=t.elements,n!==i)for(e=0;4>e;++e)i[e]=n[e]},e.copyFrom=function(t){var e,n,i;if(n=t.elements,i=this.elements,n!==i)for(e=0;4>e;++e)i[e]=n[e]},e.copyFromArray=function(t){var e,n;if(n=this.elements,t!==n)for(e=0;4>e;++e)n[e]=t[e]},a(0,e,"x",function(){return this.elements[0]}),a(0,e,"y",function(){return this.elements[1]}),a(0,e,"z",function(){return this.elements[2]}),a(0,e,"w",function(){return this.elements[3]}),t.createFromYawPitchRoll=function(t,e,n,i){var r=.5*n,a=.5*e,s=.5*t,o=Math.sin(r),h=Math.cos(r),l=Math.sin(a),u=Math.cos(a),_=Math.sin(s),c=Math.cos(s),d=i.elements;d[0]=c*l*h+_*u*o,d[1]=_*u*h-c*l*o,d[2]=c*u*o-_*l*h,d[3]=c*u*h+_*l*o},t.multiply=function(t,e,n){var i=t.elements,r=e.elements,a=n.elements,s=i[0],o=i[1],h=i[2],l=i[3],u=r[0],_=r[1],c=r[2],d=r[3],f=o*c-h*_,m=h*u-s*c,p=s*_-o*u,v=s*u+o*_+h*c;a[0]=s*d+u*l+f,a[1]=o*d+_*l+m,a[2]=h*d+c*l+p,a[3]=l*d-v},t.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:t>0?Math.atan(e/t):0>t?e>0?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},t.angleTo=function(e,n,i){vt.subtract(n,e,t.TEMPVector30),vt.normalize(t.TEMPVector30,t.TEMPVector30),i.elements[0]=Math.asin(t.TEMPVector30.y),i.elements[1]=t.arcTanAngle(-t.TEMPVector30.z,-t.TEMPVector30.x)},t.createFromAxisAngle=function(t,e,n){var i=n.elements,r=t.elements;e=.5*e;var a=Math.sin(e);i[0]=a*r[0],i[1]=a*r[1],i[2]=a*r[2],i[3]=Math.cos(e)},t.createFromMatrix3x3=function(t,e){var n,i=e.elements,r=t.elements,a=r[0]+r[4]+r[8];if(a>0)n=Math.sqrt(a+1),i[3]=.5*n,n=.5/n,i[0]=(r[5]-r[7])*n,i[1]=(r[6]-r[2])*n,i[2]=(r[1]-r[3])*n;else{var s=0;r[4]>r[0]&&(s=1),r[8]>r[3*s+s]&&(s=2);var o=(s+1)%3,h=(s+2)%3;n=Math.sqrt(r[3*s+s]-r[3*o+o]-r[3*h+h]+1),i[s]=.5*n,n=.5/n,i[3]=(r[3*o+h]-r[3*h+o])*n,i[o]=(r[3*o+s]+r[3*s+o])*n,i[h]=(r[3*h+s]+r[3*s+h])*n}},t.createFromMatrix4x4=function(t,e){var n,i,r=t.elements,a=e.elements,s=r[0]+r[5]+r[10];s>0?(n=Math.sqrt(s+1),a[3]=.5*n,n=.5/n,a[0]=(r[6]-r[9])*n,a[1]=(r[8]-r[2])*n,a[2]=(r[1]-r[4])*n):r[0]>=r[5]&&r[0]>=r[10]?(n=Math.sqrt(1+r[0]-r[5]-r[10]),i=.5/n,a[0]=.5*n,a[1]=(r[1]+r[4])*i,a[2]=(r[2]+r[8])*i,a[3]=(r[6]-r[9])*i):r[5]>r[10]?(n=Math.sqrt(1+r[5]-r[0]-r[10]),i=.5/n,a[0]=(r[4]+r[1])*i,a[1]=.5*n,a[2]=(r[9]+r[6])*i,a[3]=(r[8]-r[2])*i):(n=Math.sqrt(1+r[10]-r[0]-r[5]),i=.5/n,a[0]=(r[8]+r[2])*i,a[1]=(r[9]+r[6])*i,a[2]=.5*n,a[3]=(r[1]-r[4])*i)},t.slerp=function(t,e,n,i){var r,a,s,o,h,l=t.elements,u=e.elements,_=i.elements,c=l[0],d=l[1],f=l[2],m=l[3],p=u[0],v=u[1],g=u[2],x=u[3];return a=c*p+d*v+f*g+m*x,0>a&&(a=-a,p=-p,v=-v,g=-g,x=-x),1-a>1e-6?(r=Math.acos(a),s=Math.sin(r),o=Math.sin((1-n)*r)/s,h=Math.sin(n*r)/s):(o=1-n,h=n),_[0]=o*c+h*p,_[1]=o*d+h*v,_[2]=o*f+h*g,_[3]=o*m+h*x,_},t.lerp=function(t,e,n,i){var r=i.elements,a=t.elements,s=e.elements,o=a[0],h=a[1],l=a[2],u=a[3];r[0]=o+n*(s[0]-o),r[1]=h+n*(s[1]-h),r[2]=l+n*(s[2]-l),r[3]=u+n*(s[3]-u)},t.add=function(t,e,n){var i=n.elements,r=t.elements,a=e.elements;i[0]=r[0]+a[0],i[1]=r[1]+a[1],i[2]=r[2]+a[2],i[3]=r[3]+a[3]},t.dot=function(t,e){var n=t.elements,i=e.elements;return n[0]*i[0]+n[1]*i[1]+n[2]*i[2]+n[3]*i[3]},t.DEFAULT=new t,i(t,["TEMPVector30",function(){return this.TEMPVector30=new vt},"TEMPVector31",function(){return this.TEMPVector31=new vt},"TEMPVector32",function(){return this.TEMPVector32=new vt},"TEMPVector33",function(){return this.TEMPVector33=new vt},"TEMPMatrix0",function(){return this.TEMPMatrix0=new dt},"TEMPMatrix1",function(){return this.TEMPMatrix1=new dt}]),t}(),mt=function(){function t(t,e){this.origin=vt.ZERO,this.direction=vt.ONE,t=t,e=e}return r(t,"laya.d3.math.Ray"),t}(),pt=function(){function t(t,e){this.elements=new Float32Array(2),void 0===t&&(t=0),void 0===e&&(e=0);var n=this.elements;n[0]=t,n[1]=e}r(t,"laya.d3.math.Vector2");var e=t.prototype;return e.clone=function(t){var e=this.elements,n=t.elements;e[0]=n[0],e[1]=n[1]},a(0,e,"x",function(){return this.elements[0]}),a(0,e,"y",function(){return this.elements[1]}),i(t,["ZERO",function(){return this.ZERO=new t(0,0)},"ONE",function(){return this.ONE=new t(1,1)}]),t}(),vt=function(){function t(t,e,n){this.elements=new Float32Array(3),void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0);var i=this.elements;i[0]=t,i[1]=e,i[2]=n}r(t,"laya.d3.math.Vector3");var e=t.prototype;return e.copyFrom=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],this},e.clone=function(){var e=new t,n=e.elements,i=this.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],e},e.cloneTo=function(t){var e=t.elements,n=this.elements;e[0]=n[0],e[1]=n[1],e[2]=n[2]},a(0,e,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),a(0,e,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),a(0,e,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),t.distanceSquared=function(t,e){var n=t.elements,i=e.elements,r=n[0]-i[0],a=n[1]-i[1],s=n[2]-i[2];return r*r+a*a+s*s},t.min=function(t,e,n){var i=n.elements,r=t.elements,a=e.elements;i[0]=Math.min(r[0],a[0]),i[1]=Math.min(r[1],a[1]),i[2]=Math.min(r[2],a[2])},t.max=function(t,e,n){var i=n.elements,r=t.elements,a=e.elements;i[0]=Math.max(r[0],a[0]),i[1]=Math.max(r[1],a[1]),i[2]=Math.max(r[2],a[2])},t.transformQuat=function(t,e,n){var i=n.elements,r=t.elements,a=e.elements,s=r[0],o=r[1],h=r[2],l=a[0],u=a[1],_=a[2],c=a[3],d=c*s+u*h-_*o,f=c*o+_*s-l*h,m=c*h+l*o-u*s,p=-l*s-u*o-_*h;i[0]=d*c+p*-l+f*-_-m*-u,i[1]=f*c+p*-u+m*-l-d*-_,i[2]=m*c+p*-_+d*-u-f*-l},t.scalarLength=function(t){var e=t.elements,n=e[0],i=e[1],r=e[2];return Math.sqrt(n*n+i*i+r*r)},t.normalize=function(t,e){var n=t.elements,i=e.elements,r=n[0],a=n[1],s=n[2],o=r*r+a*a+s*s;o>0&&(o=1/Math.sqrt(o),i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o)},t.multiply=function(t,e,n){var i=n.elements,r=t.elements,a=e.elements;i[0]=r[0]*a[0],i[1]=r[1]*a[1],i[2]=r[2]*a[2]},t.scale=function(t,e,n){var i=n.elements,r=t.elements;i[0]=r[0]*e,i[1]=r[1]*e,i[2]=r[2]*e},t.lerp=function(t,e,n,i){var r=i.elements,a=t.elements,s=e.elements,o=a[0],h=a[1],l=a[2];r[0]=o+n*(s[0]-o),r[1]=h+n*(s[1]-h),r[2]=l+n*(s[2]-l)},t.transformV3ToV3=function(e,n,i){var r=new gt;t.transformV3ToV4(e,n,r);var a=r.elements,s=i.elements;s[0]=a[0],s[1]=a[1],s[2]=a[2]},t.transformV3ToV4=function(t,e,n){var i=t.elements,r=i[0],a=i[1],s=i[2],o=e.elements,h=n.elements;h[0]=r*o[0]+a*o[4]+s*o[8]+o[12],h[1]=r*o[1]+a*o[5]+s*o[9]+o[13],h[2]=r*o[2]+a*o[6]+s*o[10]+o[14],h[3]=r*o[3]+a*o[7]+s*o[11]+o[15]},t.transformCoordinate=function(e,n,i){var r=t.TEMPVec4.elements,a=e.elements,s=a[0],o=a[1],h=a[2],l=n.elements;r[0]=s*l[0]+o*l[4]+h*l[8]+l[12],r[1]=s*l[1]+o*l[5]+h*l[9]+l[13],r[2]=s*l[2]+o*l[6]+h*l[10]+l[14],r[3]=1/(s*l[3]+o*l[7]+h*l[11]+l[15]);var u=i.elements;u[0]=r[0]*r[3],u[1]=r[1]*r[3],u[2]=r[2]*r[3]},t.add=function(t,e,n){var i=n.elements,r=t.elements,a=e.elements;i[0]=r[0]+a[0],i[1]=r[1]+a[1],i[2]=r[2]+a[2]},t.subtract=function(t,e,n){var i=n.elements,r=t.elements,a=e.elements;i[0]=r[0]-a[0],i[1]=r[1]-a[1],i[2]=r[2]-a[2]},t.cross=function(t,e,n){var i=t.elements,r=e.elements,a=n.elements,s=i[0],o=i[1],h=i[2],l=r[0],u=r[1],_=r[2];a[0]=o*_-h*u,a[1]=h*l-s*_,a[2]=s*u-o*l},t.dot=function(t,e){var n=t.elements,i=e.elements,r=n[0]*i[0]+n[1]*i[1]+n[2]*i[2];return r},i(t,["TEMPVec4",function(){return this.TEMPVec4=new gt},"ZERO",function(){return this.ZERO=new t(0,0,0)},"ONE",function(){return this.ONE=new t(1,1,1)},"UnitX",function(){return this.UnitX=new t(1,0,0)},"UnitY",function(){return this.UnitY=new t(0,1,0)},"UnitZ",function(){return this.UnitZ=new t(0,0,1)},"ForwardRH",function(){return this.ForwardRH=new t(0,0,-1)},"ForwardLH",function(){return this.ForwardLH=new t(0,0,1)},"Up",function(){return this.Up=new t(0,1,0)}]),t}(),gt=function(){function t(t,e,n,i){this.elements=new Float32Array(4),void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0);var r=this.elements;r[0]=t,r[1]=e,r[2]=n,r[3]=i}r(t,"laya.d3.math.Vector4");var e=t.prototype;return e.copyFrom=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],this},a(0,e,"x",function(){return this.elements[0]}),a(0,e,"y",function(){return this.elements[1]}),a(0,e,"z",function(){return this.elements[2]}),a(0,e,"w",function(){return this.elements[3]}),t.lerp=function(t,e,n,i){var r=i.elements,a=t.elements,s=e.elements,o=a[0],h=a[1],l=a[2],u=a[3];r[0]=o+n*(s[0]-o),r[1]=h+n*(s[1]-h),r[2]=l+n*(s[2]-l),r[3]=u+n*(s[3]-u)},i(t,["ZERO",function(){return this.ZERO=new t}]),t}(),xt=function(){function t(t,e,n,i){this.minDepth=-1,this.maxDepth=1,this.x=t,this.y=e,this.width=n,this.height=i}r(t,"laya.d3.math.Viewport");var e=t.prototype;return e.project=function(t,e,n){vt.transformV3ToV3(t,e,n);var i=t.elements,r=e.elements,a=n.elements,s=i[0]*r[3]+i[1]*r[7]+i[2]*r[11]+r[15];1!==s&&(a[0]=a[0]/s,a[1]=a[1]/s,a[2]=a[2]/s),a[0]=.5*(a[0]+1)*this.width+this.x,a[1]=.5*(-a[1]+1)*this.height+this.y,a[2]=a[2]*(this.maxDepth-this.minDepth)+this.minDepth},e.unprojectFromMat=function(t,e,n){var i=t.elements,r=e.elements,a=n.elements;a[0]=(i[0]-this.x)/this.width*2-1,a[1]=-((i[1]-this.y)/this.height*2-1);var s=(this.maxDepth-this.minDepth)/2;a[2]=(i[2]-this.minDepth-s)/s;var o=a[0]*r[3]+a[1]*r[7]+a[2]*r[11]+r[15];vt.transformV3ToV3(n,e,n),1!==o&&(a[0]=a[0]/o,a[1]=a[1]/o,a[2]=a[2]/o)},e.unprojectFromWVP=function(t,e,n,i){var r=new dt;dt.multiply(e,n,r),dt.multiply(r,i,r),r.invert(r);var a=new vt;return this.unprojectFromMat(t,r,a),a},t}(),Tt=function(){function t(t){this._ib=null,this._materialIndex=-1,this._numberIndices=0,this._vb=null,this._mesh=null,this._boneIndex=null,this._cacheBoneDatas=null,this._boneData=null,this._bufferUsage={},this._finalBufferUsageDic=null,this._bakedVertexes=null,this._bakedIndices=null,this._isVertexbaked=!1,this._indexOfHost=0,this.verticesIndices=null,this._mesh=t}r(t,"laya.d3.resource.models.SubMesh");var e=t.prototype;return n.imps(e,{"laya.d3.core.render.IRender":!0,"laya.resource.IDispose":!0}),e.getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vb:null},e.getIndexBuffer=function(){return this._ib},e._getShader=function(t,e,n){if(!n)return null;var i=0,r=e.vertexDeclaration.shaderAttribute;r.UV&&(i|=n.shaderDef),r.COLOR&&(i|=32),t.scene.enableFog&&(i|=131072),i>0&&t.shaderDefs.addInt(i);var a=n.getShader(t);return a},e._render=function(t){var e=(this._mesh,this._vb),n=this._ib,i=this.getMaterial(t.owner.materials);if(i.normalTexture&&!e.vertexDeclaration.shaderAttribute.TANGENT0){var r=e.getData(),a=Ct.GenerateTangent(r,e.vertexDeclaration.vertexStride/4,e.vertexDeclaration.shaderAttribute.POSITION[4]/4,e.vertexDeclaration.shaderAttribute.UV[4]/4,n.getData()),s=Ct.getVertexTangentDeclaration(e.vertexDeclaration.getVertexElements()),o=Ut.create(s,35044);o.setData(a),e.dispose(),e=this._vb=o,this._bufferUsage.TANGENT0=o}if(null===n)return!1;if(e._bind(),n._bind(),i){var h=this._getShader(t,e,i),l=t.shaderValue.length;t.shaderValue.pushArray(e.vertexDeclaration.shaderValues);var u=t.owner,_=u.transform.getWorldMatrix(-2),c=t.renderObj.tag.worldTransformModifyID;if(t.shaderValue.pushValue("MATRIX1",_.elements,c),dt.multiply(t.projectionViewMatrix,_,t.owner.wvpMatrix),t.shaderValue.pushValue("MVPMATRIX",u.wvpMatrix.elements,t.camera.transform._worldTransformModifyID+c+t.camera._projectionMatrixModifyID),!i.upload(t,this._finalBufferUsageDic,h))return t.shaderValue.length=l,!1;t.shaderValue.length=l}return t.context.drawElements(4,this._numberIndices,5123,0),y.drawCall++,y.trianglesFaces+=this._numberIndices/3,!0},e._setBoneDic=function(t){this._boneIndex=t,this._mesh.disableUseFullBone(),this._cacheBoneDatas=[],this._boneData=new Float32Array(16*this._boneIndex.length)},e.getMaterial=function(t){return this._materialIndex>=0?t[this._materialIndex]:null},e.setIB=function(t,e){this._ib=t,this._numberIndices=e},e.getIB=function(){return this._ib},e.setVB=function(t){this._vb=t},e.getVB=function(){return this._vb},e.getBakedVertexs=function(t,e){if(0===t){if(this._bakedVertexes)return this._bakedVertexes;var n=4,i=this._vb;this._bakedVertexes=i.getData().slice();for(var r=i.vertexDeclaration,a=r.shaderAttribute.POSITION[4]/n,s=r.shaderAttribute.NORMAL[4]/n,o=0;o<this._bakedVertexes.length;o+=r.vertexStride/n){var h=o+a;Ct.transformVector3ArrayToVector3ArrayCoordinate(this._bakedVertexes,h,e,this._bakedVertexes,h),Ct.transformVector3ArrayToVector3ArrayCoordinate(this._bakedVertexes,s,e,this._bakedVertexes,s)}return this._isVertexbaked=!0,this._bakedVertexes}return null},e.getBakedIndices=function(){return this._bakedIndices?this._bakedIndices:this._bakedIndices=this._ib.getData()},e.dispose=function(){this._mesh=null,this._boneIndex=null,this._cacheBoneDatas=null,this._boneData=null,this._bakedVertexes=null,this._bakedIndices=null,this._ib.dispose(),this._vb.dispose()},a(0,e,"VertexBufferCount",function(){return 1}),a(0,e,"indexOfHost",function(){return this._indexOfHost}),a(0,e,"material",function(){return this._materialIndex},function(t){this._materialIndex=t}),t}(),It=function(){function t(t){this.texture=null,this._vertices=null,this._vertexBuffer=null,this._floatCountPerVertex=6,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=NaN,this._drawCounter=0,this._posShaderValue=[3,5126,!1,24,0],this._uvShaderValue=[2,5126,!1,24,12],this._timeShaderValue=[1,5126,!1,24,20],this._sharderNameID=0,this._shader=null,this.numPositionMode=0,this.numPositionVelocityMode=0,this._lastTime=NaN,this._needPatch=!1,this._lastAddTime=NaN,this.scLeft=null,this.scRight=null,this.setting=null,this._tempVector0=new vt,this._tempVector1=new vt,this._tempVector2=new vt,this._tempVector3=new vt,this._shaderValue=new b,this.posModeLastPosition0=new vt,this.posModeLastPosition1=new vt,this.posModePosition0=new vt,this.posModePosition1=new vt,this.posVelModePosition0=new vt,this.posVelModeVelocity0=new vt,this.posVelModePosition1=new vt,this.posVelModeVelocity1=new vt,this._lastAddPos0=new vt,this._lastAddPos1=new vt,this._currentTime=this._lastTime=0,this.setting=t,this.initialize(),this.loadShaderParams(),this.loadContent(),this.scLeft=new O,this.scRight=new O}r(t,"laya.d3.resource.tempelet.GlitterTemplet");var e=t.prototype;return n.imps(e,{"laya.d3.core.render.IRender":!0}),e.getBakedVertexs=function(t,e){return null},e.getBakedIndices=function(){return null},e.getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},e.getIndexBuffer=function(){return null},e.initialize=function(){this._vertices=new Float32Array(this.setting.maxSegments*this._floatCountPerVertex*2)},e.loadContent=function(){this._vertexBuffer=Ut.create(q.vertexDeclaration,2*this.setting.maxSegments,35048)},e.loadShaderParams=function(){if(this._sharderNameID=C.nameKey.get("GLITTER"),this.setting.texturePath){this._shaderValue.pushValue("DIFFUSETEXTURE",null,-1);var t=this;n.loader.load(this.setting.texturePath,c.create(null,function(e){e.bitmap.enableMerageInAtlas=!1,e.bitmap.mipmap=!0,t.texture=e}))}},e.update=function(t){this._currentTime+=t/1e3,this.retireActiveGlitters(),this.freeRetiredGlitters(),this._firstActiveElement==this._firstFreeElement&&(this._currentTime=0),this._firstRetiredElement==this._firstActiveElement&&(this._drawCounter=0),this.updateTextureCoordinate()},e._render=function(t){if(this.texture&&this.texture.loaded){if(this.update(t.elapsedTime),this._firstNewElement!=this._firstFreeElement&&this.addNewGlitterSegementToVertexBuffer(),this._firstActiveElement!=this._firstFreeElement){P.mainContext;this._vertexBuffer.bindWithIndexBuffer(null),this._shader=this.getShader(t);var e=this._shaderValue.length;this._shaderValue.pushArray(t.shaderValue),this._shaderValue.pushArray(this._vertexBuffer.vertexDeclaration.shaderValues),this._shaderValue.pushValue("UNICOLOR",this.setting.color.elements,-1),this._shaderValue.pushValue("MVPMATRIX",t.projectionViewMatrix.elements,-1),this._shaderValue.pushValue("DURATION",this.setting.lifeTime,-1),this._shaderValue.pushValue("LUMINANCE",1,-1),this._shaderValue.pushValue("CURRENTTIME",this._currentTime,-1),this._shaderValue.data[1][0]=this.texture.source,this._shaderValue.data[1][1]=this.texture.bitmap.id,this._shader.uploadArray(this._shaderValue.data,this._shaderValue.length,null),this._shaderValue.length=e;var n=0;this._firstActiveElement<this._firstFreeElement?(n=2*(this._firstFreeElement-this._firstActiveElement),P.mainContext.drawArrays(5,2*this._firstActiveElement,n),y.trianglesFaces+=n-2,y.drawCall++):(n=2*(this.setting.maxSegments-this._firstActiveElement),P.mainContext.drawArrays(5,2*this._firstActiveElement,n),y.trianglesFaces+=n-2,y.drawCall++,this._firstFreeElement>0&&(n=2*this._firstFreeElement,P.mainContext.drawArrays(5,0,n),y.trianglesFaces+=n-2,y.drawCall++))}this._drawCounter++}return!0},e.addVertexPositionVelocity=function(t,e,n,i){if(0===this.numPositionVelocityMode)this.numPositionVelocityMode++;else{var r=new vt;vt.subtract(t,this.posVelModePosition0,r);var a=vt.scalarLength(r);vt.subtract(n,this.posVelModePosition1,r);var s=vt.scalarLength(r),o=0;if(a<this.setting.minSegmentDistance&&s<this.setting.minSegmentDistance)return;if(o=1+Math.floor(Math.max(a,s)/this.setting.minInterpDistance),1===o)this.addGlitter(t,n,this._currentTime);else{o=Math.min(o,this.setting.maxSlerpCount),this.scLeft.Init(this.posVelModePosition0,this.posVelModeVelocity0,t,e),this.scRight.Init(this.posVelModePosition1,this.posVelModeVelocity1,n,i);for(var h=1/o,l=h,u=1;o>=u;u++){var _=this._tempVector0;this.scLeft.Slerp(l,_);var c=this._tempVector1;this.scRight.Slerp(l,c);var d=this._lastTime+(this._currentTime-this._lastTime)*u/o;this.addGlitter(_,c,d),l+=h}}}this._lastTime=this._currentTime,t.cloneTo(this.posVelModePosition0),e.cloneTo(this.posVelModeVelocity0),n.cloneTo(this.posVelModePosition1),i.cloneTo(this.posVelModeVelocity1)},e.addVertexPosition=function(t,e){if(this.numPositionMode<2)0===this.numPositionMode?(t.cloneTo(this.posModeLastPosition0),e.cloneTo(this.posModeLastPosition1)):(t.cloneTo(this.posModePosition0),e.cloneTo(this.posModePosition1)),this.numPositionMode++;else{var n=this._tempVector2;this.CalcVelocity(t,this.posModeLastPosition0,n);var i=this._tempVector3;this.CalcVelocity(e,this.posModeLastPosition1,i),this.addVertexPositionVelocity(this.posModePosition0,n,this.posModePosition1,i),this.posModePosition0.cloneTo(this.posModeLastPosition0),this.posModePosition1.cloneTo(this.posModeLastPosition1),t.cloneTo(this.posModePosition0),e.cloneTo(this.posModePosition1)}},e.addNewGlitterSegementToVertexBuffer=function(){var t=0;this._firstActiveElement<this._firstFreeElement?(t=2*this._firstActiveElement*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,2*(this._firstFreeElement-this._firstActiveElement)*this._floatCountPerVertex)):(t=2*this._firstActiveElement*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,2*(this.setting.maxSegments-this._firstActiveElement)*this._floatCountPerVertex),this._firstFreeElement>0&&this._vertexBuffer.setData(this._vertices,0,0,2*this._firstFreeElement*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},e.updateTextureCoordinate=function(){this._firstActiveElement<this._firstFreeElement?this.updateTextureCoordinateData(this._firstActiveElement,2*(this._firstFreeElement-this._firstActiveElement)):(this.updateTextureCoordinateData(this._firstActiveElement,2*(this.setting.maxSegments-this._firstActiveElement)),this._firstFreeElement>0&&this.updateTextureCoordinateData(0,2*this._firstFreeElement))},e.updateTextureCoordinateData=function(t,e){for(var n=0;e>n;n+=2){var i=(2*t+n+0)*this._floatCountPerVertex,r=(2*t+n+1)*this._floatCountPerVertex;this._vertices[i+3]=this._vertices[r+3]=(this._vertices[i+5]-this._currentTime)/this.setting.lifeTime}},e.retireActiveGlitters=function(){for(var t=this.setting.lifeTime;this._firstActiveElement!=this._firstNewElement;){var e=this._firstActiveElement*this._floatCountPerVertex*2+5,n=this._currentTime-this._vertices[e];if(t>n)break;this._vertices[e]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this.setting.maxSegments&&(this._firstActiveElement=0)}},e.freeRetiredGlitters=function(){for(;this._firstRetiredElement!=this._firstActiveElement;){var t=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*2+5];if(3>t)break;this._firstRetiredElement++,this._firstRetiredElement>=this.setting.maxSegments&&(this._firstRetiredElement=0)}},e.addGlitter=function(t,e,n){this._needPatch&&(this._needPatch=!1,this.addGlitter(this._lastAddPos0,this._lastAddPos1,this._lastAddTime));var i=this._firstFreeElement+1;if(i>=this.setting.maxSegments&&(i=0,t.cloneTo(this._lastAddPos0),e.cloneTo(this._lastAddPos1),this._lastAddTime=n,this._needPatch=!0),i!==this._firstRetiredElement){var r=t.elements,a=e.elements,s=0,o=this._firstFreeElement*this._floatCountPerVertex*2;for(s=0;3>s;s++)this._vertices[o+s]=r[s];this._vertices[o+3]=0,this._vertices[o+4]=0,this._vertices[o+5]=n;var h=o+this._floatCountPerVertex;for(s=0;3>s;s++)this._vertices[h+s]=a[s];this._vertices[h+3]=0,this._vertices[h+4]=1,this._vertices[h+5]=n,this._firstFreeElement=i}},e.CalcVelocity=function(t,e,n){vt.subtract(t,e,n),vt.scale(n,.5,n)},e.getShader=function(t){var e=t.shaderDefs,n=e._value,i=(e._value|t.shadingMode)+2e-4*this._sharderNameID;return this._shader=C.withCompile(this._sharderNameID,t.shadingMode,t.shaderDefs.toNameDic(),i,null),e._value=n,this._shader},a(0,e,"VertexBufferCount",function(){return 1}),a(0,e,"indexOfHost",function(){return 0}),t}(),Dt=(function(){function t(t){this._ib=null,this._materialIndex=-1,this._elementCount=0,this._vbOffet=0,this._vb=null,this._meshTemplet=null,this._boneIndex=null,this._cacheBoneDatas=null,this._boneData=null,this._bufferUsage={},this._finalBufferUsageDic=null,this.verticesIndices=null,this._meshTemplet=t}r(t,"laya.d3.resource.tempelet.SubMeshTemplet");var e=t.prototype;return e._mergeRendering=function(t,e,n){},e._setVBOffset=function(t){this._vbOffet=t},e._setBoneDic=function(t){this._boneIndex=t,this._meshTemplet.disableUseFullBone(),this._cacheBoneDatas=[],this._boneData=new Float32Array(16*this._boneIndex.length)},e.getMaterial=function(t){return this._materialIndex>=0?t[this._materialIndex]:null},e.setIB=function(t,e){this._ib=t,this._elementCount=e},e.getIB=function(){return this._ib},e.setVB=function(t){this._vb=t},e.getVB=function(){return this._vb},a(0,e,"material",function(){return this._materialIndex},function(t){this._materialIndex=t}),t}(),function(){function t(){}return r(t,"laya.d3.shader.Shader3D"),t.__init__=function(){t.SIMPLE=C.nameKey.add("SIMPLE"),t.TERRAIN=C.nameKey.add("TERRAIN"),t.PARTICLE=C.nameKey.add("PARTICLE"),t.U3DPARTICLE=C.nameKey.add("U3DPARTICLE"),t.GLITTER=C.nameKey.add("GLITTER"),t.SIMPLE_EFFECT=C.nameKey.add("SIMPLE_EFFECT"),C.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n vec3 Ambient;\n vec3 Specular;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Ambient;\n vec3 Specular;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Ambient;\n vec3 Specular;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n	dif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n	amb=vec3(0.0);\n	spec=vec3(0.0);\n	vec3 lightVec=-normalize(dirLight.Direction);\n	\n	amb=matAmb*dirLight.Ambient;\n	\n	float  diffuseFactor=dot(lightVec, normal);\n	\n	if(diffuseFactor>0.0)\n	{\n	   vec3 v = reflect(-lightVec, normal);\n	   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n	   \n	   dif = diffuseFactor * matDif * dirLight.Diffuse;\n	   spec = specFactor * matSpe.rgb * dirLight.Specular;\n	}\n	\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n	dif=vec3(0.0);\n	amb=vec3(0.0);\n	spec=vec3(0.0);\n	vec3 lightVec = poiLight.Position - pos;\n		\n	float d = length(lightVec);\n	\n	if( d > poiLight.Range )\n		return;\n		\n	lightVec /= d; \n	\n	amb = matAmb * poiLight.Ambient;	\n\n	float diffuseFactor = dot(lightVec, normal);\n\n	if( diffuseFactor > 0.0 )\n	{\n		vec3 v= reflect(-lightVec, normal);\n		float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n					\n		dif = diffuseFactor * matDif * poiLight.Diffuse;\n		spec = specFactor * matSpe.rgb * poiLight.Specular;\n	}\n\n	float attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n	dif *= attenuate;\n	spec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n	amb = vec3(0.0);\n	dif =vec3(0.0);\n	spec= vec3(0.0);\n	vec3 lightVec = spoLight.Position - pos;\n		\n	float d = length(lightVec);\n	\n	if( d > spoLight.Range)\n		return;\n		\n	lightVec /= d; \n	\n	amb = matAmb * spoLight.Ambient;	\n\n	float diffuseFactor = dot(lightVec, normal);\n\n	if(diffuseFactor > 0.0)\n	{\n		vec3 v= reflect(-lightVec, normal);\n		float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n					\n		dif = diffuseFactor * matDif * spoLight.Diffuse;\n		spec = specFactor * matSpe.rgb * spoLight.Specular;\n	}\n	\n	float spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n	float attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n	amb *= spot;\n	dif *= attenuate;\n	spec*= attenuate;\n}\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n	vec3 normalT = 2.0*normalMapSample - 1.0;\n\n	// Build orthonormal basis.\n	vec3 N = normalize(unitNormal);\n	vec3 T = normalize( tangent- dot(tangent, N)*N);\n	vec3 B = cross(T, N);\n\n	mat3 TBN = mat3(T, B, N);\n\n	// Transform from tangent space to world space.\n	vec3 bumpedNormal = TBN*normalT;\n\n	return bumpedNormal;\n}\n"),
C.addInclude("VRHelper.glsl","\nvec4 DistortFishEye(vec4 p)\n{\n    vec2 v = p.xy / p.w;\n    float radius = length(v);// Convert to polar coords\n    if (radius > 0.0)\n    {\n      float theta = atan(v.y,v.x);\n      \n      radius = pow(radius, 0.93);// Distort:\n\n      v.x = radius * cos(theta);// Convert back to Cartesian\n      v.y = radius * sin(theta);\n      p.xy = v.xy * p.w;\n    }\n    return p;\n}");var e,n,i={a_Position:"POSITION",a_Color:"COLOR",a_Normal:"NORMAL",a_Texcoord0:"UV",a_Texcoord1:"UV1",a_TexcoordNext0:"NEXTUV",a_BoneWeights:"BLENDWEIGHT",a_BoneIndices:"BLENDINDICES",a_Tangent0:"TANGENT0",u_WorldMat:"MATRIX1",u_CameraPos:"CAMERAPOS",u_DiffuseTexture:"DIFFUSETEXTURE",u_SpecularTexture:"SPECULARTEXTURE",u_NormalTexture:"NORMALTEXTURE",u_AmbientTexture:"AMBIENTTEXTURE",u_ReflectTexture:"REFLECTTEXTURE",u_MvpMatrix:"MVPMATRIX",u_Bones:"MATRIXARRAY0",u_FogStart:"FOGSTART",u_FogRange:"FOGRANGE",u_FogColor:"FOGCOLOR",u_Luminance:"LUMINANCE",u_AlphaTestValue:"ALPHATESTVALUE",u_UVMatrix:"MATRIX2",u_UVAge:"FLOAT0",u_UVAniAge:"UVAGEX","u_DirectionLight.Direction":"LIGHTDIRECTION","u_DirectionLight.Diffuse":"LIGHTDIRDIFFUSE","u_DirectionLight.Ambient":"LIGHTDIRAMBIENT","u_DirectionLight.Specular":"LIGHTDIRSPECULAR","u_PointLight.Position":"POINTLIGHTPOS","u_PointLight.Range":"POINTLIGHTRANGE","u_PointLight.Attenuation":"POINTLIGHTATTENUATION","u_PointLight.Diffuse":"POINTLIGHTDIFFUSE","u_PointLight.Ambient":"POINTLIGHTAMBIENT","u_PointLight.Specular":"POINTLIGHTSPECULAR",u_MaterialDiffuse:"MATERIALDIFFUSE",u_MaterialAmbient:"MATERIALAMBIENT",u_MaterialSpecular:"MATERIALSPECULAR",u_MaterialReflect:"MATERIALREFLECT","u_SpotLight.Position":"SPOTLIGHTPOS","u_SpotLight.Direction":"SPOTLIGHTDIRECTION","u_SpotLight.Range":"SPOTLIGHTRANGE","u_SpotLight.Spot":"SPOTLIGHTSPOT","u_SpotLight.Attenuation":"SPOTLIGHTATTENUATION","u_SpotLight.Diffuse":"SPOTLIGHTDIFFUSE","u_SpotLight.Ambient":"SPOTLIGHTAMBIENT","u_SpotLight.Specular":"SPOTLIGHTSPECULAR"};e='#include?DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT "LightHelper.glsl";\n\nattribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n#include?VR "VRHelper.glsl";\n\n\n\n#ifdef DIFFUSEMAP||((DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT)&&COLOR&&SPECULARMAP)\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef MIXUV\n  attribute vec2 a_TexcoordNext0;\n  uniform float  u_UVAge;\n  #endif\n  #ifdef UVTRANSFORM\n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#ifdef AMBIENTMAP\nattribute vec2 a_Texcoord1;\nvarying vec2 v_Texcoord1;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||REFLECTMAP\nattribute vec3 a_Normal;\n#endif\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||FOG||REFLECTMAP\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n\nvarying vec3 v_Diffuse;\nvarying vec3 v_Ambient;\nvarying vec3 v_Specular;\n#endif\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||AMBIENTMAP\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#ifdef FOG\nvarying float v_ToEyeLength;\n#endif\n\n#ifdef REFLECTMAP\nvarying vec3 v_ToEye;\nvarying vec3 v_Normal;\n#endif\n\n\nvoid main()\n{\n #ifdef BONE\n mat4 skinTransform=mat4(0.0);\n skinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n vec4 position=skinTransform*a_Position;\n   #ifdef VR\n   gl_Position = DistortFishEye(u_MvpMatrix * position);\n   #else\n   gl_Position = u_MvpMatrix * position;\n   #endif\n #else\n   #ifdef VR\n   gl_Position = DistortFishEye(u_MvpMatrix * a_Position);\n   #else\n   gl_Position = u_MvpMatrix * a_Position;\n   #endif\n #endif\n \n \n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||REFLECTMAP\n  #ifdef BONE\n  vec3 normal=normalize( mat3(u_WorldMat*skinTransform)*a_Normal);\n  #else\n  vec3 normal=normalize( mat3(u_WorldMat)*a_Normal);\n  #endif\n \n  #ifdef REFLECTMAP\n  v_Normal=normal;\n  #endif\n#endif\n \n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT\n  v_Diffuse=vec3(0.0);\n  v_Ambient=vec3(0.0);\n  v_Specular=vec3(0.0);\n  vec3 dif, amb, spe;\n#endif\n\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||FOG||REFLECTMAP\n  #ifdef BONE\n  vec3 positionWorld=(u_WorldMat*position).xyz;\n  #else\n  vec3 positionWorld=(u_WorldMat*a_Position).xyz;\n  #endif\n#endif\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||FOG||REFLECTMAP\nvec3 toEye;\n  #ifdef FOG\n  toEye=u_CameraPos-positionWorld;\n  v_ToEyeLength=length(toEye);\n  toEye/=v_ToEyeLength;\n  #else\n  toEye=normalize(u_CameraPos-positionWorld);\n  #endif\n \n  #ifdef REFLECTMAP\n  v_ToEye=toEye;\n  #endif\n#endif\n \n#ifdef DIRECTIONLIGHT\ncomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,normal,toEye, dif, amb, spe);\nv_Diffuse+=dif;\nv_Ambient+=amb;\nv_Specular+=spe;\n#endif\n \n#ifdef POINTLIGHT\ncomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,positionWorld,normal,toEye, dif, amb, spe);\nv_Diffuse+=dif;\nv_Ambient+=amb;\nv_Specular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\nComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,positionWorld,normal,toEye, dif, amb, spe);\nv_Diffuse+=dif;\nv_Ambient+=amb;\nv_Specular+=spe;\n#endif\n  \n#ifdef DIFFUSEMAP||((DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT)&&COLOR&&SPECULARMAP)\n  #ifdef MIXUV\n  v_Texcoord0=mix(a_Texcoord0,a_TexcoordNext0,u_UVAge);\n  #else\n  v_Texcoord0=a_Texcoord0;\n  #endif\n  #ifdef UVTRANSFORM\n  v_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n  #endif\n#endif\n\n#ifdef AMBIENTMAP\nv_Texcoord1=a_Texcoord1;\n#endif\n  \n#ifdef COLOR\nv_Color=a_Color;\n#endif\n}',n="#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Luminance;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n\n#ifdef DIFFUSEMAP||((DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT)&&COLOR&&SPECULARMAP)\nvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef AMBIENTMAP\nvarying vec2 v_Texcoord1;\nuniform sampler2D u_AmbientTexture;\n#endif\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||AMBIENTMAP\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT\nvarying vec3 v_Diffuse;\nvarying vec3 v_Ambient;\nvarying vec3 v_Specular;\n  #ifdef (DIFFUSEMAP||COLOR)&&SPECULARMAP\n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#ifdef FOG\nuniform float u_FogStart;\nuniform float u_FogRange;\nuniform vec3 u_FogColor;\nvarying float v_ToEyeLength;\n#endif\n\n#ifdef MIXUV\nuniform float  u_UVAniAge;\n#endif\n\n#ifdef REFLECTMAP\nvarying vec3 v_Normal;\nvarying vec3 v_ToEye;\n#endif\n\n\nvoid main()\n{\n #ifdef DIFFUSEMAP&&!COLOR\n gl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n #endif \n \n #ifdef COLOR&&!DIFFUSEMAP\n gl_FragColor=v_Color;\n #endif \n \n #ifdef DIFFUSEMAP&&COLOR\n vec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n gl_FragColor=texColor*v_Color;\n #endif\n \n #ifdef !DIFFUSEMAP&&!COLOR\n gl_FragColor=vec4(1.0,1.0,1.0,1.0);\n #endif \n \n #ifdef AMBIENTMAP\n gl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_Texcoord1).rgb);\n #endif \n \n gl_FragColor.rgb=gl_FragColor.rgb*u_Luminance;\n  \n #ifdef ALPHATEST\n   if(gl_FragColor.a-u_AlphaTestValue<0.0)\n    discard;\n #endif\n \n \n #ifdef REFLECTMAP\n vec3 normal=normalize(v_Normal);\n #endif 	\n\n  \n #ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT\n   #ifdef (DIFFUSEMAP||COLOR)&&SPECULARMAP\n   vec3 specular =v_Specular*texture2D(u_SpecularTexture,v_Texcoord0).rgb;\n   gl_FragColor =vec4( gl_FragColor.rgb*(v_Ambient + v_Diffuse)+specular,gl_FragColor.a);\n   #else\n   gl_FragColor =vec4( gl_FragColor.rgb*(v_Ambient + v_Diffuse)+v_Specular,gl_FragColor.a);\n   #endif\n #endif\n \n #ifdef REFLECTMAP\n vec3 incident = -v_ToEye;\n vec3 reflectionVector = reflect(incident,v_Normal);\n vec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n gl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n #endif\n \n #ifdef FOG\n float lerpFact=clamp((v_ToEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n gl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n #endif\n}\n\n",C.preCompile(t.SIMPLE,4096,e,n,i),e='#include?VR "VRHelper.glsl";\nattribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#ifdef DIFFUSEMAP||((DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT)&&(COLOR&&SPECULARMAP||NORMALMAP))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef MIXUV\n  attribute vec2 a_TexcoordNext0;\n  uniform float  u_UVAge;\n  #endif\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#ifdef AMBIENTMAP\nattribute vec2 a_Texcoord1;\nvarying vec2 v_Texcoord1;\n#endif\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||REFLECTMAP\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#ifdef (DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||REFLECTMAP)&&NORMALMAP\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||FOG||REFLECTMAP\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\n\nvoid main()\n{\n #ifdef BONE\n mat4 skinTransform=mat4(0.0);\n skinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n vec4 position=skinTransform*a_Position;\n   #ifdef VR\n   gl_Position = DistortFishEye(u_MvpMatrix * position);\n   #else\n   gl_Position = u_MvpMatrix * position;\n   #endif\n #else\n   #ifdef VR\n   gl_Position = DistortFishEye(u_MvpMatrix * a_Position);\n   #else\n   gl_Position = u_MvpMatrix * a_Position;\n   #endif\n #endif\n \n\n #ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||REFLECTMAP\n mat3 worldMat;\n   #ifdef BONE\n   worldMat=mat3(u_WorldMat*skinTransform);\n   #else\n   worldMat=mat3(u_WorldMat);\n   #endif  \n v_Normal=worldMat*a_Normal;\n   #ifdef (DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT)&&NORMALMAP\n   v_Tangent0=worldMat*a_Tangent0;\n   #endif\n #endif\n \n #ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||FOG\n   #ifdef BONE\n   v_PositionWorld=(u_WorldMat*position).xyz;\n   #else\n   v_PositionWorld=(u_WorldMat*a_Position).xyz;\n   #endif\n #endif\n \n#ifdef DIFFUSEMAP||((DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT)&&(COLOR&&SPECULARMAP||NORMALMAP))\n  #ifdef MIXUV\n  v_Texcoord0=mix(a_Texcoord0,a_TexcoordNext0,u_UVAge);\n  #else\n  v_Texcoord0=a_Texcoord0;\n  #endif\n  #ifdef UVTRANSFORM\n  v_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n  #endif\n#endif\n\n#ifdef AMBIENTMAP\nv_Texcoord1=a_Texcoord1;\n#endif\n\n  \n#ifdef COLOR\nv_Color=a_Color;\n#endif\n}',n='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include?DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT "LightHelper.glsl";\n\nuniform float u_Luminance;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#ifdef DIFFUSEMAP||((DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT)&&(COLOR&&SPECULARMAP||NORMALMAP))\nvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef AMBIENTMAP\nvarying vec2 v_Texcoord1;\nuniform sampler2D u_AmbientTexture;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #ifdef (DIFFUSEMAP||COLOR)&&SPECULARMAP \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||AMBIENTMAP\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#ifdef FOG\nuniform float u_FogStart;\nuniform float u_FogRange;\nuniform vec3 u_FogColor;\n#endif\n\n#ifdef MIXUV\nuniform float  u_UVAniAge;\n#endif\n\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||REFLECTMAP\nvarying vec3 v_Normal;\n#endif\n\n#ifdef (DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT)&&NORMALMAP\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\n\n#ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||FOG||REFLECTMAP\nuniform vec3 u_CameraPos;\nvarying vec3 v_PositionWorld;\n#endif\n\n\nvoid main()\n{\n  #ifdef DIFFUSEMAP&&!COLOR\n  gl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n  #endif \n  \n  #ifdef COLOR&&!DIFFUSEMAP\n  gl_FragColor=v_Color;\n  #endif \n  \n  #ifdef DIFFUSEMAP&&COLOR\n  vec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n  gl_FragColor=texColor*v_Color;\n  #endif\n  \n  #ifdef !DIFFUSEMAP&&!COLOR\n  gl_FragColor=vec4(1.0,1.0,1.0,1.0);\n  #endif \n  \n  #ifdef AMBIENTMAP\n  gl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_Texcoord1).rgb);\n  #endif \n  \n  gl_FragColor.rgb=gl_FragColor.rgb*u_Luminance;\n  \n  #ifdef ALPHATEST\n  if(gl_FragColor.a-u_AlphaTestValue<0.0)\n    discard;\n  #endif\n  \n  \n  #ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||REFLECTMAP\n  vec3 normal;\n    #ifdef (DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT)&&NORMALMAP\n    vec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n	normal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n	#else\n	normal = normalize(v_Normal);\n    #endif\n  #endif\n	\n  #ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT\n  vec3 diffuse = vec3(0.0);\n  vec3 ambient = vec3(0.0);\n  vec3 specular= vec3(0.0);\n  vec3 dif, amb, spe;\n  #endif\n  \n  #ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT||FOG||REFLECTMAP\n  vec3 toEye;\n    #ifdef FOG\n	toEye=u_CameraPos-v_PositionWorld;\n    float toEyeLength=length(toEye);\n    toEye/=toEyeLength;\n    #else\n	toEye=normalize(u_CameraPos-v_PositionWorld);\n    #endif\n  #endif\n	\n  #ifdef DIRECTIONLIGHT\n  computeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,normal,toEye, dif, amb, spe);\n  diffuse+=dif;\n  ambient+=amb;\n  specular+=spe;\n  #endif\n \n  #ifdef POINTLIGHT\n  computePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,v_PositionWorld,normal,toEye, dif, amb, spe);\n  diffuse+=dif;\n  ambient+=amb;\n  specular+=spe;\n  #endif\n\n  #ifdef SPOTLIGHT\n  ComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,v_PositionWorld,normal,toEye, dif, amb, spe);\n  diffuse+=dif;\n  ambient+=amb;\n  specular+=spe;\n  #endif\n  \n\n  \n  \n  \n  #ifdef DIRECTIONLIGHT||POINTLIGHT||SPOTLIGHT\n    #ifdef (DIFFUSEMAP||COLOR)&&SPECULARMAP\n    specular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n  gl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n  #endif\n  \n  #ifdef REFLECTMAP\n  vec3 incident = -toEye;\n  vec3 reflectionVector = reflect(incident,normal);\n  vec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n  gl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n  #endif\n  \n  #ifdef FOG\n  float lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n  gl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n  #endif\n}\n\n',C.preCompile(t.SIMPLE,8192,e,n,i),i={a_Position:"POSITION",a_Texcoord:"UV",u_FogStart:"FOGSTART",u_FogRange:"FOGRANGE",u_FogColor:"FOGCOLOR",u_WorldMat:"MATRIX1",u_CameraPos:"CAMERAPOS",u_BlendTexture:"DIFFUSETEXTURE",u_LayerTexture0:"NORMALTEXTURE",u_LayerTexture1:"SPECULARTEXTURE",u_LayerTexture2:"EMISSIVETEXTURE",u_LayerTexture3:"AMBIENTTEXTURE",u_MvpMatrix:"MVPMATRIX",u_Luminance:"LUMINANCE",u_Ambient:"MATERIALAMBIENT",u_UVMatrix:"MATRIX2"},e='#include?VR "VRHelper.glsl";\nattribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_UVMatrix;\n\n#ifdef DIFFUSEMAP&&NORMALMAP&&SPECULARMAP&&EMISSIVEMAP&&AMBIENTMAP\nattribute vec2 a_Texcoord;\nvarying vec2 v_Texcoord;\nvarying vec2 v_TiledTexcoord;\n#endif\n\n#ifdef FOG\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\n\nvoid main()\n{\n #ifdef VR\n gl_Position = DistortFishEye(u_MvpMatrix * a_Position);\n #else\n gl_Position = u_MvpMatrix * a_Position;\n #endif\n \n #ifdef FOG\n v_PositionWorld=(u_WorldMat*a_Position).xyz;\n #endif\n \n #ifdef DIFFUSEMAP&&NORMALMAP&&SPECULARMAP&&EMISSIVEMAP&&AMBIENTMAP\n v_Texcoord=a_Texcoord;\n v_TiledTexcoord=(u_UVMatrix*vec4(a_Texcoord,0.0,1.0)).xy;\n #endif\n}',n="#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Luminance;\nuniform vec3 u_Ambient;\n\n#ifdef FOG\nuniform vec3 u_CameraPos;\nvarying vec3 v_PositionWorld;\n\nuniform float u_FogStart;\nuniform float u_FogRange;\nuniform vec3 u_FogColor;\n#endif\n\n#ifdef DIFFUSEMAP&&NORMALMAP&&SPECULARMAP&&EMISSIVEMAP&&AMBIENTMAP\n  varying vec2 v_Texcoord;\n  varying vec2 v_TiledTexcoord;\n  uniform sampler2D u_BlendTexture;\n  uniform sampler2D u_LayerTexture0;\n  uniform sampler2D u_LayerTexture1;\n  uniform sampler2D u_LayerTexture2;\n  uniform sampler2D u_LayerTexture3;\n#endif\n\nvoid main()\n{	\n  #ifdef DIFFUSEMAP&&NORMALMAP&&SPECULARMAP&&EMISSIVEMAP&&AMBIENTMAP\n  vec4 blend=texture2D(u_BlendTexture, v_Texcoord);\n  vec4 c0=texture2D(u_LayerTexture0, v_TiledTexcoord);\n  vec4 c1=texture2D(u_LayerTexture1, v_TiledTexcoord);\n  vec4 c2=texture2D(u_LayerTexture2, v_TiledTexcoord);\n  vec4 c3=texture2D(u_LayerTexture3, v_TiledTexcoord);\n  vec4 texColor = c0;\n  texColor = mix(texColor, c1, blend.r);\n  texColor = mix(texColor, c2, blend.g);\n  texColor = mix(texColor, c3, blend.b);\n  gl_FragColor=vec4(texColor.rgb*u_Ambient.rgb*blend.a*u_Luminance,1.0);\n  #endif \n  \n  #ifdef FOG\n  vec3 toEye=u_CameraPos-v_PositionWorld;\n  float toEyeLength=length(toEye);\n  \n  float lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n  gl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n  #endif\n}\n\n",C.preCompile(t.TERRAIN,4096,e,n,i),C.preCompile(t.TERRAIN,8192,e,n,i),i={a_CornerTextureCoordinate:"CORNERTEXTURECOORDINATE",a_Position:"POSITION",a_Velocity:"VELOCITY",a_StartColor:"STARTCOLOR",a_EndColor:"ENDCOLOR",a_SizeRotation:"SIZEROTATION",a_Radius:"RADIUS",a_Radian:"RADIAN",a_AgeAddScale:"AGEADDSCALE",a_Time:"TIME",u_WorldMat:"MVPMATRIX",u_View:"MATRIX1",u_Projection:"MATRIX2",u_ViewportScale:"VIEWPORTSCALE",u_CurrentTime:"CURRENTTIME",u_Duration:"DURATION",u_Gravity:"GRAVITY",u_EndVelocity:"ENDVELOCITY",u_texture:"DIFFUSETEXTURE"},C.preCompile(t.PARTICLE,4096,v.vs,v.ps,i),C.preCompile(t.PARTICLE,8192,v.vs,v.ps,i),i={a_CornerTextureCoordinate:"CORNERTEXTURECOORDINATE",a_Position:"POSITION",a_Velocity:"VELOCITY",a_StartColor:"STARTCOLOR",a_EndColor:"ENDCOLOR",a_SizeRotation:"SIZEROTATION",a_Radius:"RADIUS",a_Radian:"RADIAN",a_AgeAddScale:"AGEADDSCALE",a_Time:"TIME",u_WorldMat:"MVPMATRIX",u_View:"MATRIX1",u_Projection:"MATRIX2",u_ViewportScale:"VIEWPORTSCALE",u_CurrentTime:"CURRENTTIME",u_Duration:"DURATION",u_Gravity:"GRAVITY",u_EndVelocity:"ENDVELOCITY",u_texture:"DIFFUSETEXTURE"},C.preCompile(t.U3DPARTICLE,4096,v.vs,v.ps,i),C.preCompile(t.U3DPARTICLE,8192,v.vs,v.ps,i),i={a_Position:"POSITION",a_Texcoord0:"UV",a_Time:"TIME",u_Texture:"DIFFUSETEXTURE",u_MvpMatrix:"MVPMATRIX",u_Luminance:"LUMINANCE",u_CurrentTime:"CURRENTTIME",u_Color:"UNICOLOR",u_Duration:"DURATION"},e="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\nattribute float a_Time;\n\nuniform mat4 u_MvpMatrix;\nuniform  float u_CurrentTime;\nuniform  vec4 u_Color;\nuniform float u_Duration;\n\nvarying vec2 v_Texcoord;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n  gl_Position = u_MvpMatrix * a_Position;\n  \n  float age = u_CurrentTime-a_Time;\n  float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   \n  v_Texcoord=a_Texcoord0;\n  \n  v_Color=u_Color;\n  v_Color.a*=1.0-normalizedAge;\n}\n",n="#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Luminance;\nuniform sampler2D u_Texture;\n\nvarying vec2 v_Texcoord;\nvarying vec4 v_Color;\n\n\nvoid main()\n{	\n  gl_FragColor=texture2D(u_Texture, v_Texcoord)*v_Color;\n  gl_FragColor.rgb=gl_FragColor.rgb*u_Luminance;\n}\n\n",C.preCompile(t.GLITTER,4096,e,n,i),C.preCompile(t.GLITTER,8192,e,n,i),i={a_Position:"POSITION",a_Color:"COLOR",a_Texcoord0:"UV",a_TexcoordNext0:"NEXTUV",a_Texcoord1:"UV1",a_TexcoordNext1:"NEXTUV1",u_DiffuseTexture:"DIFFUSETEXTURE",u_SpecularTexture:"SPECULARTEXTURE",u_MvpMatrix:"MVPMATRIX",u_FogStart:"FOGSTART",u_FogRange:"FOGRANGE",u_FogColor:"FOGCOLOR",u_Luminance:"LUMINANCE",u_UVAge:"FLOAT0",u_UVAniAge:"UVAGEX"},e="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n#ifdef DIFFUSEMAP\nattribute vec2 a_Texcoord0;\nattribute vec2 a_Texcoord1;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n#ifdef MIXUV\nattribute vec2 a_TexcoordNext0;\nattribute vec2 a_TexcoordNext1;\nuniform float  u_UVAge;\n#endif\n#endif\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n\nvoid main()\n{\n gl_Position = u_MvpMatrix * a_Position;\n \n \n #ifdef DIFFUSEMAP\n  #ifdef MIXUV\n  v_Texcoord0=mix(a_Texcoord0,a_TexcoordNext0,u_UVAge);\n   v_Texcoord1=mix(a_Texcoord1,a_TexcoordNext1,u_UVAge);\n  #else\n  v_Texcoord0=a_Texcoord0;\n  v_Texcoord1=a_Texcoord1;\n  #endif\n #endif\n  \n #ifdef COLOR\n v_Color=a_Color;\n #endif\n}",n="#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Luminance;\n\n#ifdef DIFFUSEMAP\nvarying vec2 v_Texcoord0;\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef SPECULARMAP \nvarying vec2 v_Texcoord1;\nuniform sampler2D u_SpecularTexture;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n\n\n#ifdef FOG\nuniform float u_FogStart;\nuniform float u_FogRange;\nuniform vec3 u_FogColor;\n#endif\n\nvoid main()\n{\n  \n  #ifdef DIFFUSEMAP&&!COLOR\n  gl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n  #endif \n  \n  #ifdef COLOR&&!DIFFUSEMAP\n  gl_FragColor=v_Color;\n  #endif \n  \n  #ifdef DIFFUSEMAP&&COLOR\n  vec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n  gl_FragColor=texColor*v_Color;\n  #endif\n  \n  #ifdef SPECULARMAP \n  vec4 specularColor=texture2D(u_SpecularTexture, v_Texcoord1);\n  gl_FragColor=gl_FragColor*specularColor;\n  #endif\n \n  gl_FragColor.rgb=gl_FragColor.rgb*u_Luminance;\n  \n  #ifdef FOG\n  float lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n  gl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n  #endif\n}\n\n",C.preCompile(t.SIMPLE_EFFECT,4096,e,n,i),e="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n#ifdef DIFFUSEMAP\nattribute vec2 a_Texcoord0;\nattribute vec2 a_Texcoord1;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n#ifdef MIXUV\nattribute vec2 a_TexcoordNext0;\nattribute vec2 a_TexcoordNext1;\nuniform float  u_UVAge;\n#endif\n#endif\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n\nvoid main()\n{\n gl_Position = u_MvpMatrix * a_Position;\n \n \n #ifdef DIFFUSEMAP\n  #ifdef MIXUV\n  v_Texcoord0=mix(a_Texcoord0,a_TexcoordNext0,u_UVAge);\n   v_Texcoord1=mix(a_Texcoord1,a_TexcoordNext1,u_UVAge);\n  #else\n  v_Texcoord0=a_Texcoord0;\n  v_Texcoord1=a_Texcoord1;\n  #endif\n #endif\n  \n #ifdef COLOR\n v_Color=a_Color;\n #endif\n}",n="#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Luminance;\n\n#ifdef DIFFUSEMAP\nvarying vec2 v_Texcoord0;\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef SPECULARMAP \nvarying vec2 v_Texcoord1;\nuniform sampler2D u_SpecularTexture;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n\n\n#ifdef FOG\nuniform float u_FogStart;\nuniform float u_FogRange;\nuniform vec3 u_FogColor;\n#endif\n\nvoid main()\n{\n  \n  #ifdef DIFFUSEMAP&&!COLOR\n  gl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n  #endif \n  \n  #ifdef COLOR&&!DIFFUSEMAP\n  gl_FragColor=v_Color;\n  #endif \n  \n  #ifdef DIFFUSEMAP&&COLOR\n  vec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n  gl_FragColor=texColor*v_Color;\n  #endif\n  \n  #ifdef SPECULARMAP \n  vec4 specularColor=texture2D(u_SpecularTexture, v_Texcoord1);\n  gl_FragColor=gl_FragColor*specularColor;\n  #endif\n \n  gl_FragColor.rgb=gl_FragColor.rgb*u_Luminance;\n  \n  #ifdef FOG\n  float lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n  gl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n  #endif\n}\n\n",C.preCompile(t.SIMPLE_EFFECT,8192,e,n,i)},t.SIMPLE=0,t.TERRAIN=0,t.PARTICLE=0,t.U3DPARTICLE=0,t.GLITTER=0,t.SIMPLE_EFFECT=0,t}()),Ct=(function(){function t(){}return r(t,"laya.d3.utils.Picker"),t.CalculateCursorRay=function(t,e,n,i,r){var a=t.elements[0],s=t.elements[1],o=new vt(a,s,e.minDepth),h=new vt(a,s,e.maxDepth),l=e.unprojectFromWVP(o,n,i,r),u=e.unprojectFromWVP(h,n,i,r),_=new vt(u.x-l.x,u.y-l.y,u.z-l.z);return vt.normalize(_,_),new mt(l,_)},t.RayIntersectsTriangle=function(t,e,n,i){var r,a=new vt,s=new vt;vt.subtract(n,e,a),vt.subtract(i,e,s);var o=new vt;vt.cross(t.direction,s,o);var h;if(h=vt.dot(a,o),h>-Number.MIN_VALUE&&h<Number.MIN_VALUE)return r=Number.NaN;var l=1/h,u=new vt;vt.subtract(t.origin,e,u);var _;if(_=vt.dot(u,o),_*=l,0>_||_>1)return r=Number.NaN;var c=new vt;vt.cross(u,a,c);var d;if(d=vt.dot(t.direction,c),d*=l,0>d||_+d>1)return r=Number.NaN;var f;return f=vt.dot(s,c),f*=l,r=0>f?Number.NaN:f},t}(),function(){function t(){}return r(t,"laya.d3.utils.Utils3D"),t._getTexturePath=function(t){var e=t.length-4;return t.indexOf(".dds")!=e&&t.indexOf(".tga")!=e&&t.indexOf(".exr")!=e&&t.indexOf(".DDS")!=e&&t.indexOf(".TGA")!=e&&t.indexOf(".EXR")!=e||(t=t.substr(0,e)+".png"),t=V.formatURL(t)},t.GenerateTangent=function(e,n,i,r,a){for(var s=3,o=n+s,h=new Float32Array(o*(e.length/n)),l=0;l<a.length;l+=3){var u=a[l+0],_=a[l+1],c=a[l+2],d=n*u+i,f=t._tempVector3_0;f.x=e[d+0],f.y=e[d+1],f.z=e[d+2];var m=n*_+i,p=t._tempVector3_1;p.x=e[m+0],p.y=e[m+1],p.z=e[m+2];var v=n*c+i,g=t._tempVector3_2;g.x=e[v+0],g.y=e[v+1],g.z=e[v+2];var x=n*u+r,T=e[x+0],I=e[x+1],D=n*_+r,C=e[D+0],M=e[D+1],E=n*c+r,y=e[E+0],A=e[E+1],V=t._tempVector3_3;vt.subtract(p,f,V);var b=t._tempVector3_4;vt.subtract(g,f,b),vt.scale(V,A-I,V),vt.scale(b,M-I,b);var w=t._tempVector3_5;vt.subtract(V,b,w),vt.scale(w,1/((C-T)*(A-I)-(M-I)*(y-T)),w);var P=0;for(P=0;n>P;P++)h[o*u+P]=e[n*u+P];for(P=0;s>P;P++)h[o*u+n+P]=+w.elements[P];for(P=0;n>P;P++)h[o*_+P]=e[n*_+P];for(P=0;s>P;P++)h[o*_+n+P]=+w.elements[P];for(P=0;n>P;P++)h[o*c+P]=e[n*c+P];for(P=0;s>P;P++)h[o*c+n+P]=+w.elements[P]}for(l=0;l<h.length;l+=o){var R=o*l+n,L=t._tempVector3_6;L.x=h[R+0],L.y=h[R+1],L.z=h[R+2],vt.normalize(L,L),h[R+0]=L.x,h[R+1]=L.y,h[R+2]=L.z}return h},t.getVertexTangentDeclaration=function(t){for(var e=!1,n=!1,i=!1,r=!1,a=!1,s=!1,o=0;o<t.length;o++)switch(t[o].elementUsage){case"POSITION":e=!0;break;case"NORMAL":n=!0;break;case"COLOR":i=!0;break;case"UV":r=!0;break;case"BLENDWEIGHT":a=!0;break;case"BLENDINDICES":s=!0}var h;return e&&n&&i&&r&&a&&s?h=it.vertexDeclaration:e&&n&&r&&a&&s?h=lt.vertexDeclaration:e&&n&&i&&a&&s?h=K.vertexDeclaration:e&&n&&i&&r?h=rt.vertexDeclaration:e&&n&&r?h=ut.vertexDeclaration:e&&n&&i&&(h=J.vertexDeclaration),h},t._parseHierarchyProp=function(t,e,n){switch(e){case"translate":t.transform.localPosition=new vt(n[0],n[1],n[2]);break;case"rotation":t.transform.localRotation=new ft(n[0],n[1],n[2],n[3]);break;case"scale":t.transform.localScale=new vt(n[0],n[1],n[2])}},t._parseHierarchyNode=function(t){return t?new Ot(Ft.load(t.loadPath)):new At},t._parseMaterial=function(e,i,r){switch(i){case"ambientColor":e.ambientColor=new vt(r[0],r[1],r[2]);break;case"diffuseColor":e.diffuseColor=new vt(r[0],r[1],r[2]);break;case"specularColor":e.specularColor=new gt(r[0],r[1],r[2],r[3]);break;case"reflectColor":e.reflectColor=new vt(r[0],r[1],r[2]);break;case"diffuseTexture":r.texture2D&&n.loader.load(t._getTexturePath(r.texture2D),c.create(null,function(t){t.bitmap.enableMerageInAtlas=!1,t.bitmap.mipmap=!0,e.diffuseTexture=t}));break;case"normalTexture":r.texture2D&&n.loader.load(t._getTexturePath(r.texture2D),c.create(null,function(t){t.bitmap.enableMerageInAtlas=!1,t.bitmap.mipmap=!0,e.normalTexture=t}));break;case"specularTexture":r.texture2D&&n.loader.load(t._getTexturePath(r.texture2D),c.create(null,function(t){t.bitmap.enableMerageInAtlas=!1,t.bitmap.mipmap=!0,e.specularTexture=t}));break;case"emissiveTexture":r.texture2D&&n.loader.load(t._getTexturePath(r.texture2D),c.create(null,function(t){t.bitmap.enableMerageInAtlas=!1,t.bitmap.mipmap=!0,e.emissiveTexture=t}));break;case"ambientTexture":r.texture2D&&n.loader.load(t._getTexturePath(r.texture2D),c.create(null,function(t){t.bitmap.enableMerageInAtlas=!1,t.bitmap.mipmap=!0,e.ambientTexture=t}));break;case"reflectTexture":r.texture2D&&n.loader.load(t._getTexturePath(r.texture2D),c.create(null,function(t){t.bitmap.enableMerageInAtlas=!1,t.bitmap.mipmap=!0,e.reflectTexture=t}))}},t._computeSkinAnimationData=function(t,e,n,i,r){var a,s,o=0,h=0,l=n.length/2,u=t.length;for(a=0;u>a;o+=t[a].keyframeWidth,h+=16,a++)laya.d3.utils.Utils3D.rotationTransformScale(e[o+7],e[o+8],e[o+9],e[o+3],e[o+4],e[o+5],e[o+6],e[o+0],e[o+1],e[o+2],i,h),0!=a&&(s=16*t[a].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(i,s,i,h,i,h));for(a=0;l>a;a+=16)laya.d3.utils.Utils3D.mulMatrixByArrayFast(i,a,n,l+a,r,a)},t.mulMatrixByArray=function(e,n,i,r,a,s){var o,h,l,u,_;if(a===i){for(i=t._tempArray16_3,o=0;16>o;++o)i[o]=a[s+o];r=0}for(o=0;4>o;o++)h=e[n+o],l=e[n+o+4],u=e[n+o+8],_=e[n+o+12],a[s+o]=h*i[r+0]+l*i[r+1]+u*i[r+2]+_*i[r+3],a[s+o+4]=h*i[r+4]+l*i[r+5]+u*i[r+6]+_*i[r+7],a[s+o+8]=h*i[r+8]+l*i[r+9]+u*i[r+10]+_*i[r+11],a[s+o+12]=h*i[r+12]+l*i[r+13]+u*i[r+14]+_*i[r+15]},t.mulMatrixByArrayFast=function(t,e,n,i,r,a){var s,o,h,l,u;for(s=0;4>s;s++)o=t[e+s],h=t[e+s+4],l=t[e+s+8],u=t[e+s+12],r[a+s]=o*n[i+0]+h*n[i+1]+l*n[i+2]+u*n[i+3],r[a+s+4]=o*n[i+4]+h*n[i+5]+l*n[i+6]+u*n[i+7],r[a+s+8]=o*n[i+8]+h*n[i+9]+l*n[i+10]+u*n[i+11],r[a+s+12]=o*n[i+12]+h*n[i+13]+l*n[i+14]+u*n[i+15]},t.rotationTransformScale=function(e,n,i,r,a,s,o,h,l,u,_,c){var d=t._tempArray16_0,f=t._tempArray16_1,m=t._tempArray16_2,p=r+r,v=a+a,g=s+s,x=r*p,T=a*p,I=a*v,D=s*p,C=s*v,M=s*g,E=o*p,y=o*v,A=o*g;d[15]=1,d[0]=1-I-M,d[1]=T+A,d[2]=D-y,d[4]=T-A,d[5]=1-x-M,d[6]=C+E,d[8]=D+y,d[9]=C-E,d[10]=1-x-I,f[15]=1,f[0]=h,f[5]=l,f[10]=u;var V,b,w,P,R;for(V=0;4>V;V++)b=d[V],w=d[V+4],P=d[V+8],R=d[V+12],m[V]=b,m[V+4]=w,m[V+8]=P,m[V+12]=b*e+w*n+P*i+R;for(V=0;4>V;V++)b=m[V],w=m[V+4],P=m[V+8],R=m[V+12],_[V+c]=b*f[0]+w*f[1]+P*f[2]+R*f[3],_[V+c+4]=b*f[4]+w*f[5]+P*f[6]+R*f[7],_[V+c+8]=b*f[8]+w*f[9]+P*f[10]+R*f[11],_[V+c+12]=b*f[12]+w*f[13]+P*f[14]+R*f[15]},t.transformVector3ArrayToVector3ArrayCoordinate=function(e,n,i,r,a){var s=t._tempArray4_0,o=e[n+0],h=e[n+1],l=e[n+2],u=i.elements;s[0]=o*u[0]+h*u[4]+l*u[8]+u[12],s[1]=o*u[1]+h*u[5]+l*u[9]+u[13],s[2]=o*u[2]+h*u[6]+l*u[10]+u[14],s[3]=1/(o*u[3]+h*u[7]+l*u[11]+u[15]),r[a+0]=s[0]*s[3],r[a+1]=s[1]*s[3],
r[a+2]=s[2]*s[3]},t._tempVector3_0=new vt,t._tempVector3_1=new vt,t._tempVector3_2=new vt,t._tempVector3_3=new vt,t._tempVector3_4=new vt,t._tempVector3_5=new vt,t._tempVector3_6=new vt,t._tempArray4_0=new Float32Array(4),t._tempArray16_0=new Float32Array(16),t._tempArray16_1=new Float32Array(16),t._tempArray16_2=new Float32Array(16),t._tempArray16_3=new Float32Array(16),i(t,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}}]),t}()),Mt=function(t){function e(){this._id=0,this._cachedOwnerLayerMask=0,this._cachedOwnerEnable=!1,this._enable=!1,this._owner=null,this.started=!1,e.__super.call(this),this._id=e._uniqueIDCounter,e._uniqueIDCounter++}r(e,"laya.d3.component.Component3D",t);var i=e.prototype;return n.imps(i,{"laya.d3.core.render.IUpdate":!0}),i._onLayerChanged=function(t){this._cachedOwnerLayerMask=t},i._onEnableChanged=function(t){this._cachedOwnerEnable=t},i._initialize=function(t){this._owner=t,this.enable=!0,this.started=!1,this._cachedOwnerLayerMask=t.layer.mask,this._owner.on("layerchanged",this,this._onLayerChanged),this._cachedOwnerEnable=t.enable,this._owner.on("enabledchanged",this,this._onEnableChanged),this._load(t)},i._uninitialize=function(){this._unload(this.owner),this._owner.off("layerchanged",this,this._onLayerChanged),this._owner.off("enabledchanged",this,this._onEnableChanged),this._owner=null},i._load=function(t){},i._start=function(t){},i._update=function(t){},i._lateUpdate=function(t){},i._preRenderUpdate=function(t){},i._postRenderUpdate=function(t){},i._unload=function(t){},a(0,i,"id",function(){return this._id}),a(0,i,"owner",function(){return this._owner}),a(0,i,"enable",function(){return this._enable},function(t){this._enable!==t&&(this._enable=t,this.event("enabledchanged",this._enable))}),a(0,i,"isActive",function(){return N.isActive(this._cachedOwnerLayerMask)&&this._cachedOwnerEnable&&this._enable}),a(0,i,"isVisible",function(){return N.isVisible(this._cachedOwnerLayerMask)&&this._cachedOwnerEnable&&this._enable}),e.__init__=function(){},e._uniqueIDCounter=1,e}(_),Et=function(t){function e(){this._texturesloaded=!1,this._shader=null,this._sharderNameID=0,this._disableDefine=0,this._color=[],this._transparent=!1,this._transparentMode=0,this._alphaTestValue=.5,this._luminance=1,this._transformUV=null,this._shaderDef=0,this._id=0,this.name=null,this.cullFace=!0,this.transparentAddtive=!1,this.isSky=!1,this.loaded=!1,e.__super.call(this),this._textures=[],this._texturesSharderIndex=[],this._otherSharderIndex=[],this._shaderValues=new b,this._id=++e._uniqueIDCounter,this._color[0]=e.AMBIENTCOLORVALUE,this._color[1]=e.DIFFUSECOLORVALUE,this._color[2]=e.SPECULARCOLORVALUE,this._color[3]=e.REFLECTCOLORVALUE,this._pushShaderValue(0,"MATERIALAMBIENT",this._color[0].elements,this._id),this._pushShaderValue(1,"MATERIALDIFFUSE",this._color[1].elements,this._id),this._pushShaderValue(2,"MATERIALSPECULAR",this._color[2].elements,this._id),this._pushShaderValue(3,"MATERIALREFLECT",this._color[3].elements,this._id),this._pushShaderValue(5,"LUMINANCE",this._luminance,this._id),this.alphaTestValue=this._alphaTestValue}r(e,"laya.d3.core.material.Material",t);var n=e.prototype;return n._pushShaderValue=function(t,e,n,i){var r=this._shaderValues,a=this._otherSharderIndex[t];return a||(a=r.length+1,r.pushValue(e,null,-1),this._otherSharderIndex[t]=a),r.data[a][0]=n,r.data[a][1]=i,a},n._getShaderDefineValue=function(){return this._shaderDef=0,this.diffuseTexture&&(this._shaderDef|=1),this.normalTexture&&(this._shaderDef|=2),this.specularTexture&&(this._shaderDef|=4),this.emissiveTexture&&(this._shaderDef|=8),this.ambientTexture&&(this._shaderDef|=16),this.reflectTexture&&(this._shaderDef|=262144),this._transformUV&&(this._shaderDef|=16384),this._transparent&&0===this._transparentMode&&(this._shaderDef|=2048),this._shaderDef},n._setTexture=function(t,e,n){var i=this._texturesSharderIndex[e];return!i&&t&&(i=this._shaderValues.length+1,this._shaderValues.pushValue(n,null,-1),this._texturesSharderIndex[e]=i),t&&(this._texturesloaded=!1),this._textures[e]=t,i},n._loadeCompleted=function(){return this._texturesloaded?!0:this.diffuseTexture&&!this.diffuseTexture.loaded?!1:this.normalTexture&&!this.normalTexture.loaded?!1:this.specularTexture&&!this.specularTexture.loaded?!1:this.emissiveTexture&&!this.emissiveTexture.loaded?!1:this.ambientTexture&&!this.ambientTexture.loaded?!1:this.reflectTexture&&!this.reflectTexture.loaded?!1:(this.diffuseTexture&&this._uploadTexture(0,this.diffuseTexture),this.normalTexture&&this._uploadTexture(1,this.normalTexture),this.specularTexture&&this._uploadTexture(2,this.specularTexture),this.emissiveTexture&&this._uploadTexture(3,this.emissiveTexture),this.ambientTexture&&this._uploadTexture(4,this.ambientTexture),this.reflectTexture&&this._uploadTexture(5,this.reflectTexture),this._texturesloaded=!0)},n._uploadTexture=function(t,e){var n=this._shaderValues,i=n.data[this._texturesSharderIndex[t]];i[0]=e.source,i[1]=e.bitmap.id},n.getTextureByIndex=function(t){return this._textures[t]},n.getShader=function(t){var e=t.shaderDefs,n=e._value;this._disableDefine&&(e._value=n&~this._disableDefine);var i=(e._value|t.shadingMode)+2e-4*this._sharderNameID;return this._shader=C.withCompile(this._sharderNameID,t.shadingMode,e.toNameDic(),i,null),e._value=n,this._shader},n.upload=function(t,e,n){if(!this._loadeCompleted())return!1;n||(n=this.getShader(t));var i=this._shaderValues,r=i.length;return i.pushArray(t.shaderValue),n.tag._uploadMaterialID!=y.loopCount&&(n.tag._uploadMaterialID=y.loopCount,i.pushArray(t.worldShaderValue)),n.uploadArray(i.data,i.length,e),i.length=r,!0},n.disableLight=function(){this._disableDefine|=448},n.disableDefine=function(t){this._disableDefine=t},n.setShaderName=function(t){this._sharderNameID=C.nameKey.get(t)},n.copy=function(t){return t._sharderNameID=this._sharderNameID,t._shader=this._shader,t._texturesloaded=this._texturesloaded,t._textures=this._textures,t._texturesSharderIndex=this._texturesSharderIndex,t._otherSharderIndex=this._otherSharderIndex,t._disableDefine=this._disableDefine,t._color=this._color,t._transparent=this._transparent,t._transparentMode=this._transparentMode,t._alphaTestValue=this._alphaTestValue,t.transparentAddtive=this.transparentAddtive,t.cullFace=this.cullFace,t._transformUV=this._transformUV,this._shaderValues.copyTo(t._shaderValues),t},a(0,n,"id",function(){return this._id}),a(0,n,"reflectTexture",function(){return this._textures[5]},function(t){this._setTexture(t,5,"REFLECTTEXTURE"),this._getShaderDefineValue()}),a(0,n,"specularTexture",function(){return this._textures[2]},function(t){this._setTexture(t,2,"SPECULARTEXTURE"),this._getShaderDefineValue()}),a(0,n,"shaderDef",function(){return this._shaderDef}),a(0,n,"transparent",function(){return this._transparent},function(t){this._transparent=t,this.alphaTestValue=this._alphaTestValue,this._getShaderDefineValue()}),a(0,n,"alphaTestValue",function(){return this._alphaTestValue},function(t){this._alphaTestValue=t,this._pushShaderValue(7,"ALPHATESTVALUE",this._transparent&&0===this._transparentMode?this._alphaTestValue:null,this._id)}),a(0,n,"transparentMode",function(){return this._transparentMode},function(t){this._transparentMode=t,this.alphaTestValue=this._alphaTestValue,this._getShaderDefineValue()}),a(0,n,"diffuseTexture",function(){return this._textures[0]},function(t){this._setTexture(t,0,"DIFFUSETEXTURE"),this._getShaderDefineValue()}),a(0,n,"luminance",null,function(t){this._luminance=t,this._pushShaderValue(5,"LUMINANCE",this._luminance,this._id)}),a(0,n,"normalTexture",function(){return this._textures[1]},function(t){this._setTexture(t,1,"NORMALTEXTURE"),this._getShaderDefineValue()}),a(0,n,"emissiveTexture",function(){return this._textures[3]},function(t){this._setTexture(t,3,"EMISSIVETEXTURE"),this._getShaderDefineValue()}),a(0,n,"ambientTexture",function(){return this._textures[4]},function(t){this._setTexture(t,4,"AMBIENTTEXTURE"),this._getShaderDefineValue()}),a(0,n,"texturesCount",function(){return this._textures.length}),a(0,n,"ambientColor",null,function(t){this._color[0]=t,this._pushShaderValue(0,"MATERIALAMBIENT",t.elements,this._id)}),a(0,n,"diffuseColor",null,function(t){this._color[1]=t,this._pushShaderValue(1,"MATERIALDIFFUSE",t.elements,this._id)}),a(0,n,"specularColor",null,function(t){this._color[2]=t,this._pushShaderValue(2,"MATERIALSPECULAR",t.elements,this._id)}),a(0,n,"reflectColor",null,function(t){this._color[3]=t,this._pushShaderValue(3,"MATERIALREFLECT",t.elements,this._id)}),a(0,n,"transformUV",function(){return this._transformUV},function(t){this._transformUV=t;var e=this._transformUV.matrix;this._pushShaderValue(6,"MATRIX2",e.elements,this._id),this._getShaderDefineValue()}),e._uniqueIDCounter=1,e.DIFFUSETEXTURE=0,e.NORMALTEXTURE=1,e.SPECULARTEXTURE=2,e.EMISSIVETEXTURE=3,e.AMBIENTTEXTURE=4,e.REFLECTTEXTURE=5,e.AMBIENTCOLOR=0,e.DIFFUSECOLOR=1,e.SPECULARCOLOR=2,e.REFLECTCOLOR=3,e.TRANSPARENT=4,e.LUMINANCE=5,e.TRANSFORMUV=6,e.ALPHATESTVALUE=7,i(e,["AMBIENTCOLORVALUE",function(){return this.AMBIENTCOLORVALUE=new vt(.6,.6,.6)},"DIFFUSECOLORVALUE",function(){return this.DIFFUSECOLORVALUE=new vt(1,1,1)},"SPECULARCOLORVALUE",function(){return this.SPECULARCOLORVALUE=new gt(1,1,1,8)},"REFLECTCOLORVALUE",function(){return this.REFLECTCOLORVALUE=new vt(1,1,1)}]),e}(_),yt=(function(t){function e(){this._rotation=0,this._matNeedUpdte=!1,e.__super.call(this),this._tempTitlingV3=new vt,this._tempRotationMatrix=new dt,this._tempTitlingMatrix=new dt,this._matrix=new dt,this._offset=new pt,this._tiling=new pt}r(e,"laya.d3.core.TransformUV",t);var n=e.prototype;return n._updateMatrix=function(){this._tempTitlingV3.elements[0]=this._tiling.x,this._tempTitlingV3.elements[1]=this._tiling.y,this._tempTitlingV3.elements[2]=1,dt.createScaling(this._tempTitlingV3,this._tempTitlingMatrix),dt.createRotationZ(this._rotation,this._tempRotationMatrix),dt.multiply(this._tempRotationMatrix,this._tempTitlingMatrix,this._matrix);var t=this._matrix.elements;t[12]=this._offset.x,t[13]=this._offset.y,t[14]=0},a(0,n,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),a(0,n,"offset",function(){return this._offset},function(t){this._offset=t,this._matNeedUpdte=!0}),a(0,n,"rotation",function(){return this._rotation},function(t){this._rotation=t,this._matNeedUpdte=!0}),a(0,n,"tiling",function(){return this._tiling},function(t){this._tiling=t,this._matNeedUpdte=!0}),e}(_),function(t){function e(t){this._settings=null,this._particle3D=null,e.__super.call(this),this._resultPosition=new vt,this._resultVelocity=new vt,this.centerPosition=new vt,this.size=new vt,this.velocity=new vt,this.velocityAddVariance=new vt,this._particle3D=t;for(var n=t.templet.settings,i=0;3>i;i++)this.centerPosition.elements[i]=n.boxEmitterCenterPosition[i],this.size.elements[i]=n.boxEmitterSize[i],this.velocity.elements[i]=n.boxEmitterVelocity[i],this.velocityAddVariance.elements[i]=n.boxEmitterVelocityAddVariance[i];this.emissionRate=n.emissionRate}r(e,"laya.d3.core.particle.EmitterBox",t);var n=e.prototype;return n._randomPositionOnBox=function(){var t=this._resultPosition.elements,e=this.centerPosition.elements,n=this.size.elements;return t[0]=e[0]+n[0]*(Math.random()-.5),t[1]=e[1]+n[1]*(Math.random()-.5),t[2]=e[2]+n[2]*(Math.random()-.5),this._resultPosition},n._randomVelocityOnBox=function(){var t=this._resultVelocity.elements,e=this.velocity.elements,n=this.velocityAddVariance.elements;return t[0]=e[0]+n[0]*Math.random(),t[1]=e[1]+n[1]*Math.random(),t[2]=e[2]+n[2]*Math.random(),this._resultVelocity},n.emit=function(){t.prototype.emit.call(this),this._particle3D.templet.addParticle(this._randomPositionOnBox(),this._randomVelocityOnBox())},n.update=function(t){this.advanceTime(t.elapsedTime/1e3)},e}(u),function(t){function e(t){this._settings=null,this._particle3D=null,e.__super.call(this),this._resultPosition=new vt,this._resultVelocity=new vt,this.position=new vt,this.positionVariance=new vt,this.velocity=new vt,this.velocityAddVariance=new vt,this._particle3D=t;for(var n=t.templet.settings,i=0;3>i;i++)this.position.elements[i]=n.pointEmitterPosition[i],this.positionVariance.elements[i]=n.pointEmitterPositionVariance[i],this.velocity.elements[i]=n.pointEmitterVelocity[i],this.velocityAddVariance.elements[i]=n.pointEmitterVelocityAddVariance[i];this.emissionRate=n.emissionRate}r(e,"laya.d3.core.particle.EmitterPoint",t);var n=e.prototype;return n._randomPositionOnPoint=function(){var t=this._resultPosition.elements,e=this.position.elements,n=this.positionVariance.elements;return t[0]=e[0]+n[0]*(Math.random()-.5)*2,t[1]=e[1]+n[1]*(Math.random()-.5)*2,t[2]=e[2]+n[2]*(Math.random()-.5)*2,this._resultPosition},n._randomVelocityOnPoint=function(){var t=this._resultVelocity.elements,e=this.velocity.elements,n=this.velocityAddVariance.elements;return t[0]=e[0]+n[0]*Math.random(),t[1]=e[1]+n[1]*Math.random(),t[2]=e[2]+n[2]*Math.random(),this._resultVelocity},n.emit=function(){t.prototype.emit.call(this),this._particle3D.templet.addParticle(this._randomPositionOnPoint(),this._randomVelocityOnPoint())},n.update=function(t){this.advanceTime(t.elapsedTime/1e3)},e}(u),function(t){function e(t){this._settings=null,this._particle3D=null,this.radius=30,this.velocity=0,this.velocityAddVariance=0,this.up=2,e.__super.call(this),this._resultPosition=new vt,this._resultVelocity=new vt,this._direction=new vt,this.centerPosition=new vt,this._particle3D=t;for(var n=t.templet.settings,i=0;3>i;i++)this.centerPosition.elements[i]=n.ringEmitterCenterPosition[i];this.radius=n.ringEmitterRadius,this.velocity=n.ringEmitterVelocity,this.velocityAddVariance=n.ringEmitterVelocityAddVariance,this.emissionRate=n.emissionRate}r(e,"laya.d3.core.particle.EmitterRing",t);var n=e.prototype;return n._randomPointOnRing=function(){var t=Math.random()*Math.PI*2,e=Math.cos(t),n=Math.sin(t),i=this._resultPosition.elements,r=this.centerPosition.elements;switch(this.up){case 0:i[0]=r[0]+0,i[1]=r[1]+e*this.radius,i[2]=r[2]+n*this.radius;break;case 1:i[0]=r[0]+e*this.radius,i[1]=r[1]+0,i[2]=r[2]+n*this.radius;break;case 2:i[0]=r[0]+e*this.radius,i[1]=r[1]+n*this.radius,i[2]=r[2]+0}return this._resultPosition},n._randomVelocityOnRing=function(){var t=this._resultVelocity.elements;this._resultPosition.cloneTo(this._direction),vt.normalize(this._direction,this._direction);var e=this._direction.elements;return t[0]=e[0]*(this.velocity+this.velocityAddVariance*Math.random()),t[1]=e[1]*(this.velocity+this.velocityAddVariance*Math.random()),t[2]=e[2]*(this.velocity+this.velocityAddVariance*Math.random()),this._resultVelocity},n.emit=function(){t.prototype.emit.call(this),this._particle3D.templet.addParticle(this._randomPointOnRing(),this._randomVelocityOnRing())},n.update=function(t){this.advanceTime(t/1e3)},e}(u),function(t){function e(t){this._settings=null,this._particle3D=null,this.radius=1,this.velocity=0,this.velocityAddVariance=0,e.__super.call(this),this._reultPosition=new vt,this._resultVelocity=new vt,this._direction=new vt,this.centerPosition=new vt,this._particle3D=t;for(var n=t.templet.settings,i=0;3>i;i++)this.centerPosition.elements[i]=n.sphereEmitterCenterPosition[i];this.radius=n.sphereEmitterRadius,this.velocity=n.sphereEmitterVelocity,this.velocityAddVariance=n.sphereEmitterVelocityAddVariance,this.emissionRate=n.emissionRate}r(e,"laya.d3.core.particle.EmitterSphere",t);var n=e.prototype;return n._randomPositionOnSphere=function(){var t=Math.random()*Math.PI*2,e=Math.random()*Math.PI*2,n=Math.cos(t)*this.radius,i=Math.sin(t)*this.radius,r=Math.cos(e)*n,a=Math.sin(e)*n,s=this._reultPosition.elements,o=this.centerPosition.elements;return s[0]=o[0]+r,s[1]=o[1]+i,s[2]=o[2]+a,this._reultPosition},n._randomVelocityOnSphere=function(){var t=this._resultVelocity.elements;this._reultPosition.cloneTo(this._direction),vt.normalize(this._direction,this._direction);var e=this._direction.elements;return t[0]=e[0]*(this.velocity+this.velocityAddVariance*Math.random()),t[1]=e[1]*(this.velocity+this.velocityAddVariance*Math.random()),t[2]=e[2]*(this.velocity+this.velocityAddVariance*Math.random()),this._resultVelocity},n.emit=function(){t.prototype.emit.call(this),this._particle3D.templet.addParticle(this._randomPositionOnSphere(),this._randomVelocityOnSphere())},n.update=function(t){this.advanceTime(t.elapsedTime/1e3)},e}(u),function(t){function e(){e.__super.call(this)}r(e,"laya.d3.core.glitter.SplineCurvePosition",t);var n=e.prototype;return n._CalcVelocity=function(t,e,n){vt.subtract(t,e,n),vt.scale(n,.5,n)},n.Init=function(e,n,i,r){this._CalcVelocity(n,e,this._tempVector30),this._CalcVelocity(r,i,this._tempVector31),t.prototype.Init.call(this,n,this._tempVector30,r,this._tempVector31)},e}(O),function(t){function e(){e.__super.call(this,e._name2int,e._int2name,e._int2nameMap)}return r(e,"laya.d3.shader.ShaderDefines3D",t),e.__init__=function(){e.reg("FSHIGHPRECISION",1048576),e.reg("DIFFUSEMAP",1),e.reg("NORMALMAP",2),e.reg("SPECULARMAP",4),e.reg("EMISSIVEMAP",8),e.reg("AMBIENTMAP",16),e.reg("REFLECTMAP",262144),e.reg("PARTICLE3D",32768),e.reg("COLOR",32),e.reg("VERTEXSHADERING",4096),e.reg("PIXELSHADERING",8192),e.reg("SKINNED",1024),e.reg("DIRECTIONLIGHT",64),e.reg("POINTLIGHT",128),e.reg("SPOTLIGHT",256),e.reg("BONE",512),e.reg("ALPHATEST",2048),e.reg("UVTRANSFORM",16384),e.reg("MIXUV",65536),e.reg("FOG",131072),e.reg("VR",524288)},e.reg=function(t,n){M._reg(t,n,e._name2int,e._int2name)},e.toText=function(t,e,n){return M._toText(t,e,n)},e.toInt=function(t){return M._toInt(t,e._name2int)},e.DIFFUSEMAP=1,e.NORMALMAP=2,e.SPECULARMAP=4,e.EMISSIVEMAP=8,e.AMBIENTMAP=16,e.REFLECTMAP=262144,e.VR=524288,e.FSHIGHPRECISION=1048576,e.UVTRANSFORM=16384,e.MIXUV=65536,e.FOG=131072,e.COLOR=32,e.DIRECTIONLIGHT=64,e.POINTLIGHT=128,e.SPOTLIGHT=256,e.BONE=512,e.SKINNED=1024,e.ALPHATEST=2048,e.PARTICLE3D=32768,e.VERTEXSHADERING=4096,e.PIXELSHADERING=8192,e._name2int={},e._int2name=[],e._int2nameMap=[],e}(M)),At=function(t){function e(t){this._id=0,this._enable=!1,this._layerMask=0,this._componentsMap=[],this.transform=null,this.isStatic=!1,e.__super.call(this),this._components=[],this._wvpMatrix=new dt;var n=this;t?this.name=t:this.name="Sprite3D-"+e._nameNumberCounter++,this._enable=!0,this._id=e._uniqueIDCounter,e._uniqueIDCounter++,this.layer=N.currentCreationLayer,this.transform=new k(this),this.on("added",this,function(){n.transform._parent=n._parent.transform}),this.on("removed",this,function(){n.transform._parent=null})}r(e,"laya.d3.core.Sprite3D",t);var i=e.prototype;return n.imps(i,{"laya.d3.core.render.IUpdate":!0}),i._updateComponents=function(t){for(var e=0;e<this._components.length;e++){var n=this._components[e];!n.started&&(n._start(t),n.started=!0),n.isActive&&n._update(t)}},i._lateUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var n=this._components[e];!n.started&&(n._start(t),n.started=!0),n.isActive&&n._lateUpdate(t)}},i._updateChilds=function(t){var e=this._childs.length;if(0!==e)for(var n=0;e>n;++n){var i=this._childs[n];i.active&&i._update(t)}},i._update=function(t){t.owner=this;var e=t.worldTransformModifyID,n=t.renderClip.view(this);n&&this._updateComponents(t),t.worldTransformModifyID+=this.transform._worldTransformModifyID,this.transform.getWorldMatrix(t.worldTransformModifyID),n&&this._lateUpdateComponents(t),this._childs.length&&this._updateChilds(t),t.worldTransformModifyID=e},i.addComponent=function(t){if(void 0!==this._componentsMap[t])throw new Error("无法创建"+t+"组件，"+t+"组件已存在！");var e=l.getInstance(t);return e._initialize(this),this._componentsMap[t]=this._components.length,this._components.push(e),this.event("componentadded",e),e},i.getComponentByType=function(t){return void 0===this._componentsMap[t]?null:this._components[this._componentsMap[t]]},i.getComponentByIndex=function(t){return this._components[t]},i.removeComponent=function(t){if(void 0!==this._componentsMap[t]){var e=this._components[this._componentsMap[t]];this._components.splice(this._componentsMap[t],1),delete this._componentsMap[t],this.event("componentremoved",e)}},i.removeAllComponent=function(){for(var t in this._componentsMap)this.removeComponent(t)},i.loadHierarchy=function(t){var e=this;if(null!==t){var n=new m,i=this;t=V.formatURL(t);var r=function(n){var r=V.basePath;V.basePath=V.getPath(V.formatURL(t)),e.addChild(l.createByJson(n,null,i,c.create(null,Ct._parseHierarchyProp,null,!1),c.create(null,Ct._parseHierarchyNode,null,!1))),V.basePath=r,e.event("hierarchyloaded",i)};n.once("complete",null,r),n.load(t,"text")}},a(0,i,"id",function(){return this._id}),a(0,i,"enable",function(){return this._enable},function(t){this._enable=t,this.event("enabledchanged",this._enable)}),a(0,i,"wvpMatrix",function(){return this._wvpMatrix}),a(0,i,"active",function(){return N.isActive(this._layerMask)&&this._enable}),a(0,i,"visible",function(){return N.isVisible(this._layerMask)&&this._enable}),a(0,i,"layer",function(){return N.getLayerByMask(this._layerMask)},function(t){this._layerMask=t.mask,this.event("layerchanged",this._layerMask)}),a(0,i,"componentsCount",function(){return this._components.length}),a(0,i,"scene",function(){return this.parent.scene}),e._uniqueIDCounter=1,e._nameNumberCounter=0,e}(p),Vt=function(t){function e(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,e.__super.call(this)}r(e,"laya.d3.resource.models.BaseMesh",t);var n=e.prototype;return n.updateToRenderQneue=function(t,e){throw new Error("未Override,请重载该方法！")},n.Render=function(){throw new Error("未Override,请重载该方法！")},n.RenderSubMesh=function(t){throw new Error("未Override,请重载该方法！")},a(0,n,"subMeshCount",function(){return this._subMeshCount}),a(0,n,"boundingBox",function(){return this._boundingBox}),a(0,n,"boundingSphere",function(){return this._boundingSphere}),a(0,n,"positions",function(){throw new Error("未Override,请重载该属性！")}),e}(I),bt=function(t){function e(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,e.__super.call(this)}r(e,"laya.d3.resource.tempelet.BaseMeshTemplet",t);var n=e.prototype;return n.Render=function(){throw new Error("未Override,请重载该方法！")},n.RenderSubMesh=function(t){throw new Error("未Override,请重载该方法！")},a(0,n,"subMeshCount",function(){return this._subMeshCount}),a(0,n,"boundingBox",function(){return this._boundingBox}),a(0,n,"boundingSphere",function(){return this._boundingSphere}),a(0,n,"positions",function(){throw new Error("未Override,请重载该属性！")}),e}(I),wt=(function(t){function e(t,n,i,r,a,s,o,h,l){this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,e.__super.call(this),void 0===i&&(i=6408),void 0===r&&(r=5121),void 0===a&&(a=33189),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===h&&(h=-1),void 0===l&&(l=-1),this._w=t,this._h=n,this._surfaceFormat=i,this._surfaceType=r,this._depthStencilFormat=a,this._mipMap=s,this._repeat=o,this._minFifter=h,this._magFifter=l,this._createWebGLRenderTarget(),this.bitmap.lock=!0}r(e,"laya.d3.resource.RenderTarget",t);var i=e.prototype;return n.imps(i,{"laya.resource.IDispose":!0}),i._createWebGLRenderTarget=function(){this.bitmap=new S(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0},i.start=function(){var t=P.mainContext;t.bindFramebuffer(36160,this.bitmap.frameBuffer),e._currentRenderTarget=this,this._alreadyResolved=!1,e._currentRenderTarget=this},i.clear=function(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1);var r=P.mainContext;r.clearColor(t,e,n,i);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}r.clear(a)},i.end=function(){var t=P.mainContext;t.bindFramebuffer(36160,null),e._currentRenderTarget=null,this._alreadyResolved=!0},i.getData=function(t,e,n,i){var r=P.mainContext;r.bindFramebuffer(36160,this.bitmap.frameBuffer);var a=36053===r.checkFramebufferStatus(36160);if(!a)return r.bindFramebuffer(36160,null),null;var s=new Uint8Array(this._w*this._h*4);return r.readPixels(t,e,n,i,this._surfaceFormat,this._surfaceType,s),r.bindFramebuffer(36160,null),s},i.dispose=function(){this.bitmap.dispose()},a(0,i,"surfaceFormat",function(){return this._surfaceFormat}),a(0,i,"minFifter",function(){return this._minFifter}),a(0,i,"surfaceType",function(){return this._surfaceType}),a(0,i,"depthStencilFormat",function(){return this._depthStencilFormat}),a(0,i,"mipMap",function(){return this._mipMap}),a(0,i,"magFifter",function(){return this._magFifter}),a(0,i,"source",function(){if(this._alreadyResolved)return t.prototype._$get_source.call(this);throw new Error("RenderTarget  还未准备好！")}),e._currentRenderTarget=null,e}(A),function(t){function e(){this._url=null,this._templet=null,this.player=null,e.__super.call(this),this.player=new s}r(e,"laya.d3.component.animation.KeyframeAnimations",t);var n=e.prototype;return n.play=function(t,e,n){void 0===t&&(t=0),void 0===e&&(e=1),void 0===n&&(n=Number.MAX_VALUE),this.player.play(t,e,n)},n.stop=function(t){void 0===t&&(t=!0),this.player.stop(t)},a(0,n,"url",function(){return this._url},function(t){var e=this;0!==this.player.State&&this.player.stop(!0),this._url=V.formatURL(t);var n=I.animationCache[this._url],i=this;if(n)this._templet=n,this.player.templet=n;else{n=I.animationCache[this._url]=new f,this._templet=n,this.player.templet=n;var r=function(t){var i=t;n.parse(i,e.player.cacheFrameRate)},a=new m;a.once("complete",null,r),a.load(this._url,"arraybuffer")}n.loaded?this.event("loaded",this):n.once("loaded",null,function(t){i.event("loaded",i)})}),a(0,n,"currentFrameIndex",function(){return this.player.currentKeyframeIndex}),a(0,n,"NodeCount",function(){return this._templet.getNodeCount(this.player.currentAnimationClipIndex)}),a(0,n,"currentAnimationClipIndex",function(){return this.player.currentAnimationClipIndex}),a(0,n,"paused",function(){return this.player.paused},function(t){this.player.paused=t}),a(0,n,"cacheFrameRate",function(){return this.player.cacheFrameRate}),e}(Mt)),Pt=(function(t){function e(){this._attachSkeleton=null,this._data=null,this._extenData=null,this.attachBone=null,this.matrix=null,e.__super.call(this)}r(e,"laya.d3.component.AttachPoint",t);var n=e.prototype;return n._load=function(e){t.prototype._load.call(this,e),this._attachSkeleton=e.getComponentByType(Gt)},n._update=function(e){if(this._attachSkeleton&&this._attachSkeleton._templet.loaded&&this.attachBone){var n=this._attachSkeleton._templet,i=n.getNodeIndexWithName.call(n,this._attachSkeleton.player.currentAnimationClipIndex,this.attachBone);this._data=this._attachSkeleton.curBonesDatas.subarray(16*i,16*(i+1)),this.matrix||(this.matrix=new dt),this.matrix.copyFromArray(this._data),t.prototype._update.call(this,e)}},e}(Mt),function(t){function e(){e.__super.call(this)}return r(e,"laya.d3.component.Script",t),e}(Mt),function(t){function e(t){this._vertexBuffer3D=null,this._indexBuffer3D=null,this._sharderNameID=0,this._shader=null,this._shaderValue=new b,e.__super.call(this,t),this.initialize(),this.loadShaderParams(),this._vertexBuffer=this._vertexBuffer3D=Ut.create(Y.vertexDeclaration,4*t.maxPartices,35048),this._indexBuffer=this._indexBuffer3D=Nt.create("ushort",6*t.maxPartices,35044,!0),this.loadContent()}r(e,"laya.d3.resource.tempelet.ParticleTemplet3D",t);var i=e.prototype;return n.imps(i,{"laya.d3.core.render.IRender":!0}),i.getBakedVertexs=function(t,e){return null},i.getBakedIndices=function(){return null},i.getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer3D:null},i.getIndexBuffer=function(){return this._indexBuffer3D},i.loadShaderParams=function(){if(this._sharderNameID=C.nameKey.get("PARTICLE"),this.settings.textureName){this.texture=new A,this._shaderValue.pushValue("DIFFUSETEXTURE",null,-1);var t=this;n.loader.load(this.settings.textureName,c.create(null,function(e){e.bitmap.enableMerageInAtlas=!1,e.bitmap.mipmap=!0,t.texture=e}))}this._shaderValue.pushValue("DURATION",this.settings.duration,-1),this._shaderValue.pushValue("GRAVITY",this.settings.gravity,-1),this._shaderValue.pushValue("ENDVELOCITY",this.settings.endVelocity,-1)},i.addParticle=function(t,e){this.addParticleArray(t.elements,e.elements)},i.loadContent=function(){for(var t=new Uint16Array(6*this.settings.maxPartices),e=0;e<this.settings.maxPartices;e++)t[6*e+0]=4*e+0,t[6*e+1]=4*e+1,t[6*e+2]=4*e+2,t[6*e+3]=4*e+0,t[6*e+4]=4*e+2,t[6*e+5]=4*e+3;this._indexBuffer3D.setData(t)},i.addNewParticlesToVertexBuffer=function(){var t=0;this._firstNewElement<this._firstFreeElement?(t=4*this._firstNewElement*this._floatCountPerVertex,this._vertexBuffer3D.setData(this._vertices,t,t,4*(this._firstFreeElement-this._firstNewElement)*this._floatCountPerVertex)):(t=4*this._firstNewElement*this._floatCountPerVertex,this._vertexBuffer3D.setData(this._vertices,t,t,4*(this.settings.maxPartices-this._firstNewElement)*this._floatCountPerVertex),this._firstFreeElement>0&&this._vertexBuffer3D.setData(this._vertices,0,0,4*this._firstFreeElement*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},i._render=function(t){if(this.texture&&this.texture.loaded){if(this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this._firstActiveElement!=this._firstFreeElement){P.mainContext;this._vertexBuffer3D._bind(),this._indexBuffer._bind(),this._shader=this.getShader(t);var e=this._shaderValue.length;this._shaderValue.pushArray(t.shaderValue),this._shaderValue.pushArray(this._vertexBuffer3D.vertexDeclaration.shaderValues),this._shaderValue.pushValue("MVPMATRIX",t.owner.transform.getWorldMatrix(2).elements,-1),this._shaderValue.pushValue("MATRIX1",t.viewMatrix.elements,-1),this._shaderValue.pushValue("MATRIX2",t.projectionMatrix.elements,-1);var n=t.viewport.width/t.viewport.height,i=new pt(.5/n,-.5);this._shaderValue.pushValue("VIEWPORTSCALE",i.elements,-1),this._shaderValue.pushValue("CURRENTTIME",this._currentTime,-1),this._shaderValue.data[1][0]=this.texture.source,this._shaderValue.data[1][1]=this.texture.bitmap.id,this._shader.uploadArray(this._shaderValue.data,this._shaderValue.length,null),this._shaderValue.length=e;var r=0;this._firstActiveElement<this._firstFreeElement?(r=6*(this._firstFreeElement-this._firstActiveElement),P.mainContext.drawElements(4,r,5123,6*this._firstActiveElement*2),y.trianglesFaces+=r/3,y.drawCall++):(r=6*(this.settings.maxPartices-this._firstActiveElement),P.mainContext.drawElements(4,r,5123,6*this._firstActiveElement*2),y.trianglesFaces+=r/3,y.drawCall++,this._firstFreeElement>0&&(r=6*this._firstFreeElement,P.mainContext.drawElements(4,r,5123,0),y.trianglesFaces+=r/3,y.drawCall++))}return this._drawCounter++,!0}return!1},i.getShader=function(t){var e=t.shaderDefs,n=e._value;e.addInt(32768);var i=(e._value|t.shadingMode)+2e-4*this._sharderNameID;return this._shader=C.withCompile(this._sharderNameID,t.shadingMode,e.toNameDic(),i,null),e._value=n,this._shader},a(0,i,"VertexBufferCount",function(){return 1}),a(0,i,"indexOfHost",function(){return 0}),e}(g)),Rt=function(t){function e(){this._enableLightCount=3,this._renderTargetTexture=null,this._customRenderQueneIndex=11,this._lastCurrentTime=NaN,this.enableFog=!1,this.fogStart=NaN,this.fogRange=NaN,this.fogColor=null,this.enableLight=!0,this.currentCamera=null,e.__super.call(this),this._renderState=new H,this._lights=new Array,this._shadingMode=8192,this._renderConfigs=[],this._quenes=[],this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new vt(.7,.7,.7),this._renderConfigs[0]=new F,this._renderConfigs[0].depthTest=!1,this._renderConfigs[1]=new F,this._renderConfigs[2]=new F,this._renderConfigs[2].cullFace=!1,this._renderConfigs[4]=new F,
this._renderConfigs[4].cullFace=!1,this._renderConfigs[4].blend=!0,this._renderConfigs[4].sFactor=770,this._renderConfigs[4].dFactor=771,this._renderConfigs[6]=new F,this._renderConfigs[6].cullFace=!1,this._renderConfigs[6].blend=!0,this._renderConfigs[6].sFactor=770,this._renderConfigs[6].dFactor=1,this._renderConfigs[3]=new F,this._renderConfigs[3].blend=!0,this._renderConfigs[3].sFactor=770,this._renderConfigs[3].dFactor=771,this._renderConfigs[5]=new F,this._renderConfigs[5].blend=!0,this._renderConfigs[5].sFactor=770,this._renderConfigs[5].dFactor=1,this._renderConfigs[8]=new F,this._renderConfigs[8].cullFace=!1,this._renderConfigs[8].blend=!0,this._renderConfigs[8].depthMask=0,this._renderConfigs[8].sFactor=770,this._renderConfigs[8].dFactor=771,this._renderConfigs[10]=new F,this._renderConfigs[10].cullFace=!1,this._renderConfigs[10].blend=!0,this._renderConfigs[10].depthMask=0,this._renderConfigs[10].sFactor=770,this._renderConfigs[10].dFactor=1,this._renderConfigs[7]=new F,this._renderConfigs[7].blend=!0,this._renderConfigs[7].depthMask=0,this._renderConfigs[7].sFactor=770,this._renderConfigs[7].dFactor=771,this._renderConfigs[9]=new F,this._renderConfigs[9].blend=!0,this._renderConfigs[9].depthMask=0,this._renderConfigs[9].sFactor=770,this._renderConfigs[9].dFactor=1}r(e,"laya.d3.core.scene.BaseScene",t);var i=e.prototype;return n.imps(i,{"laya.webgl.submit.ISubmit":!0}),i._clearColor=function(t){var e=this.currentCamera.clearColor.elements;t.clearColor(e[0],e[1],e[2],e[3]),t.clear(16640)},i._prepareScene=function(t,e){N._currentCameraCullingMask=this.currentCamera.cullingMask,e.context=P.mainContext,e.worldTransformModifyID=1,e.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,e.reset(),e.loopCount=y.loopCount,e.shadingMode=this._shadingMode,e.scene=this,e.camera=this.currentCamera;for(var n=0;n<this._quenes.length;n++)this._quenes[n]&&this._quenes[n].reset();var i=e.worldShaderValue,r=y.loopCount;if(this.currentCamera&&i.pushValue("CAMERAPOS",this.currentCamera.transform.position.elements,r),this._lights.length>0){var a=0;for(n=0;n<this._lights.length;n++){var s=this._lights[n];if(s.active){if(a++,a>this._enableLightCount)break;s.updateToWorldState(e)}}}this.enableFog&&(e.worldShaderValue.pushValue("FOGSTART",this.fogStart,r),e.worldShaderValue.pushValue("FOGRANGE",this.fogRange,r),e.worldShaderValue.pushValue("FOGCOLOR",this.fogColor.elements,r))},i._updateScene=function(t){this._updateChilds(t)},i._updateChilds=function(t){for(var e=0,n=this._childs.length;n>e;++e){var i=this._childs[e];i.active&&i._update(t)}},i._preRenderScene=function(t,e){for(var n=0;n<this._quenes.length;n++)this._quenes[n]&&this._quenes[n]._preRender(e)},i._renderScene=function(t,e){var n=e.viewport;t.viewport(n.x,H.clientHeight-n.y-n.height,n.width,n.height);for(var i=0;i<this._quenes.length;i++)this._quenes[i]&&(this._quenes[i]._setState(t),this._quenes[i]._render(e))},i._set3DRenderConfig=function(t){t.disable(3042),R._blend=!1,t.blendFunc(770,771),R._sFactor=770,R._dFactor=771,t.disable(2929),R._depthTest=!1,t.enable(2884),R._cullFace=!0,t.depthMask(1),R._depthMask=1,t.frontFace(2304),R._frontFace=2304},i._set2DRenderConfig=function(t){R.setBlend(t,!0),R.setBlendFunc(t,770,771),R.setDepthTest(t,!1),R.setCullFace(t,!0),R.setDepthMask(t,1),R.setFrontFaceCCW(t,2305),t.viewport(0,0,T.width,T.height)},i._addLight=function(t){this._lights.indexOf(t)<0&&this._lights.push(t)},i._removeLight=function(t){var e=this._lights.indexOf(t);e>=0&&this._lights.splice(e,1)},i.getRenderObject=function(t){return(this._quenes[t]||(this._quenes[t]=new G(this._renderConfigs[t]))).get()},i.addRenderQuene=function(t){this._quenes[this._customRenderQueneIndex++]=new G(t)},i.beforeUpate=function(t){},i.lateUpate=function(t){},i.beforeRender=function(t){},i.lateRender=function(t){},i.render=function(e,n,i){this._childs.length>0&&e.addRenderObject(this),this._renderType&=-2049,t.prototype.render.call(this,e,n,i)},i.renderSubmit=function(){return 1},i.getRenderType=function(){return 0},i.releaseRender=function(){},a(0,i,"scene",function(){return this}),a(0,i,"shadingMode",function(){return 4096==this._shadingMode?0:8192},function(t){if(0!==t&&1!==t)throw Error("Scene set shadingMode,must:0 or 1,value="+t);this._shadingMode=0===t?4096:8192}),e.VERTEX_SHADING=0,e.PIXEL_SHADING=1,e}(E),Lt=function(t){function e(t,n,i){this._isOrthographicProjection=!1,this._projectionMatrixModifyID=0,e.__super.call(this),this._tempVector3=new vt,this._up=new vt,this._forward=new vt,this._right=new vt,void 0===t&&(t=Math.PI/3),void 0===n&&(n=.1),void 0===i&&(i=1e3),this._fieldOfView=t,this._nearPlane=n,this._farPlane=i,this.cullingMask=2147483647,this.clearColor=new gt(100/255,149/255,237/255,1),this._calculateProjectionMatrix()}r(e,"laya.d3.core.camera.BaseCamera",t);var n=e.prototype;return n._calculateProjectionMatrix=function(){},n.moveForward=function(t){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=t,this.transform.translate(this._tempVector3)},n.moveRight=function(t){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=t,this.transform.translate(this._tempVector3)},n.moveVertical=function(t){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=t,this.transform.translate(this._tempVector3,!1)},n.addLayer=function(t){29!==t.number&&30!=t.number&&(this.cullingMask=this.cullingMask|t.mask)},n.removeLayer=function(t){29!==t.number&&30!=t.number&&(this.cullingMask=this.cullingMask&~t.mask)},n.addAllLayers=function(){this.cullingMask=2147483647},n.removeAllLayers=function(){this.cullingMask=0|N.getLayerByNumber(29).mask|N.getLayerByNumber(30).mask},a(0,n,"fieldOfView",function(){return this._fieldOfView},function(t){this._fieldOfView=t,this._calculateProjectionMatrix()}),a(0,n,"forward",function(){var t=this.transform.worldMatrix.elements,e=this._forward.elements;return e[0]=-t[8],e[1]=-t[9],e[2]=-t[10],this._forward}),a(0,n,"nearPlane",function(){return this._nearPlane},function(t){this._nearPlane=t,this._calculateProjectionMatrix()}),a(0,n,"farPlane",function(){return this._farPlane},function(t){this._farPlane=t,this._calculateProjectionMatrix()}),a(0,n,"isOrthographicProjection",function(){return this._isOrthographicProjection}),a(0,n,"right",function(){var t=this.transform.worldMatrix.elements,e=this._right.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],this._right}),a(0,n,"up",function(){var t=this.transform.worldMatrix.elements,e=this._up.elements;return e[0]=t[4],e[1]=t[5],e[2]=t[6],this._up}),e}(At),St=(function(t){function e(t){this._templet=null,e.__super.call(this),this._templet=new It(t)}r(e,"laya.d3.core.glitter.Glitter",t);var n=e.prototype;return n._update=function(t){t.owner=this;var e=t.worldTransformModifyID;t.worldTransformModifyID+=this.transform._worldTransformModifyID,this.transform.getWorldMatrix(t.worldTransformModifyID);var n=t.scene.getRenderObject(8);n.owner=t.owner=this,n.renderElement=this._templet,n.material=null,t.worldTransformModifyID=e,this._childs.length&&this._updateChilds(t)},a(0,n,"templet",function(){return this._templet}),e}(At),function(t){function e(){this._diffuseColor=null,this._ambientColor=null,this._specularColor=null,this._reflectColor=null,e.__super.call(this),this.on("added",this,this._onAdded),this.on("removed",this,this._onRemoved),this._diffuseColor=new vt(.8,.8,.8),this._ambientColor=new vt(.6,.6,.6),this._specularColor=new vt(1,1,1),this._reflectColor=new vt(1,1,1)}r(e,"laya.d3.core.light.LightSprite",t);var n=e.prototype;return n._onRemoved=function(){this.scene._removeLight(this)},n._onAdded=function(){this.scene._addLight(this)},n.updateToWorldState=function(t){},a(0,n,"diffuseColor",function(){return this._diffuseColor},function(t){this._diffuseColor=t}),a(0,n,"lightType",function(){return-1}),a(0,n,"ambientColor",function(){return this._ambientColor},function(t){this._ambientColor=t}),a(0,n,"specularColor",function(){return this._specularColor},function(t){this._specularColor=t}),a(0,n,"reflectColor",function(){return this._reflectColor},function(t){this._reflectColor=t}),e.TYPE_DIRECTIONLIGHT=1,e.TYPE_POINTLIGHT=2,e.TYPE_SPOTLIGHT=3,e}(At)),Ot=function(t){function e(t,n){this._materials=null,this._mesh=null,this._mesh=t,this._mesh instanceof laya.d3.resource.models.Mesh&&(this._materials=t.materials),e.__super.call(this,n)}r(e,"laya.d3.core.MeshSprite3D",t);var n=e.prototype;return n._update=function(t){t.owner=this;var e=t.worldTransformModifyID,n=t.renderClip.view(this);n&&this._updateComponents(t),t.worldTransformModifyID+=this.transform._worldTransformModifyID,this.transform.getWorldMatrix(t.worldTransformModifyID),n&&(this._mesh.updateToRenderQneue(t,this._materials),this._lateUpdateComponents(t)),y.spriteCount++,this._childs.length&&this._updateChilds(t),t.worldTransformModifyID=e},a(0,n,"material",function(){return this._materials||(this.materials=[]),this._materials[0]},function(t){this._materials||(this.materials=[]),this._materials[0]=t}),a(0,n,"materials",function(){return this._materials},function(t){this._materials=t}),a(0,n,"mesh",function(){return this._mesh}),e}(At),Nt=(function(t){function e(t){this.templet=null,e.__super.call(this),this.templet=new Pt(t)}r(e,"laya.d3.core.particle.Particle3D",t);var n=e.prototype;return n.addParticle=function(t,e){vt.add(this.transform.localPosition,t,t),this.templet.addParticle(t,e)},n._update=function(t){this.templet.update(t.elapsedTime),t.owner=this;var e=t.worldTransformModifyID;t.worldTransformModifyID+=this.transform._worldTransformModifyID,this.transform.getWorldMatrix(t.worldTransformModifyID);var n;0===this.templet.settings.blendState?n=t.scene.getRenderObject(7):1===this.templet.settings.blendState&&(n=t.scene.getRenderObject(9)),n.owner=t.owner=this,n.renderElement=this.templet,n.material=null,t.worldTransformModifyID=e,this._childs.length&&this._updateChilds(t)},e}(At),function(t){function e(t,n,i,r){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===i&&(i=35044),void 0===r&&(r=!1),e.__super.call(this),this._indexType=t,this._indexCount=n,this._bufferUsage=i,this._bufferType=34963,this._canRead=r,this._bind();var a=0;if("ushort"==t)this._indexTypeByteCount=2;else{if("ubyte"!=t)throw new Error("unidentification index type.");this._indexTypeByteCount=1}a=this._indexTypeByteCount*n,this._byteLength=a,o._gl.bufferData(this._bufferType,a,this._bufferUsage),r&&("ushort"==t?this._buffer=new Uint16Array(n):"ubyte"==t&&(this._buffer=new Uint8Array(n)))}r(e,"laya.d3.graphics.IndexBuffer3D",t);var n=e.prototype;return n.setData=function(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=4294967295);var r=0;if("ushort"==this._indexType?(r=2,0===n&&4294967295===i||(t=new Uint16Array(t.buffer,n*r,i))):"ubyte"==this._indexType&&(r=1,0===n&&4294967295===i||(t=new Uint8Array(t.buffer,n*r,i))),this._bind(),o._gl.bufferSubData(this._bufferType,e*r,t),this._canRead)if(0!==e||0!==n||4294967295!==i){var a=this._buffer.length-e;i>a&&(i=a);for(var s=0;i>s;s++)this._buffer[e+s]=t[s]}else this._buffer=t},n.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},n.dispose=function(){this._buffer=null,t.prototype.dispose.call(this)},a(0,n,"indexType",function(){return this._indexType}),a(0,n,"indexTypeByteCount",function(){return this._indexTypeByteCount}),a(0,n,"indexCount",function(){return this._indexCount}),a(0,n,"canRead",function(){return this._canRead}),e.INDEXTYPE_UBYTE="ubyte",e.INDEXTYPE_USHORT="ushort",e.create=function(t,n,i,r){return void 0===i&&(i=35044),void 0===r&&(r=!1),new e(t,n,i,r)},e}(o)),Ut=function(t){function e(t,n,i,r){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===r&&(r=!1),e.__super.call(this),this._vertexDeclaration=t,this._vertexCount=n,this._bufferUsage=i,this._bufferType=34962,this._canRead=r,this._bind();var a=this._vertexDeclaration.vertexStride*n;this._byteLength=a,o._gl.bufferData(this._bufferType,a,this._bufferUsage),r&&(this._buffer=new Float32Array(a/4))}r(e,"laya.d3.graphics.VertexBuffer3D",t);var n=e.prototype;return n.bindWithIndexBuffer=function(t){t&&t._bind(),this._bind()},n.setData=function(t,e,n,i){if(void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=4294967295),0===n&&4294967295===i||(t=new Float32Array(t.buffer,4*n,i)),this._bind(),o._gl.bufferSubData(this._bufferType,4*e,t),this._canRead)if(0!==e||0!==n||4294967295!==i){var r=this._buffer.length-e;i>r&&(i=r);for(var a=0;i>a;a++)this._buffer[e+a]=t[a]}else this._buffer=t},n.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},n.detoryResource=function(){for(var e=this._vertexDeclaration.getVertexElements(),n=0;n<e.length;n++)P.mainContext.disableVertexAttribArray(n);t.prototype.detoryResource.call(this)},n.dispose=function(){t.prototype.dispose.call(this),this._buffer=null,this._vertexDeclaration=null},a(0,n,"vertexDeclaration",function(){return this._vertexDeclaration}),a(0,n,"vertexCount",function(){return this._vertexCount}),a(0,n,"canRead",function(){return this._canRead}),e.create=function(t,n,i,r){return void 0===i&&(i=35044),void 0===r&&(r=!1),new e(t,n,i,r)},e}(o),Ft=function(t){function e(t){this._materials=null,this._subMeshes=null,this._useFullBone=!0,this._materialsMap=null,this._url=null,this._loaded=!1,this._subMeshes=[],this._materials=[],this._url=t,e.__super.call(this)}r(e,"laya.d3.resource.models.Mesh",t);var n=e.prototype;return n.add=function(t){t._indexOfHost=this._subMeshes.length,this._subMeshes.push(t),this._subMeshCount++},n.remove=function(t){var e=this._subMeshes.indexOf(t);return 0>e?!1:(this._subMeshes.splice(e,1),this._subMeshCount--,!0)},n.getSubMesh=function(t){return this._subMeshes[t]},n.getSubMeshCount=function(){return this._subMeshes.length},n.clear=function(){return this._subMeshes.length=0,this._subMeshCount=0,this},n.disableUseFullBone=function(){this._useFullBone=!1},n._addToRenderQuene=function(t,e){var n;return e.isSky?n=t.scene.getRenderObject(0):!e.transparent||e.transparent&&0===e.transparentMode?n=e.cullFace?t.scene.getRenderObject(1):t.scene.getRenderObject(2):e.transparent&&1===e.transparentMode&&(n=e.transparentAddtive?e.cullFace?t.scene.getRenderObject(9):t.scene.getRenderObject(10):e.cullFace?t.scene.getRenderObject(7):t.scene.getRenderObject(8)),n},n.updateToRenderQneue=function(t,e){var n=this._subMeshes;if(0!==n.length)for(var i=0,r=n.length;r>i;i++){var a=n[i],s=a.getMaterial(e),o=this._addToRenderQuene(t,s);o.sortID=s.id,o.owner=t.owner,o.renderElement=a,o.material=s,o.tag||(o.tag=new Object),o.tag.worldTransformModifyID=t.worldTransformModifyID}},n.dispose=function(){this._resourceManager.removeResource(this),laya.resource.Resource.prototype.dispose.call(this);for(var t=0;t<this._subMeshes.length;t++)this._subMeshes[t].dispose();this._subMeshes=null,this._subMeshCount=0},a(0,n,"materials",function(){return this._materials}),a(0,n,"loaded",function(){return this._loaded}),e.load=function(t){t=V.formatURL(t);var n=I.meshCache[t];if(!n){n=I.meshCache[t]=new e(t);var i=new m;i.once("complete",null,function(e){new _t(e,n,n._materials,t),n._loaded=!0,n.event("loaded",n)}),i.load(t,"arraybuffer")}return n},e}(Vt),Bt=function(t){function e(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,this._bakedVertexes=null,this._bakedIndices=null,this._isVertexbaked=!1,this._indexOfHost=0,e.__super.call(this),this._indexOfHost=0}r(e,"laya.d3.resource.models.PrimitiveMesh",t);var i=e.prototype;return n.imps(i,{"laya.d3.core.render.IRender":!0}),i.getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},i.getIndexBuffer=function(){return this._indexBuffer},i._getShader=function(t,e,n){if(!n)return null;var i=0,r=e.vertexDeclaration.shaderAttribute;r.UV&&(i|=n.shaderDef),r.COLOR&&(i|=32),t.scene.enableFog&&(i|=131072),i>0&&t.shaderDefs.addInt(i);var a=n.getShader(t);return a},i._addToRenderQuene=function(t,e){var n;return!e.transparent||e.transparent&&0===e.transparentMode?n=e.cullFace?t.scene.getRenderObject(1):t.scene.getRenderObject(2):e.transparent&&1===e.transparentMode&&(n=e.transparentAddtive?e.cullFace?t.scene.getRenderObject(9):t.scene.getRenderObject(10):e.cullFace?t.scene.getRenderObject(7):t.scene.getRenderObject(8)),n},i.detoryResource=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null),this.memorySize=0},i._render=function(t){this._vertexBuffer._bind(),this._indexBuffer._bind();var e=t.renderObj.material;if(e){var n=this._getShader(t,this._vertexBuffer,e),i=t.shaderValue.length;t.shaderValue.pushArray(this._vertexBuffer.vertexDeclaration.shaderValues);var r=t.owner,a=r.transform.getWorldMatrix(-2),s=t.renderObj.tag.worldTransformModifyID;if(t.shaderValue.pushValue("MATRIX1",a.elements,s),dt.multiply(t.projectionViewMatrix,a,t.owner.wvpMatrix),t.shaderValue.pushValue("MVPMATRIX",r.wvpMatrix.elements,t.camera.transform._worldTransformModifyID+s+t.camera._projectionMatrixModifyID),!e.upload(t,null,n))return t.shaderValue.length=i,!1;t.shaderValue.length=i}return t.context.drawElements(4,this._numberIndices,5123,0),y.drawCall++,y.trianglesFaces+=this._numberIndices/3,!0},i.updateToRenderQneue=function(t,e){var n=e[0],i=this._addToRenderQuene(t,n);i.sortID=n.id,i.owner=t.owner,i.renderElement=this,i.material=n,i.tag||(i.tag=new Object),i.tag.worldTransformModifyID=t.worldTransformModifyID},i.getBakedVertexs=function(t,e){if(0===t){if(this._bakedVertexes)return this._bakedVertexes;var n=4,i=this._vertexBuffer;this._bakedVertexes=i.getData().slice();for(var r=i.vertexDeclaration,a=r.shaderAttribute.POSITION[4]/n,s=r.shaderAttribute.NORMAL[4]/n,o=0;o<this._bakedVertexes.length;o+=r.vertexStride/n){var h=o+a;Ct.transformVector3ArrayToVector3ArrayCoordinate(this._bakedVertexes,h,e,this._bakedVertexes,h),Ct.transformVector3ArrayToVector3ArrayCoordinate(this._bakedVertexes,s,e,this._bakedVertexes,s)}return this._isVertexbaked=!0,this._bakedVertexes}return null},i.getBakedIndices=function(){return this._bakedIndices?this._bakedIndices:this._bakedIndices=this._indexBuffer.getData()},a(0,i,"VertexBufferCount",function(){return 1}),a(0,i,"indexOfHost",function(){return this._indexOfHost}),e}(Vt),Gt=(function(t){function e(t){this._vb=null,this._saveToMergeRendering=!1,this._mergeRenderingList=null,this._useFullBone=!0,this._materialsMap=null,this._url=null,this._loaded=!1,e.__super.call(this),this._materials=new Array,this._subMeshes=[];var n=this,i=arguments;this._mergeRenderingList=[],this._mergeRenderingList._length=0;for(var r=0,a=i.length;a>r;r++)this.add(i[r]);this.on("loaded",this,function(t){n._loaded=!0})}r(e,"laya.d3.resource.tempelet.MeshTemplet",t);var n=e.prototype;return n.add=function(t){return this._subMeshes.push(t),this},n.regMaterials=function(t,e){this._materialsMap||(this._materialsMap={}),this._materialsMap[t]=e},n.cloneActiveMaterials=function(t){t||(t=[]),t.length=this._materials.length;for(var e=0,n=this._materials.length;n>e;e++)t[e]||(t[e]=new Et),this._materials[e].copy(t[e]);return t},n.disableUseFullBone=function(){this._useFullBone=!1},n.getSubMesh=function(t){return this._subMeshes[t]},n.setShaderByName=function(t){this._materials&&this._materials.forEach(function(e){e.setShaderName(t)})},n.disableLight=function(){this._materials&&this._materials.forEach(function(t){t.disableLight()})},n.remove=function(t){var e=this._subMeshes.indexOf(t);return 0>e?!1:(this._subMeshes.splice(e,1),!0)},n.clear=function(){return this._subMeshes.length=0,this},n.dispose=function(){this._resourceManager.removeResource(this),laya.resource.Resource.prototype.dispose.call(this),this._materials=null,this._subMeshes=null,this._vb=null},a(0,n,"loaded",function(){return this._loaded}),a(0,n,"subMeshes",function(){return this._subMeshes}),a(0,n,"materials",function(){return this._materials},function(t){this._materials=t}),a(0,n,"vb",function(){return this._vb},function(t){this._vb=t}),e}(bt),function(t){function e(){this._tempCurAnimationData=null,this._lastFrameIndex=-1,this._currentTransform=null,this._originalAnimationTransform=null,this._originalFov=0,this._camera=null,this._currentAnimationData=null,this.localMode=!0,this.addMode=!0,this._tempVector30=new vt,this._tempVector31=new vt,this._tempVector32=new vt,e.__super.call(this)}r(e,"laya.d3.component.animation.CameraAnimations",t);var n=e.prototype;return n._effect=function(){var t=0;for(t=0;3>t;t++)this._tempVector30.elements[t]=this._currentAnimationData[t],this._tempVector31.elements[t]=this._currentAnimationData[t+3],this._tempVector32.elements[t]=this._currentAnimationData[t+6];this._currentTransform||(this._currentTransform=new dt),dt.createLookAt(this._tempVector30,this._tempVector31,this._tempVector32,this._currentTransform),this._currentTransform.invert(this._currentTransform),this.addMode&&dt.multiply(this._originalAnimationTransform,this._currentTransform,this._currentTransform),this.localMode?this.owner.transform.localMatrix=this._currentTransform:this.owner.transform.worldMatrix=this._currentTransform,this._camera.fieldOfView=this._currentAnimationData[9]},n._load=function(t){var e=this;if(!(t instanceof laya.d3.core.camera.Camera))throw new Error("该Sprite3D并非Camera");this._camera=t,this.player.on("stopped",this,function(){e.player.returnToZeroStopped&&(e.localMode?e._originalAnimationTransform&&(t.transform.localMatrix=e._originalAnimationTransform):e._originalAnimationTransform&&(t.transform.worldMatrix=e._originalAnimationTransform),e._camera.fieldOfView=e._originalFov)})},n._update=function(t){if(this.player.update(t.elapsedTime),this._templet&&this._templet.loaded&&2===this.player.State){var e=this.player.playbackRate*t.scene.timer.scale,n=this.player.isCache&&e>=1?this.currentFrameIndex:-1,i=this.currentAnimationClipIndex;if(-1!==n&&this._lastFrameIndex===n)return void laya.d3.component.Component3D.prototype._update.call(this,t);if(this.player.isCache&&e>=1){var r=this._templet.getAnimationDataWithCache(this._templet._animationDatasCache,i,n);if(r)return this._currentAnimationData=r,this._lastFrameIndex=n,laya.d3.component.Component3D.prototype._update.call(this,t),void this._effect()}var a=this._templet.getNodes(i),s=a.length;this.player.isCache&&e>=1?this._currentAnimationData=new Float32Array(10*s):(this._tempCurAnimationData||(this._tempCurAnimationData=new Float32Array(10*s)),this._currentAnimationData=this._tempCurAnimationData),this.player.isCache&&e>=1?this._templet.getOriginalData(i,this._currentAnimationData,n,this.player.currentTime):this._templet.getOriginalDataUnfixedRate(i,this._currentAnimationData,this.player.currentTime),this.player.isCache&&e>=1&&this._templet.setAnimationDataWithCache(this._templet._animationDatasCache,i,n,this._currentAnimationData),this._lastFrameIndex=n,laya.d3.component.Component3D.prototype._update.call(this,t),this._effect()}},n.play=function(e,n,i){void 0===e&&(e=0),void 0===n&&(n=1),void 0===i&&(i=Number.MAX_VALUE),0===this.player.State&&(this._originalAnimationTransform||(this._originalAnimationTransform=new dt),this.localMode?this.owner.transform.localMatrix.cloneTo(this._originalAnimationTransform):this.owner.transform.worldMatrix.cloneTo(this._originalAnimationTransform)),this._originalFov=this._camera.fieldOfView,t.prototype.play.call(this,e,n,i)},e}(wt),function(t){function e(){this._tempCurBonesData=null,this._tempCurAnimationData=null,this._tempFrameIndex=-1,this._tempIsCache=!1,this._curOriginalData=null,this._extenData=null,this._lastFrameIndex=-1,this._ownerMesh=null,this._curBonesDatas=null,this._curAnimationDatas=null,e.__super.call(this)}r(e,"laya.d3.component.animation.SkinAnimations",t);var n=e.prototype;return n._load=function(t){var e=this;this._ownerMesh=t,this.player.on("stopped",this,function(){e._lastFrameIndex=-1,e.player.returnToZeroStopped&&(e._curBonesDatas=e._curAnimationDatas=null)})},n.preComputeKeyFrames=function(t){for(var n=Math.floor(this._templet.getAniDuration(t)/this.player.cacheFrameRateInterval),i=0;n>=i;i++){this._templet._animationDatasCache[0]||(this._templet._animationDatasCache[0]=[]),this._templet._animationDatasCache[1]||(this._templet._animationDatasCache[1]=[]);var r=this._templet.getAnimationDataWithCache(this._templet._animationDatasCache[0],t,i);if(!r){var a=this._templet.getNodes(t),s=16*a.length;this._curAnimationDatas=new Float32Array(s),this._curBonesDatas=new Float32Array(s),this._curOriginalData||(this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(t))),this._templet.getOriginalData(t,this._curOriginalData,i,this.player.cacheFrameRateInterval*i),this._extenData||(this._extenData=new Float32Array(this._templet.getPublicExtData())),Ct._computeSkinAnimationData(a,this._curOriginalData,this._extenData,this._curBonesDatas,this._curAnimationDatas),this._templet.setAnimationDataWithCache(this._templet._animationDatasCache[0],t,i,this._curAnimationDatas),this._templet.setAnimationDataWithCache(this._templet._animationDatasCache[1],t,i,this._curBonesDatas);for(var o=this._ownerMesh.mesh,h=o.getSubMeshCount(),l=0;h>l;l++){var u=o.getSubMesh(l);e._copyBoneAndCache(i,u._boneIndex,this._curAnimationDatas,u._cacheBoneDatas)}}}},n._update=function(t){if(this.player.update(t.elapsedTime),2===this.player.State&&this._templet&&this._templet.loaded){var e=this.player.playbackRate*t.scene.timer.scale,n=this._tempIsCache=this.player.isCache&&e>=1,i=this._tempFrameIndex=n?this.currentFrameIndex:-1;if(-1===i||this._lastFrameIndex!==i){this._templet._animationDatasCache[0]||(this._templet._animationDatasCache[0]=[]),this._templet._animationDatasCache[1]||(this._templet._animationDatasCache[1]=[]);var r=this.currentAnimationClipIndex;if(n){var a=this._templet.getAnimationDataWithCache(this._templet._animationDatasCache[0],r,i);if(a)return this._curAnimationDatas=a,this._curBonesDatas=this._templet.getAnimationDataWithCache(this._templet._animationDatasCache[1],r,i),void(this._lastFrameIndex=i)}var s=this._templet.getNodes(r),o=16*s.length;n?(this._curAnimationDatas=new Float32Array(o),this._curBonesDatas=new Float32Array(o)):(this._tempCurAnimationData||(this._tempCurAnimationData=new Float32Array(o)),this._tempCurBonesData||(this._tempCurBonesData=new Float32Array(o)),this._curAnimationDatas=this._tempCurAnimationData,this._curBonesDatas=this._tempCurBonesData),this._curOriginalData||(this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(r))),n?this._templet.getOriginalData(r,this._curOriginalData,i,this.player.currentFrameTime):this._templet.getOriginalDataUnfixedRate(r,this._curOriginalData,this.player.currentTime),this._extenData||(this._extenData=new Float32Array(this._templet.getPublicExtData())),Ct._computeSkinAnimationData(s,this._curOriginalData,this._extenData,this._curBonesDatas,this._curAnimationDatas),n&&(this._templet.setAnimationDataWithCache(this._templet._animationDatasCache[0],r,i,this._curAnimationDatas),this._templet.setAnimationDataWithCache(this._templet._animationDatasCache[1],r,i,this._curBonesDatas)),this._lastFrameIndex=i}}},n._preRenderUpdate=function(t){if(this._curAnimationDatas){t.shaderDefs.addInt(512);var n=this._ownerMesh.mesh.getSubMesh(t.renderObj.renderElement.indexOfHost);this._tempIsCache?(e._copyBoneAndCache(this._tempFrameIndex,n._boneIndex,this._curAnimationDatas,n._cacheBoneDatas),t.shaderValue.pushValue("MATRIXARRAY0",n._cacheBoneDatas[this._tempFrameIndex],-1)):(e._copyBone(n._boneIndex,this._curAnimationDatas,n._boneData),t.shaderValue.pushValue("MATRIXARRAY0",n._boneData,-1))}},a(0,n,"curBonesDatas",function(){return this._curBonesDatas}),a(0,n,"curAnimationDatas",function(){return this._curAnimationDatas}),a(0,n,"url",t.prototype._$get_url,function(e){this._curOriginalData=this._extenData=null,t.prototype._$set_url.call(this,e)}),e._copyBoneAndCache=function(t,e,n,i){var r=i[t];if(!r){r=i[t]=new Float32Array(16*e.length);for(var a=0,s=e.length,o=0;s>a;a++)for(var h=0;16>h;h++,o++)r[o]=n[(e[a]<<4)+h]}},e._copyBone=function(t,e,n){for(var i=0,r=t.length,a=0;r>i;i++)for(var s=0;16>s;s++,a++)n[a]=e[(t[i]<<4)+s]},e}(wt));(function(t){function e(){this._nodes=null,this._lasstInitIndex=-1,this._subMeshes=null,this._materials=null,this._mesh=null,this._meshDataInited=!1,this._uvDatasCount=0,this._subMeshIndexToNodeIndex=[],this._keyframeAges=[],this._ages=[],this._bufferUsages=[],this._originalShaderAttributes=[],this._uvShaderValues=[],this._uvNextShaderValues=[],this._uvAnimationBuffers=[],e.__super.call(this),this._meshDataInited=!1}r(e,"laya.d3.component.animation.UVAnimations",t);var i=e.prototype;return i._initMeshData=function(){this._materials=this._mesh.mesh.materials,this._subMeshes=this._mesh.mesh.subMeshes,this._meshDataInited=!0},i._initAnimationData=function(t){if(this._lasstInitIndex!==t){this._nodes=this._templet.getNodes(t);for(var e=0;e<this._nodes.length;e++){var n=this._nodes[e],i=n.extenData,r=new h(i),a=r.getInt32();this._uvDatasCount=r.getInt32();var s=this._subMeshes[a];if(this._subMeshIndexToNodeIndex[a]=e,!this._bufferUsages[e]){this._bufferUsages[e]={};for(var o in s._bufferUsage)this._bufferUsages[e][o]=s._bufferUsage[o]}this._originalShaderAttributes[e]=[];for(var l=0;l<this._uvDatasCount;l++)0===l?this._originalShaderAttributes[e][l]=s.getMaterial(s._meshTemplet.materials).getShaderAttribute("UV"):this._originalShaderAttributes[e][l]=s.getMaterial(s._meshTemplet.materials).getShaderAttribute("UV"+l.toString());var u=this._bufferUsages[e];for(this._uvAnimationBuffers[e]=new Array,l=0;l<this._uvDatasCount;l++){for(var _=n.keyframeWidth/this._uvDatasCount,c=new Float32Array(n.keyFrame.length*_),d=0,f=0;f<n.keyFrame.length;f++)c.set(n.keyFrame[f].data.subarray(l*_,(l+1)*_),d),d+=_;this._uvAnimationBuffers[e][l]=Ut.create(new laya.webgl.utils.VertexDeclaration(-1),35044),0===l?u.UV=u.NEXTUV=this._uvAnimationBuffers[e][l]:u["UV"+l.toString()]=u["NEXTUV"+l.toString()]=this._uvAnimationBuffers[e][l],this._uvAnimationBuffers[e][l].clear(),this._uvAnimationBuffers[e][l].append(c),this._uvAnimationBuffers[e][l].upload()}}this._lasstInitIndex=t}},i._load=function(t){var e=this;if(!n.__typeof(t,laya.d3.core.fileModel.MeshSprite3D))throw new Error("该Sprite3D并非Mesh");this._mesh=t,t.on("loaded",this,function(t){!e._meshDataInited&&e._initMeshData(),2==e.player.State&&e._templet&&e._templet.loaded&&e._initAnimationData(e.currentAnimationClipIndex)}),this.on("loaded",this,function(){!e._meshDataInited&&e._initMeshData(),2==e.player.State&&e._mesh.mesh&&e._mesh.mesh.loaded&&e._initAnimationData(e.currentAnimationClipIndex)}),this.player.on("played",this,function(){e._templet&&e._templet.loaded&&e._mesh.mesh&&e._mesh.mesh.loaded&&e._initAnimationData(e.currentAnimationClipIndex)}),this.player.on("stopped",this,function(){if(e.player.returnToZeroStopped&&n.__typeof(t,laya.d3.core.fileModel.MeshSprite3D))for(var i=t.mesh,r=i.materials,a=i.subMeshes,s=0;s<a.length;s++){var o=e._subMeshIndexToNodeIndex[s];if(null!=o)for(var h=0;h<e._uvDatasCount;h++)0===h?e._originalShaderAttributes[o]&&r[a[s].material].addOrUpdateShaderAttribute("UV",e._originalShaderAttributes[o][h],-1):e._originalShaderAttributes[o]&&r[a[s].material].addOrUpdateShaderAttribute("UV"+h.toString(),e._originalShaderAttributes[o][h],-1)}})},i._update=function(t){if(this.player.update(t.elapsedTime),this._templet&&this._templet.loaded&&2===this.player.State){for(var e=this.currentAnimationClipIndex,n=this._templet.getNodesCurrentFrameIndex(e,this.player.currentTime),i=0;i<this._nodes.length;i++){var r=n[i];this._keyframeAges[i]=(this.player.currentTime-this._nodes[i].keyFrame[r].startTime)/this._nodes[i].keyFrame[r].duration,this._ages[i]=this.player.currentTime/this._nodes[i].playTime;var a=this._nodes[i].keyframeWidth/this._uvDatasCount;
this._uvShaderValues[i]||(this._uvShaderValues[i]=[]),this._uvNextShaderValues[i]||(this._uvNextShaderValues[i]=[]);for(var s=0;s<this._uvDatasCount;s++){var o=[2,5126,!1,0,r*a*4],h=[2,5126,!1,0,(r+1)*a*4];this._uvShaderValues[i][s]=o,this._uvNextShaderValues[i][s]=h}}laya.d3.component.Component3D.prototype._update.call(this,t)}},i._preRenderUpdate=function(t){if(this._templet&&this._templet.loaded&&2===this.player.State){var e=t.renderObj.renderElement.indexOfHost,n=this._subMeshes[e],i=this._subMeshIndexToNodeIndex[e];0!==this.player.State&&null!=i&&t.shaderDefs.addInt(65536);var r=n.getMaterial(this._materials);if(null!=i&&0!==this.player.State){t.shaderValue.pushValue("FLOAT0",this._keyframeAges[i],-1),t.shaderValue.pushValue("UVAGEX",this._ages[i],-1);for(var a=0;a<this._uvDatasCount;a++)0===a?(r.addOrUpdateShaderAttribute("UV",this._uvShaderValues[i][a],-1),r.addOrUpdateShaderAttribute("NEXTUV",this._uvNextShaderValues[i][a],-1)):(r.addOrUpdateShaderAttribute("UV"+a.toString(),this._uvShaderValues[i][a],-1),r.addOrUpdateShaderAttribute("NEXTUV"+a.toString(),this._uvNextShaderValues[i][a],-1));n._finalBufferUsageDic=this._bufferUsages[i]}}},e})(wt),function(t){function e(){e.__super.call(this)}r(e,"laya.d3.core.scene.Scene",t);var n=e.prototype;return n.renderSubmit=function(){var t=P.mainContext,e=this._renderState;this._set3DRenderConfig(t),this.currentCamera.clearColor&&this._clearColor(t),this._prepareScene(t,e),this.beforeUpate(e),this._updateScene(e),this.lateUpate(e),this.beforeRender(e),this._preRenderScene(t,e);var n=this.currentCamera;return e.viewMatrix=n.viewMatrix,e.projectionMatrix=n.projectionMatrix,e.projectionViewMatrix=n.projectionViewMatrix,e.viewport=n.viewport,this._renderScene(t,e),this.lateRender(e),this._set2DRenderConfig(t),1},e}(Rt),function(t){function e(){e.__super.call(this)}r(e,"laya.d3.core.scene.VRScene",t);var n=e.prototype;return n.renderSubmit=function(){var t=P.mainContext,e=this._renderState;this._set3DRenderConfig(t),this.currentCamera.clearColor&&this._clearColor(t),this._prepareScene(t,e),e.shaderDefs.add(524288),this.beforeUpate(e),this._updateScene(e),this.lateUpate(e),this.beforeRender(e),this._preRenderScene(t,e);var n=this.currentCamera;e.viewMatrix=n.leftViewMatrix,e.projectionMatrix=n.leftProjectionMatrix,e.projectionViewMatrix=n.leftProjectionViewMatrix,e.viewport=n.leftViewport,this._renderScene(t,e),e.viewMatrix=n.rightViewMatrix,e.projectionMatrix=n.rightProjectionMatrix,e.projectionViewMatrix=n.rightProjectionViewMatrix,e.viewport=n.rightViewport;var i=n.transform._worldTransformModifyID;return n.transform._worldTransformModifyID=2*n.transform._worldTransformModifyID,this._renderScene(t,e),n.transform._worldTransformModifyID=i,this.lateRender(e),this._set2DRenderConfig(t),1},e}(Rt),function(t){function e(t,n,i,r,a){this._viewport=new xt(0,0,0,0),this._viewMatrix=new dt,this._projectionMatrix=new dt,this._projectionViewMatrix=new dt,void 0===n&&(n=Math.PI/3),void 0===i&&(i=0),void 0===r&&(r=.1),void 0===a&&(a=1e3),this._viewport=t,this._aspectRatio=i,e.__super.call(this,n,r,a)}r(e,"laya.d3.core.camera.Camera",t);var n=e.prototype;return n._calculateProjectionMatrix=function(){this._isOrthographicProjection||dt.createPerspective(this.fieldOfView,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix),this._projectionMatrixModifyID+=.01/this.id},a(0,n,"aspectRatio",function(){return 0===this._aspectRatio?this._viewport.width/this._viewport.height:this._aspectRatio},function(t){if(this.aspectRatio<0)throw new Error("横纵比必须是正值得Number！");this._aspectRatio=t,this._calculateProjectionMatrix()}),a(0,n,"viewport",function(){return this._viewport},function(t){this._viewport=t,this._calculateProjectionMatrix()}),a(0,n,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),a(0,n,"projectionMatrix",function(){return this._projectionMatrix}),a(0,n,"projectionViewMatrix",function(){return dt.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),e}(Lt),function(t){function e(t,n,i,r,a,s,o,h){this._tempMatrix=new dt,this._leftViewport=new xt(0,0,0,0),this._leftViewMatrix=new dt,this._leftProjectionMatrix=new dt,this._leftProjectionViewMatrix=new dt,this._rightViewport=new xt(0,0,0,0),this._rightViewMatrix=new dt,this._rightProjectionMatrix=new dt,this._rightProjectionViewMatrix=new dt,void 0===i&&(i=8),void 0===r&&(r=Math.PI/3),void 0===a&&(a=0),void 0===s&&(s=0),void 0===o&&(o=.1),void 0===h&&(h=1e3),this._leftViewport=t,this._rightViewport=n,this._pupilDistande=i,this._leftAspectRatio=a,this._rightAspectRatio=s,e.__super.call(this,r,o,h)}r(e,"laya.d3.core.camera.VRCamera",t);var n=e.prototype;return n._calculatePupilOffset=function(){var t=this._tempVector3;return vt.scale(this.right,this._pupilDistande/2,t),t.elements},n._calculateLeftProjectionMatrix=function(){this._isOrthographicProjection||dt.createPerspective(this.fieldOfView,this.leftAspectRatio,this.nearPlane,this.farPlane,this._leftProjectionMatrix),this._projectionMatrixModifyID+=.01/this.id},n._calculateRightProjectionMatrix=function(){this._isOrthographicProjection||dt.createPerspective(this.fieldOfView,this.rightAspectRatio,this.nearPlane,this.farPlane,this._rightProjectionMatrix),this._projectionMatrixModifyID+=.01/this.id},n._calculateProjectionMatrix=function(){this._isOrthographicProjection||(dt.createPerspective(this.fieldOfView,this.leftAspectRatio,this.nearPlane,this.farPlane,this._leftProjectionMatrix),dt.createPerspective(this.fieldOfView,this.rightAspectRatio,this.nearPlane,this.farPlane,this._rightProjectionMatrix)),this._projectionMatrixModifyID+=.01/this.id},a(0,n,"leftAspectRatio",function(){return 0===this._leftAspectRatio?this._leftViewport.width/this._leftViewport.height:this._leftAspectRatio},function(t){if(this.leftAspectRatio<0)throw new Error("横纵比必须是正值得Number！");this._leftAspectRatio=t,this._calculateLeftProjectionMatrix()}),a(0,n,"leftViewport",function(){return this._leftViewport},function(t){this._leftViewport=t,this._calculateLeftProjectionMatrix()}),a(0,n,"rightAspectRatio",function(){return 0===this._rightAspectRatio?this._rightViewport.width/this._rightViewport.height:this._rightAspectRatio},function(t){if(this.rightAspectRatio<0)throw new Error("横纵比必须是正值得Number！");this._rightAspectRatio=t,this._calculateRightProjectionMatrix()}),a(0,n,"rightProjectionMatrix",function(){return this._rightProjectionMatrix}),a(0,n,"leftProjectionViewMatrix",function(){return dt.multiply(this.leftProjectionMatrix,this.leftViewMatrix,this._leftProjectionViewMatrix),this._leftProjectionViewMatrix}),a(0,n,"rightViewport",function(){return this._rightViewport},function(t){this._rightViewport=t,this._calculateRightProjectionMatrix()}),a(0,n,"leftProjectionMatrix",function(){return this._leftProjectionMatrix}),a(0,n,"leftViewMatrix",function(){var t=this._calculatePupilOffset(),e=this._tempMatrix;this.transform.worldMatrix.cloneTo(e);var n=e.elements;return n[12]-=t[0],n[13]-=t[1],n[14]-=t[2],e.invert(this._leftViewMatrix),this._leftViewMatrix}),a(0,n,"rightViewMatrix",function(){var t=this._calculatePupilOffset(),e=this._tempMatrix;this.transform.worldMatrix.cloneTo(e);var n=e.elements;return n[12]+=t[0],n[13]+=t[1],n[14]+=t[2],e.invert(this._rightViewMatrix),this._rightViewMatrix}),a(0,n,"rightProjectionViewMatrix",function(){return dt.multiply(this.rightProjectionMatrix,this.rightViewMatrix,this._rightProjectionViewMatrix),this._rightProjectionViewMatrix}),e}(Lt),function(t){function e(){this._direction=null,e.__super.call(this),this._diffuseColor=new vt(1,1,1),this._ambientColor=new vt(.6,.6,.6),this._specularColor=new vt(1,1,1),this._reflectColor=new vt(1,1,1),this._direction=new vt(0,-.5,-1)}r(e,"laya.d3.core.light.DirectionLight",t);var n=e.prototype;return n.updateToWorldState=function(t){if(t.scene.enableLight){var e=t.worldShaderValue,n=y.loopCount;t.shaderDefs.add(64),e.pushValue("LIGHTDIRDIFFUSE",this.diffuseColor.elements,n),e.pushValue("LIGHTDIRAMBIENT",this.ambientColor.elements,n),e.pushValue("LIGHTDIRSPECULAR",this.specularColor.elements,n),e.pushValue("LIGHTDIRECTION",this.direction.elements,n)}},a(0,n,"direction",function(){return this._direction},function(t){this._direction=t}),a(0,n,"lightType",function(){return 1}),e}(St),function(t){function e(){this._attenuation=null,this._range=NaN,e.__super.call(this),this._diffuseColor=new vt(1,1,1),this._ambientColor=new vt(.2,.2,.2),this._specularColor=new vt(1,0,0),this._reflectColor=new vt(1,1,1),this.transform.position=new vt(0,0,0),this._range=6,this._attenuation=new vt(.6,.6,.6)}r(e,"laya.d3.core.light.PointLight",t);var n=e.prototype;return n.updateToWorldState=function(t){if(t.scene.enableLight){var e=t.worldShaderValue,n=y.loopCount;t.shaderDefs.add(128),e.pushValue("POINTLIGHTDIFFUSE",this.diffuseColor.elements,n),e.pushValue("POINTLIGHTAMBIENT",this.ambientColor.elements,n),e.pushValue("POINTLIGHTSPECULAR",this.specularColor.elements,n),e.pushValue("POINTLIGHTPOS",this.transform.position.elements,n),e.pushValue("POINTLIGHTRANGE",this.range,n),e.pushValue("POINTLIGHTATTENUATION",this.attenuation.elements,n)}},a(0,n,"range",function(){return this._range},function(t){this._range=t}),a(0,n,"attenuation",function(){return this._attenuation},function(t){this._attenuation=t}),a(0,n,"lightType",function(){return 2}),e}(St),function(t){function e(){this._direction=null,this._attenuation=null,this._spot=NaN,this._range=NaN,e.__super.call(this),this._diffuseColor=new vt(1,1,1),this._ambientColor=new vt(.2,.2,.2),this._specularColor=new vt(1,1,1),this._reflectColor=new vt(1,1,1),this.transform.position=new vt(0,1,1),this._direction=new vt(0,-1,-1),this._attenuation=new vt(.6,.6,.6),this._spot=96,this._range=6}r(e,"laya.d3.core.light.SpotLight",t);var n=e.prototype;return n.updateToWorldState=function(t){if(t.scene.enableLight){var e=t.worldShaderValue,n=y.loopCount;t.shaderDefs.add(256),e.pushValue("SPOTLIGHTDIFFUSE",this.diffuseColor.elements,n),e.pushValue("SPOTLIGHTAMBIENT",this.ambientColor.elements,n),e.pushValue("SPOTLIGHTSPECULAR",this.specularColor.elements,n),e.pushValue("SPOTLIGHTPOS",this.transform.position.elements,n),e.pushValue("SPOTLIGHTDIRECTION",this.direction.elements,n),e.pushValue("SPOTLIGHTRANGE",this.range,n),e.pushValue("SPOTLIGHTSPOT",this.spot,n),e.pushValue("SPOTLIGHTATTENUATION",this.attenuation.elements,n)}},a(0,n,"direction",function(){return this._direction},function(t){this._direction=t}),a(0,n,"attenuation",function(){return this._attenuation},function(t){this._attenuation=t}),a(0,n,"spot",function(){return this._spot},function(t){this._spot=t}),a(0,n,"range",function(){return this._range},function(t){this._range=t}),a(0,n,"lightType",function(){return 3}),e}(St),function(t){function e(t,n,i){this._radius=NaN,this._slices=0,this._stacks=0,void 0===t&&(t=10),void 0===n&&(n=8),void 0===i&&(i=8),e.__super.call(this),this._radius=t,this._stacks=n,this._slices=i,this.recreateResource()}r(e,"laya.d3.resource.models.Sphere",t);var n=e.prototype;return n.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=3*this._stacks*(this._slices+1)*2;for(var t=new Uint16Array(this._numberIndices),e=at.vertexDeclaration,n=e.vertexStride/4,i=new Float32Array(this._numberVertices*n),r=Math.PI/this._stacks,a=2*Math.PI/this._slices,s=0,o=0,h=0,l=0;l<this._stacks+1;l++)for(var u=Math.sin(l*r),_=Math.cos(l*r),c=0;c<this._slices+1;c++){var d=u*Math.sin(c*a),f=u*Math.cos(c*a);i[o+0]=d*this._radius,i[o+1]=_*this._radius,i[o+2]=f*this._radius,i[o+3]=d,i[o+4]=_,i[o+5]=f,i[o+6]=c/this._slices,i[o+7]=l/this._stacks,o+=n,l!=this._stacks-1&&(t[h++]=s+(this._slices+1),t[h++]=s,t[h++]=s+1,t[h++]=s+this._slices,t[h++]=s,t[h++]=s+(this._slices+1),s++)}this._vertexBuffer=new Ut(e,this._numberVertices,35044,!0),this._indexBuffer=new Nt("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(i),this._indexBuffer.setData(t),this.memorySize=2*(this._vertexBuffer.byteLength+this._indexBuffer.byteLength),laya.resource.Resource.prototype.recreateResource.call(this)},a(0,n,"radius",function(){return this._radius},function(t){this._radius=t,this.recreateResource()}),a(0,n,"slices",function(){return this._slices},function(t){this._slices=t,this.recreateResource()}),a(0,n,"stacks",function(){return this._stacks},function(t){this._stacks=t,this.recreateResource()}),e}(Bt)}(window,document,Laya);